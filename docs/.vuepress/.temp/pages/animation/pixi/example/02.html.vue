<template><div><h1 id="二、-进阶" tabindex="-1"><a class="header-anchor" href="#二、-进阶"><span>二、 进阶</span></a></h1>
<h2 id="_2-1-插槽" tabindex="-1"><a class="header-anchor" href="#_2-1-插槽"><span>2.1 插槽</span></a></h2>
<div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre v-pre><code><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">        <span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> Assets<span class="token punctuation">,</span> Color<span class="token punctuation">,</span> Container<span class="token punctuation">,</span> Texture<span class="token punctuation">,</span> Sprite<span class="token punctuation">,</span> Graphics<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> TextStyle<span class="token punctuation">,</span> BlurFilter<span class="token punctuation">,</span> FillGradient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../js/pixi.mjs"</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//使用立即执行函数进行调用</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 创建应用程序</span></span>
<span class="line">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 应用程序初始化</span></span>
<span class="line">            <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span> </span>
<span class="line">                <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">"#1099bb"</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">600</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 应用程序页面添加到网页上</span></span>
<span class="line">            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 加载纹理</span></span>
<span class="line">            <span class="token keyword">await</span> Assets<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">                <span class="token string">"../assets/images/eggHead.png"</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">"../assets/images/flowerTop.png"</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">"../assets/images/helmlok.png"</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">"../assets/images/skully.png"</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">const</span> <span class="token constant">REEL_WIDTH</span> <span class="token operator">=</span> <span class="token number">160</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> <span class="token constant">SYMBOL_SIZE</span> <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建不同的插槽符号</span></span>
<span class="line">            <span class="token keyword">const</span> slotTextures <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">                Texture<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/eggHead.png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                Texture<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/flowerTop.png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                Texture<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/helmlok.png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                Texture<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/skully.png"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建卷轴信息数组</span></span>
<span class="line">            <span class="token keyword">const</span> reels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//创建一个滚动容器</span></span>
<span class="line">            <span class="token keyword">const</span> reelContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 判断几条reel（卷轴）</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//新增容器</span></span>
<span class="line">                <span class="token keyword">const</span> rc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//并设置列的位置</span></span>
<span class="line">                rc<span class="token punctuation">.</span>x <span class="token operator">=</span> i <span class="token operator">*</span> <span class="token constant">REEL_WIDTH</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 添加容器内</span></span>
<span class="line">                reelContainer<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>rc<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//设置卷轴信息，并把创建的容器赋予其中一个属性</span></span>
<span class="line">                <span class="token keyword">const</span> reel <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">container</span><span class="token operator">:</span> rc<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">symbols</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">previousPosition</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">blur</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">BlurFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//滤镜的位置</span></span>
<span class="line">                reel<span class="token punctuation">.</span>blur<span class="token punctuation">.</span>blurX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">                reel<span class="token punctuation">.</span>blur<span class="token punctuation">.</span>blurY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//将卷轴的滤镜信息赋予新建的容器</span></span>
<span class="line">                rc<span class="token punctuation">.</span>filters <span class="token operator">=</span> <span class="token punctuation">[</span>reel<span class="token punctuation">.</span>blur<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 构建每一列上每个符号</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//随机显示4个图片上的一个 作为新建精灵的纹理</span></span>
<span class="line">                    <span class="token keyword">const</span> symbol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sprite</span><span class="token punctuation">(</span>slotTextures<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> slotTextures<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// 缩放精灵以适应符号区域。  宽与高与精灵宽与高比例更小的赋予 设置的比例</span></span>
<span class="line">                    symbol<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>x <span class="token operator">=</span> symbol<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token constant">SYMBOL_SIZE</span> <span class="token operator">/</span> symbol<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token constant">SYMBOL_SIZE</span> <span class="token operator">/</span> symbol<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// y轴的位置与循环j值相关</span></span>
<span class="line">                    symbol<span class="token punctuation">.</span>y <span class="token operator">=</span> j <span class="token operator">*</span> <span class="token constant">SYMBOL_SIZE</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// x值 设置为容器的宽度 减去精灵本身的宽度的一半  如果部位整数进行四舍五入</span></span>
<span class="line">                    symbol<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">SYMBOL_SIZE</span> <span class="token operator">-</span> symbol<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// 将当前数据加入到卷轴信息中</span></span>
<span class="line">                    reel<span class="token punctuation">.</span>symbols<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// 每一个精灵都加入到当前列的容器里</span></span>
<span class="line">                    rc<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// 卷轴信息加入到数组中</span></span>
<span class="line">                reels<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>reel<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">// 将卷轴容器加入到舞台上</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>reelContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//覆盖顶部与底部 并放入到reelContainer（容器）</span></span>
<span class="line">            <span class="token keyword">const</span> margin <span class="token operator">=</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token constant">SYMBOL_SIZE</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//y轴起始位置 margin 高度减去要显示的高度 除以2</span></span>
<span class="line">            reelContainer<span class="token punctuation">.</span>y <span class="token operator">=</span> margin<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//x轴起始位置 宽度减去要显示宽度 除以2</span></span>
<span class="line">            reelContainer<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token constant">REEL_WIDTH</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 上半部分设置黑色</span></span>
<span class="line">            <span class="token keyword">const</span> top <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token punctuation">,</span> margin<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 下半部分设置黑色</span></span>
<span class="line">            <span class="token keyword">const</span> bottom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">SYMBOL_SIZE</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> margin<span class="token punctuation">,</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token punctuation">,</span> margin<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建渐变填充</span></span>
<span class="line">            <span class="token keyword">const</span> fill <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FillGradient</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span> <span class="token operator">*</span> <span class="token number">1.7</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// colors 两个颜色之间出现的颜色 将循环的颜色放入控件中加载，并转成16位</span></span>
<span class="line">            <span class="token keyword">const</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0xffffff</span><span class="token punctuation">,</span> <span class="token number">0x00ff99</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">color</span> <span class="token operator">=></span> Color<span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//多少分之一 减价对应的颜色</span></span>
<span class="line">            colors<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">number<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> ratio <span class="token operator">=</span> index <span class="token operator">/</span> colors<span class="token punctuation">.</span>length<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                fill<span class="token punctuation">.</span><span class="token function">addColorStop</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//添加文本的样式</span></span>
<span class="line">            <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">fontFamily</span><span class="token operator">:</span> <span class="token string">"Arial"</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">fontStyle</span><span class="token operator">:</span> <span class="token string">"italic"</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">fontWeight</span><span class="token operator">:</span> <span class="token string">"bold"</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token punctuation">{</span> fill <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x4a1850</span><span class="token punctuation">,</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">dropShadow</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x000000</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">angle</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">blur</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">distance</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">wordWrap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">wordWrapWidth</span><span class="token operator">:</span> <span class="token number">440</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">const</span> playText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">"启动滚动!"</span><span class="token punctuation">,</span> style<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//添加下面中间的位置</span></span>
<span class="line">            playText<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bottom<span class="token punctuation">.</span>width <span class="token operator">-</span> playText<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//app.screen.height - margin 下方的位置  剩下的是设置文本的位置</span></span>
<span class="line">            playText<span class="token punctuation">.</span>y <span class="token operator">=</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">-</span> margin <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>margin <span class="token operator">-</span> playText<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//8.0之后不建议使用容器之外定义子项</span></span>
<span class="line">            bottom<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>playText<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 添加头部文本</span></span>
<span class="line">            <span class="token keyword">const</span> headerText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">"PIXI怪物老虎机!"</span><span class="token punctuation">,</span> style<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            headerText<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>top<span class="token punctuation">.</span>width <span class="token operator">-</span> headerText<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            headerText<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>margin <span class="token operator">-</span> headerText<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            top<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>headerText<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>top<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>bottom<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 设置交互性。</span></span>
<span class="line">            <span class="token comment">// 点击时触发信息</span></span>
<span class="line">            bottom<span class="token punctuation">.</span>eventMode <span class="token operator">=</span> <span class="token string">"static"</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//鼠标样式改为手指类型</span></span>
<span class="line">            bottom<span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token string">"pointer"</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//添加事件  鼠标点击时触发事件  addListener与on一样都是监控用的</span></span>
<span class="line">            bottom<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">"pointerdown"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">startPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">let</span> running <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 功能开始播放。</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">startPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//防止多次点击</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>running<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">                running <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//循环每条数组</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> reels<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//每一列的对象</span></span>
<span class="line">                    <span class="token keyword">const</span> r <span class="token operator">=</span> reels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//判断0-3之间</span></span>
<span class="line">                    <span class="token keyword">const</span> extra <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//目标对象  当前位置 + 10 + (0-15) + (0-3)</span></span>
<span class="line">                    <span class="token keyword">const</span> target <span class="token operator">=</span> r<span class="token punctuation">.</span>position <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">+</span> extra<span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// 定制时间 最小2500 最大 2500 + 1800 + 1800 = 5100</span></span>
<span class="line">                    <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token number">2500</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">600</span> <span class="token operator">+</span> extra <span class="token operator">*</span> <span class="token number">600</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//将配置加入 寻要循环的位置</span></span>
<span class="line">                    <span class="token function">tweenTo</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">"position"</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token function">backout</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> i <span class="token operator">===</span> reels<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">?</span> reelsComplete <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 当前轮询是否已结束</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">reelsComplete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                running <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 监听动画更新</span></span>
<span class="line">            app<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 更新插槽</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> reels<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//获取对象</span></span>
<span class="line">                    <span class="token keyword">const</span> r <span class="token operator">=</span> reels<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//根据速度更新模糊滤镜y值。</span></span>
<span class="line">                    <span class="token comment">//如果也考虑到时间，这会更好。现在模糊取决于帧率。</span></span>
<span class="line">                    <span class="token comment">// 设置Y轴模糊度</span></span>
<span class="line">                    r<span class="token punctuation">.</span>blur<span class="token punctuation">.</span>blurY <span class="token operator">=</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>position <span class="token operator">-</span> r<span class="token punctuation">.</span>previousPosition<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//之前的位置</span></span>
<span class="line">                    r<span class="token punctuation">.</span>previousPosition <span class="token operator">=</span> r<span class="token punctuation">.</span>position<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 循环其中的条状容器 .</span></span>
<span class="line">                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> r<span class="token punctuation">.</span>symbols<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token comment">// 每一个对象</span></span>
<span class="line">                        <span class="token keyword">const</span> s <span class="token operator">=</span> r<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token comment">//当前对象的Y轴</span></span>
<span class="line">                        <span class="token keyword">const</span> prevy <span class="token operator">=</span> s<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line">                        <span class="token comment">//新的Y值</span></span>
<span class="line">                        <span class="token comment">// 下面的事件中 position都是从初始值一直到目标值</span></span>
<span class="line">                        <span class="token comment">// 每次posion变化 y轴也会花生变化</span></span>
<span class="line"></span>
<span class="line">                        s<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>position <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">%</span> r<span class="token punctuation">.</span>symbols<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">SYMBOL_SIZE</span> <span class="token operator">-</span> <span class="token constant">SYMBOL_SIZE</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token comment">// y轴 一直会随着r.position 变化而花生变化</span></span>
<span class="line">                        <span class="token comment">// 当position 从大于1的数回到1时，y轴也会花生相应的变化</span></span>
<span class="line">                        <span class="token comment">// console.log(s.y, prevy);</span></span>
<span class="line"></span>
<span class="line">                        <span class="token comment">// 能整除4 且有余数(小数)的新值都是负数</span></span>
<span class="line">                        <span class="token comment">// 能整除4 无余数 新值也是负值 但整除4等于1 时 下面的判断就会出现错误</span></span>
<span class="line">                        <span class="token comment">// 不能整除4 不管有没有余数都不会发生改变</span></span>
<span class="line"></span>
<span class="line">                        <span class="token comment">//结果是 symbols.length 下四个精灵  每个循环四次都会改变一下纹理</span></span>
<span class="line">                        <span class="token comment">// y轴移动时 还会改变纹理的成功了</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> prevy <span class="token operator">></span> <span class="token constant">SYMBOL_SIZE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                            <span class="token comment">//获取新的随机纹理</span></span>
<span class="line">                            s<span class="token punctuation">.</span>texture <span class="token operator">=</span> slotTextures<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> slotTextures<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token comment">//x轴y轴改变</span></span>
<span class="line">                            s<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>x <span class="token operator">=</span> s<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token constant">SYMBOL_SIZE</span> <span class="token operator">/</span> s<span class="token punctuation">.</span>texture<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token constant">SYMBOL_SIZE</span> <span class="token operator">/</span> s<span class="token punctuation">.</span>texture<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                            <span class="token comment">//x轴也改变</span></span>
<span class="line">                            s<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">SYMBOL_SIZE</span> <span class="token operator">-</span> s<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 非常简单且实用函数 在实际产品中，这应该被一个适当的library （库）所取代。</span></span>
<span class="line">            <span class="token keyword">const</span> tweening <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">tweenTo</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> property<span class="token punctuation">,</span> target<span class="token punctuation">,</span> time<span class="token punctuation">,</span> easing<span class="token punctuation">,</span> onchange<span class="token punctuation">,</span> oncomplete</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> tween <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                    object<span class="token punctuation">,</span></span>
<span class="line">                    property<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">propertyBeginValue</span><span class="token operator">:</span> object<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    target<span class="token punctuation">,</span></span>
<span class="line">                    easing<span class="token punctuation">,</span></span>
<span class="line">                    time<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">change</span><span class="token operator">:</span> onchange<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">complete</span><span class="token operator">:</span> oncomplete<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">start</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                tweening<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>tween<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">return</span> tween<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">// 监听动画更新</span></span>
<span class="line">            app<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//获取当前时间</span></span>
<span class="line">                <span class="token keyword">const</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//移除集合</span></span>
<span class="line">                <span class="token keyword">const</span> remove <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//循环替换集合</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tweening<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//获取当前对象</span></span>
<span class="line">                    <span class="token keyword">const</span> t <span class="token operator">=</span> tweening<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//判断 当前获取的时间减去开始插入时的时间 再除以定制时间 随着时间的增长 会越来越趋近于1</span></span>
<span class="line">                    <span class="token comment">//值是0-1 越来越接近于1</span></span>
<span class="line">                    <span class="token keyword">const</span> phase <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> t<span class="token punctuation">.</span>start<span class="token punctuation">)</span> <span class="token operator">/</span> t<span class="token punctuation">.</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// t.object等于当前数列的对象 设置的当前属性position  = lerp函数[上次移动位置,目标对象,箭头函数 ]</span></span>
<span class="line">                    <span class="token comment">//位置  最后的值大于 t.easing(phase)接近于想要的位置</span></span>
<span class="line">                    t<span class="token punctuation">.</span>object<span class="token punctuation">[</span>t<span class="token punctuation">.</span>property<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>propertyBeginValue<span class="token punctuation">,</span> t<span class="token punctuation">.</span>target<span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">easing</span><span class="token punctuation">(</span>phase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// console.log(t.propertyBeginValue, t.target, t.easing(phase), t.object[t.property]);</span></span>
<span class="line">                    <span class="token comment">//t.change存在，执行change函数，默认为空</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>change<span class="token punctuation">)</span> t<span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//如果都是1</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>phase <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token comment">//将目标对象 赋予position</span></span>
<span class="line">                        t<span class="token punctuation">.</span>object<span class="token punctuation">[</span>t<span class="token punctuation">.</span>property<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">.</span>target<span class="token punctuation">;</span></span>
<span class="line">                        <span class="token comment">//如果是最后一位开始将运行状态running改为true</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>complete<span class="token punctuation">)</span> t<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token comment">//将对象插入到移除列表中</span></span>
<span class="line">                        remove<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">//按照循环进行删除</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> remove<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    tweening<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>tweening<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>remove<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//基本警报功能</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">lerp</span><span class="token punctuation">(</span><span class="token parameter">a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> a1 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">+</span> a2 <span class="token operator">*</span> t<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// tweenjs的回退功能。</span></span>
<span class="line">            <span class="token comment">// 直接返回一个箭头函数  这个箭头函数传入的值是0-1 传入的值越接近1返回的值也越接近于1</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">backout</span><span class="token punctuation">(</span><span class="token parameter">amount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// --t 传入的数据先前去1</span></span>
<span class="line">                <span class="token comment">// 如果t等于0.1  --t等于 0.9 t * t = 0.81  结果等于 0.81 * -0.58 + 1 = 0.311499999999999</span></span>
<span class="line">                <span class="token comment">// 如果t > 0.67 小于时 返回值 大于1</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token operator">--</span>t <span class="token operator">*</span> t <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>amount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> t <span class="token operator">+</span> amount<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>示例</li>
</ul>
<p><button @click="state1 = !state1">{{state1?&quot;关闭展示&quot;:&quot;开启展示&quot;}}</button></p>
<div v-if="state1">
    <iframe src="/note-front/animation/pixi/example/html/09.html" width="850" height="650"></iframe>
</div>
<h2 id="_2-2-刮刮卡" tabindex="-1"><a class="header-anchor" href="#_2-2-刮刮卡"><span>2.2 刮刮卡</span></a></h2>
<ul>
<li>代码</li>
</ul>
<div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre v-pre><code><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">        <span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> Assets<span class="token punctuation">,</span> Graphics<span class="token punctuation">,</span> Sprite<span class="token punctuation">,</span> RenderTexture<span class="token punctuation">,</span> Point <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../js/pixi.mjs"</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 创建应用程序</span></span>
<span class="line">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 初始化应用程序</span></span>
<span class="line">            <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span> </span>
<span class="line">                <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">600</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">width</span><span class="token operator">:</span><span class="token number">800</span><span class="token punctuation">,</span> </span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 将应用程序添加到网页中</span></span>
<span class="line">            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 画一个原型纹理将被作为我们的笔刷</span></span>
<span class="line">            <span class="token keyword">const</span> brush <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">circle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xffffff</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建一条线来插值绘制的点</span></span>
<span class="line">            <span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 加载纹理</span></span>
<span class="line">            <span class="token keyword">await</span> Assets<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">                <span class="token string">"../assets/images/bg_grass.jpg"</span><span class="token punctuation">,</span> </span>
<span class="line">                <span class="token string">"../assets/images/bg_rotate.jpg"</span></span>
<span class="line">            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//获取宽与高</span></span>
<span class="line">            <span class="token keyword">const</span> <span class="token punctuation">{</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//将舞台大小设置屏幕的大小</span></span>
<span class="line">            <span class="token keyword">const</span> stageSize <span class="token operator">=</span> <span class="token punctuation">{</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//设置精灵并赋值屏幕的宽度与高度</span></span>
<span class="line">            <span class="token keyword">const</span> background <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>Sprite<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/bg_grass.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stageSize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> imageToReveal <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>Sprite<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/bg_rotate.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stageSize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//创建渲染纹理</span></span>
<span class="line">            <span class="token keyword">const</span> renderTexture <span class="token operator">=</span> RenderTexture<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>stageSize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//将这个纹理赋值给新的精灵</span></span>
<span class="line">            <span class="token keyword">const</span> renderTextureSprite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sprite</span><span class="token punctuation">(</span>renderTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//新精灵作为遮罩 当遮罩有值的时候 这个精灵回显示出来</span></span>
<span class="line">            imageToReveal<span class="token punctuation">.</span>mask <span class="token operator">=</span> renderTextureSprite<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 舞台上把这三者添加上</span></span>
<span class="line">            <span class="token comment">// 由于renderTextureSprite初始值为空 所以imageToReveal精灵显示不出  只能 显示background</span></span>
<span class="line">            <span class="token comment">// 更改renderTextureSprite的遮罩信息，可以将imageToReveal数据显示出来</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>background<span class="token punctuation">,</span> imageToReveal<span class="token punctuation">,</span> renderTextureSprite<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//设置事件启动</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>eventMode <span class="token operator">=</span> <span class="token string">"static"</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//点击命中返回的范围是整个屏幕</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>hitArea <span class="token operator">=</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//分别加载四种监控 鼠标按下 鼠标释放 在访问区域的外部 指针在页面上的移动</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"pointerdown"</span><span class="token punctuation">,</span> pointerDown<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"pointerup"</span><span class="token punctuation">,</span> pointerUp<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"pointerupoutside"</span><span class="token punctuation">,</span> pointerUp<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"pointermove"</span><span class="token punctuation">,</span> pointerMove<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//拖拽进行的状态</span></span>
<span class="line">            <span class="token keyword">let</span> dragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 最后按下鼠标指针</span></span>
<span class="line">            <span class="token keyword">let</span> lastDrawnPoint <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//传入的参数 鼠标的位置</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">pointerMove</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//如果鼠标按下了</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>dragging<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//笔刷进入当前位置</span></span>
<span class="line">                    brush<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// 文档路径错误，哎</span></span>
<span class="line">                    app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                        <span class="token comment">//主体 笔刷</span></span>
<span class="line">                        <span class="token literal-property property">container</span><span class="token operator">:</span> brush<span class="token punctuation">,</span></span>
<span class="line">                        <span class="token comment">//目标渲染纹理</span></span>
<span class="line">                        <span class="token literal-property property">target</span><span class="token operator">:</span> renderTexture<span class="token punctuation">,</span></span>
<span class="line">                        <span class="token comment">// 清理</span></span>
<span class="line">                        <span class="token literal-property property">clear</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">                        <span class="token comment">//跳过清理转换</span></span>
<span class="line">                        <span class="token literal-property property">skipUpdateTransform</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//这个判断 最后画的点是否存在  是第二次进入</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>lastDrawnPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token comment">//将上次移动的位置移动到这次的位置 宽度设置100且颜色为白色</span></span>
<span class="line">                        line<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>lastDrawnPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> lastDrawnPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xffffff</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token comment">//将新内容放到渲染纹理中</span></span>
<span class="line">                        app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                            <span class="token literal-property property">container</span><span class="token operator">:</span> line<span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">target</span><span class="token operator">:</span> renderTexture<span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">clear</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">                            <span class="token literal-property property">skipUpdateTransform</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                    <span class="token comment">//如果为空新建一个Point 否则使用上次的</span></span>
<span class="line">                    lastDrawnPoint <span class="token operator">=</span> lastDrawnPoint <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//这只x与y的坐标</span></span>
<span class="line">                    lastDrawnPoint<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//按下后 可进行移动</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">pointerDown</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                dragging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token function">pointerMove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">// 松开后两个配置都为空</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">pointerUp</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                dragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">                lastDrawnPoint <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>示例</li>
</ul>
<p><button @click="state2 = !state2">{{state2?&quot;关闭展示&quot;:&quot;开启展示&quot;}}</button></p>
<div v-if="state2">
    <iframe src="/note-front/animation/pixi/example/html/10.html" width="850" height="650"></iframe>
</div>
<h2 id="_2-3-星空" tabindex="-1"><a class="header-anchor" href="#_2-3-星空"><span>2.3 星空</span></a></h2>
<ul>
<li>代码</li>
</ul>
<div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre v-pre><code><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">        <span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> Assets<span class="token punctuation">,</span> Sprite <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../js/pixi.mjs"</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 创建应用程序</span></span>
<span class="line">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 初始化应用程序</span></span>
<span class="line">            <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span> </span>
<span class="line">                <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">600</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">width</span><span class="token operator">:</span><span class="token number">800</span><span class="token punctuation">,</span> </span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 应用程序添加到页面上</span></span>
<span class="line">            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 加载星星纹理</span></span>
<span class="line">            <span class="token keyword">const</span> starTexture <span class="token operator">=</span> <span class="token keyword">await</span> Assets<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"../assets/images/star.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//星星数量</span></span>
<span class="line">            <span class="token keyword">const</span> starAmount <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//摄像机z轴</span></span>
<span class="line">            <span class="token keyword">let</span> cameraZ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//视厂</span></span>
<span class="line">            <span class="token keyword">const</span> fov <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//基础速度</span></span>
<span class="line">            <span class="token keyword">const</span> baseSpeed <span class="token operator">=</span> <span class="token number">0.025</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//速度</span></span>
<span class="line">            <span class="token keyword">let</span> speed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//曲速</span></span>
<span class="line">            <span class="token keyword">let</span> warpSpeed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 星星伸展</span></span>
<span class="line">            <span class="token keyword">const</span> starStretch <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 星星基础大小</span></span>
<span class="line">            <span class="token keyword">const</span> starBaseSize <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建星星集合</span></span>
<span class="line">            <span class="token keyword">const</span> stars <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> starAmount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// star 精灵对象</span></span>
<span class="line">                <span class="token keyword">const</span> star <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">sprite</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Sprite</span><span class="token punctuation">(</span>starTexture<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">z</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//设置精灵的锚点</span></span>
<span class="line">                star<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span></span>
<span class="line">                star<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0.7</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//放入随机位置</span></span>
<span class="line">                <span class="token function">randomizeStar</span><span class="token punctuation">(</span>star<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//将每个star精灵添加到画布上</span></span>
<span class="line">                app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>star<span class="token punctuation">.</span>sprite<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//将star 添加集合中</span></span>
<span class="line">                stars<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>star<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">//星星的随机位置</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">randomizeStar</span><span class="token punctuation">(</span><span class="token parameter">star<span class="token punctuation">,</span> initial</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//z轴 如果为true 开始随机0-2000 之内的数据 否则摄像机轴 加上0-1000 加上2000</span></span>
<span class="line">                star<span class="token punctuation">.</span>z <span class="token operator">=</span> initial <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span> <span class="token operator">:</span> cameraZ <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">+</span> <span class="token number">2000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 放射性随机的坐标来确认star位置 ，这样没有star撞到相机</span></span>
<span class="line">                <span class="token comment">// 角度 0 到 6.28.. 之间</span></span>
<span class="line">                <span class="token keyword">const</span> deg <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 距离</span></span>
<span class="line">                <span class="token keyword">const</span> distance <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//正弦 余弦 都在 -1到1 之间</span></span>
<span class="line">                star<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>deg<span class="token punctuation">)</span> <span class="token operator">*</span> distance<span class="token punctuation">;</span></span>
<span class="line">                star<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>deg<span class="token punctuation">)</span> <span class="token operator">*</span> distance<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 每5秒更改一次飞行速度</span></span>
<span class="line">            <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//五秒钟等于0 五秒钟等于1</span></span>
<span class="line">                warpSpeed <span class="token operator">=</span> warpSpeed <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 监听动画更新</span></span>
<span class="line">            app<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">time</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 简单的缓缓移动 当用于真实时，应将其更改为适当的慢动功能</span></span>
<span class="line">                <span class="token comment">// 第一次  warpSpeed等于1 speed越来越接近1</span></span>
<span class="line">                <span class="token comment">// 第二次  由接近1的数 开始无线接近于0 会出现 4.662602347812701e-9 这样的数 其实这个数比0.0000010177704155697795 更小</span></span>
<span class="line">                speed <span class="token operator">+=</span> <span class="token punctuation">(</span>warpSpeed <span class="token operator">-</span> speed<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//判断摄像机的z轴 默认是0 一直再变大</span></span>
<span class="line">                <span class="token comment">// 如果 time.deltaTime 等于1 最大加的值 12.5  最小加的值 2.5</span></span>
<span class="line">                <span class="token comment">// warpSpeed 是1的时候 cameraZ增长的快 是0的时候 cameraZ增长的慢</span></span>
<span class="line">                cameraZ <span class="token operator">+=</span> time<span class="token punctuation">.</span>deltaTime <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token punctuation">(</span>speed <span class="token operator">+</span> baseSpeed<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//循环一千颗星星</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> starAmount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">// 每一颗星星的对象</span></span>
<span class="line">                    <span class="token keyword">const</span> star <span class="token operator">=</span> stars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//当前星星的z轴小于摄像机的z轴  重新设定位置</span></span>
<span class="line">                    <span class="token comment">// 由于摄像机一直会增大 star的z轴也会变化</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>star<span class="token punctuation">.</span>z <span class="token operator">&lt;</span> cameraZ<span class="token punctuation">)</span> <span class="token function">randomizeStar</span><span class="token punctuation">(</span>star<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 用非常简单的投影将star的三维位置映射到二维</span></span>
<span class="line">                    <span class="token comment">// 这个z 调整后 1-1000  + 2000 距离</span></span>
<span class="line">                    <span class="token comment">// 随着 cameraZ慢慢增大 得到的结果又会慢慢缩小 达到某个阈值又会从头开始</span></span>
<span class="line">                    <span class="token keyword">const</span> z <span class="token operator">=</span> star<span class="token punctuation">.</span>z <span class="token operator">-</span> cameraZ<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 第一次x 与y 都在 -1 到1 之间 星星对象中精灵的位置 都在中心一个点上</span></span>
<span class="line">                    <span class="token comment">// 视厂 屏幕距离 (fov / z) * app.renderer.screen.width 其实就是判断距离屏幕眼镜的z轴距离，这个应该学习图形学的时候会学到吧</span></span>
<span class="line">                    star<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>x <span class="token operator">=</span> star<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token punctuation">(</span>fov <span class="token operator">/</span> z<span class="token punctuation">)</span> <span class="token operator">*</span> app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">+</span> app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">                    star<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>y <span class="token operator">=</span> star<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token punctuation">(</span>fov <span class="token operator">/</span> z<span class="token punctuation">)</span> <span class="token operator">*</span> app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">+</span> app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 计算star的尺度和自转。</span></span>
<span class="line">                    <span class="token keyword">const</span> dxCenter <span class="token operator">=</span> star<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>x <span class="token operator">-</span> app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">const</span> dyCenter <span class="token operator">=</span> star<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>y <span class="token operator">-</span> app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//距离中心点 sqrt平方根</span></span>
<span class="line">                    <span class="token keyword">const</span> distanceCenter <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>dxCenter <span class="token operator">*</span> dxCenter <span class="token operator">+</span> dyCenter <span class="token operator">*</span> dyCenter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>speed<span class="token punctuation">,</span> distanceCenter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">//距离比例</span></span>
<span class="line">                    <span class="token keyword">const</span> distanceScale <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2000</span> <span class="token operator">-</span> z<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">//x 的比例 星星基础比例 x 距离比例</span></span>
<span class="line">                    star<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>x <span class="token operator">=</span> distanceScale <span class="token operator">*</span> starBaseSize<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">//恒星朝向中心，因此y轴朝向中心。</span></span>
<span class="line">                    <span class="token comment">//根据我们移动的速度和拉伸系数来缩放恒星</span></span>
<span class="line">                    <span class="token comment">//取决于它离中心有多远。</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// y轴比例 星星基础比例 x 距离比例</span></span>
<span class="line">                    <span class="token comment">// speed越来越接近1 y轴会边长</span></span>
<span class="line">                    <span class="token comment">// distanceCenter speed越接近0变化越小 speed越接近1变化越大</span></span>
<span class="line">                    star<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>y <span class="token operator">=</span> distanceScale <span class="token operator">*</span> starBaseSize <span class="token operator">+</span> <span class="token punctuation">(</span>distanceScale <span class="token operator">*</span> speed <span class="token operator">*</span> starStretch <span class="token operator">*</span> distanceCenter<span class="token punctuation">)</span> <span class="token operator">/</span> app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//atan2 返回值再 -PI与PI之间 代表旋转的角度在0度与360度之间</span></span>
<span class="line">                    star<span class="token punctuation">.</span>sprite<span class="token punctuation">.</span>rotation <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>dyCenter<span class="token punctuation">,</span> dxCenter<span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>示例</li>
</ul>
<p><button @click="state3 = !state3">{{state3?&quot;关闭展示&quot;:&quot;开启展示&quot;}}</button></p>
<div v-if="state3">
    <iframe src="/note-front/animation/pixi/example/html/11.html" width="850" height="650"></iframe>
</div>
<h2 id="_2-4-结合three-js" tabindex="-1"><a class="header-anchor" href="#_2-4-结合three-js"><span>2.4 结合three.js</span></a></h2>
<ul>
<li>代码</li>
</ul>
<div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre v-pre><code><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">        <span class="token comment">// 从PixiJS和Three.js导入所需类</span></span>
<span class="line">        <span class="token keyword">import</span> <span class="token punctuation">{</span> Container<span class="token punctuation">,</span> Graphics<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> WebGLRenderer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../js/pixi.mjs"</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">"../js/three.mjs"</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 自执行异步函数用于设置演示场景</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 初始化窗口尺寸</span></span>
<span class="line">            <span class="token keyword">let</span> <span class="token constant">WIDTH</span> <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">let</span> <span class="token constant">HEIGHT</span> <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// === THREE.JS 设置 ===</span></span>
<span class="line">            <span class="token comment">// 创建带抗锯齿和模板缓冲的Three.js WebGL渲染器</span></span>
<span class="line">            <span class="token keyword">const</span> threeRenderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">antialias</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">stencil</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 配置Three.js渲染器尺寸和背景色</span></span>
<span class="line">            threeRenderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token constant">WIDTH</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            threeRenderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token number">0xdddddd</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 浅灰色背景</span></span>
<span class="line">            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>threeRenderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建Three.js场景</span></span>
<span class="line">            <span class="token keyword">const</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 设置70°视野的透视相机</span></span>
<span class="line">            <span class="token keyword">const</span> threeCamera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token constant">WIDTH</span> <span class="token operator">/</span> <span class="token constant">HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            threeCamera<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token comment">// 将相机后移以查看场景</span></span>
<span class="line">            scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>threeCamera<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建立方体网格</span></span>
<span class="line">            <span class="token keyword">const</span> boxGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> basicMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x0095dd</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 蓝色材质</span></span>
<span class="line">            <span class="token keyword">const</span> cube <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>boxGeometry<span class="token punctuation">,</span> basicMaterial<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cube<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// === PIXI.JS 设置 ===</span></span>
<span class="line">            <span class="token comment">// 创建与Three.js共享WebGL上下文的PixiJS渲染器</span></span>
<span class="line">            <span class="token keyword">const</span> pixiRenderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 使用共享上下文初始化PixiJS渲染器</span></span>
<span class="line">            <span class="token keyword">await</span> pixiRenderer<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">context</span><span class="token operator">:</span> threeRenderer<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token constant">WIDTH</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token constant">HEIGHT</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">clearBeforeRender</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不清空画布，由Three.js处理</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建PixiJS场景图</span></span>
<span class="line">            <span class="token keyword">const</span> stage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建黄色圆角矩形UI元素</span></span>
<span class="line">            <span class="token keyword">const</span> uiLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roundRect</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0xffff00</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 添加文字覆盖层</span></span>
<span class="line">            <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">"Pixi and Three.js"</span><span class="token punctuation">,</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">fontFamily</span><span class="token operator">:</span> <span class="token string">"Arial"</span><span class="token punctuation">,</span> <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token string">"black"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            uiLayer<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>uiLayer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 动画循环</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 持续旋转立方体</span></span>
<span class="line">                cube<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span></span>
<span class="line">                cube<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 使用正弦波动画化UI层位置</span></span>
<span class="line">                uiLayer<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token constant">WIDTH</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 渲染Three.js场景</span></span>
<span class="line">                threeRenderer<span class="token punctuation">.</span><span class="token function">resetState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                threeRenderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> threeCamera<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 渲染PixiJS场景</span></span>
<span class="line">                pixiRenderer<span class="token punctuation">.</span><span class="token function">resetState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                pixiRenderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">container</span><span class="token operator">:</span> stage <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 继续动画循环</span></span>
<span class="line">                <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 启动动画循环</span></span>
<span class="line">            <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 处理窗口大小调整</span></span>
<span class="line">            window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"resize"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token constant">WIDTH</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span></span>
<span class="line">                <span class="token constant">HEIGHT</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 更新Three.js渲染器</span></span>
<span class="line">                threeRenderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token constant">WIDTH</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 更新Three.js相机宽高比确保正确渲染</span></span>
<span class="line">                threeCamera<span class="token punctuation">.</span>aspect <span class="token operator">=</span> <span class="token constant">WIDTH</span> <span class="token operator">/</span> <span class="token constant">HEIGHT</span><span class="token punctuation">;</span></span>
<span class="line">                threeCamera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 更新PixiJS渲染器</span></span>
<span class="line">                pixiRenderer<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token constant">WIDTH</span><span class="token punctuation">,</span> <span class="token constant">HEIGHT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>示例</li>
</ul>
<p><button @click="state4 = !state4">{{state4?&quot;关闭展示&quot;:&quot;开启展示&quot;}}</button></p>
<div v-if="state4">
    <iframe src="/note-front/animation/pixi/example/html/12.html" width="850" height="650"></iframe>
</div>
<h2 id="_2-5-鼠标轨迹" tabindex="-1"><a class="header-anchor" href="#_2-5-鼠标轨迹"><span>2.5 鼠标轨迹</span></a></h2>
<ul>
<li>代码</li>
</ul>
<div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre v-pre><code><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">    <span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> Assets<span class="token punctuation">,</span> Point<span class="token punctuation">,</span> MeshRope <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../js/pixi.mjs"</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// 创建应用程序</span></span>
<span class="line">      <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 初始化应用程序</span></span>
<span class="line">      <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span> </span>
<span class="line">          <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">"#1099bb"</span><span class="token punctuation">,</span> </span>
<span class="line">          <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">600</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token literal-property property">width</span><span class="token operator">:</span><span class="token number">800</span><span class="token punctuation">,</span> </span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 将应用程序添加到页面上</span></span>
<span class="line">      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 加载图片到纹理上</span></span>
<span class="line">      <span class="token keyword">const</span> trailTexture <span class="token operator">=</span> <span class="token keyword">await</span> Assets<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"../assets/images/trail.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">const</span> historyX <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> historyY <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// historySize决定了足迹的长度</span></span>
<span class="line">      <span class="token keyword">const</span> historySize <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// ropeSize决定了步道的平滑程度</span></span>
<span class="line">      <span class="token keyword">const</span> ropeSize <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 创建历史集合</span></span>
<span class="line">      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> historySize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//历史x点于历史y点都为20个</span></span>
<span class="line">        historyX<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        historyY<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token comment">// 创建轨迹点集合</span></span>
<span class="line">      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ropeSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">//创建一个网绳</span></span>
<span class="line">      <span class="token keyword">const</span> rope <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MeshRope</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">texture</span><span class="token operator">:</span> trailTexture<span class="token punctuation">,</span> points <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 应用于混合模式</span></span>
<span class="line">      rope<span class="token punctuation">.</span>blendmode <span class="token operator">=</span> <span class="token string">"add"</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>rope<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">let</span> mouseposition <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">//开启事件装填是</span></span>
<span class="line">      app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>eventMode <span class="token operator">=</span> <span class="token string">"static"</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">//点击范围</span></span>
<span class="line">      app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>hitArea <span class="token operator">=</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">//鼠标移动</span></span>
<span class="line">      app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">//判断是否为空 如果为空设定为0</span></span>
<span class="line">        mouseposition <span class="token operator">=</span> mouseposition <span class="token operator">||</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//鼠标的x轴 于鼠标的y轴</span></span>
<span class="line">        mouseposition<span class="token punctuation">.</span>x <span class="token operator">=</span> event<span class="token punctuation">.</span>global<span class="token punctuation">.</span>x<span class="token punctuation">;</span></span>
<span class="line">        mouseposition<span class="token punctuation">.</span>y <span class="token operator">=</span> event<span class="token punctuation">.</span>global<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// 监听动画并更新</span></span>
<span class="line">      app<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mouseposition<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 更新鼠标的值对于历史数据</span></span>
<span class="line">        <span class="token comment">// 每次鼠标移动都会留有x与y值</span></span>
<span class="line">        <span class="token comment">// 每帧都会获取对应的x与y轴</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">//删除最后一个</span></span>
<span class="line">        historyX<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//添加开头</span></span>
<span class="line">        historyX<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>mouseposition<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        historyY<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        historyY<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>mouseposition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 由于图片是个轨迹状的图片  变形后也是有尾迹的</span></span>
<span class="line">        <span class="token comment">//下面的三次插值 为了轨迹更平滑弄出的计算公式 只需调用即可</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 更新这些点以与历史记录相对应。</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ropeSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> p <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">// 使用三次插值平滑曲线，以防止出现锐边。</span></span>
<span class="line">          <span class="token keyword">const</span> ix <span class="token operator">=</span> <span class="token function">cubicInterpolation</span><span class="token punctuation">(</span>historyX<span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">/</span> ropeSize<span class="token punctuation">)</span> <span class="token operator">*</span> historySize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">const</span> iy <span class="token operator">=</span> <span class="token function">cubicInterpolation</span><span class="token punctuation">(</span>historyY<span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">/</span> ropeSize<span class="token punctuation">)</span> <span class="token operator">*</span> historySize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">          <span class="token comment">//当前点 等于计算出来的点</span></span>
<span class="line">          p<span class="token punctuation">.</span>x <span class="token operator">=</span> ix<span class="token punctuation">;</span></span>
<span class="line">          p<span class="token punctuation">.</span>y <span class="token operator">=</span> iy<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token doc-comment comment">/**</span>
<span class="line">       * 基于以下公式的三次插值 https://github.com/osuushi/Smooth.js</span>
<span class="line">       */</span></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">clipInput</span><span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>k <span class="token operator">></span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> k <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> arr<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">getTangent</span><span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">,</span> factor<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span>factor <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">clipInput</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> array<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">clipInput</span><span class="token punctuation">(</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">function</span> <span class="token function">cubicInterpolation</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> t<span class="token punctuation">,</span> tangentFactor <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">const</span> k <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">getTangent</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> tangentFactor<span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getTangent</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> tangentFactor<span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">clipInput</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">clipInput</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        t <span class="token operator">-=</span> k<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> t2 <span class="token operator">=</span> t <span class="token operator">*</span> t<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">const</span> t3 <span class="token operator">=</span> t <span class="token operator">*</span> t2<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> t3 <span class="token operator">-</span> <span class="token number">3</span> <span class="token operator">*</span> t2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>t3 <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> t2 <span class="token operator">+</span> t<span class="token punctuation">)</span> <span class="token operator">*</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> t3 <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> t2<span class="token punctuation">)</span> <span class="token operator">*</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>t3 <span class="token operator">-</span> t2<span class="token punctuation">)</span> <span class="token operator">*</span> m<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>示例</li>
</ul>
<p><button @click="state5 = !state5">{{state5?&quot;关闭展示&quot;:&quot;开启展示&quot;}}</button></p>
<div v-if="state5">
    <iframe src="/note-front/animation/pixi/example/html/13.html" width="850" height="650"></iframe>
</div>
<h2 id="_2-6-屏幕截图" tabindex="-1"><a class="header-anchor" href="#_2-6-屏幕截图"><span>2.6 屏幕截图</span></a></h2>
<ul>
<li>代码</li>
</ul>
<div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre v-pre><code><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">        <span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> Assets<span class="token punctuation">,</span> Container<span class="token punctuation">,</span> Sprite<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> TextStyle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../js/pixi.mjs"</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 创建应用程序</span></span>
<span class="line">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 初始化应用程序</span></span>
<span class="line">            <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">"#111"</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 添加用用程序画布到桌面上</span></span>
<span class="line">            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建一个新的应用程序</span></span>
<span class="line">            <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 创建容器框架</span></span>
<span class="line">            <span class="token keyword">const</span> containerFrame <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 将第一个容器添加到容器框架中</span></span>
<span class="line">            containerFrame<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 应用框架添加到舞台上</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>containerFrame<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 加载兔子图片纹理</span></span>
<span class="line">            <span class="token keyword">const</span> texture <span class="token operator">=</span> <span class="token keyword">await</span> Assets<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"../assets/images/bunny.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 创建5x5的兔子网格在容器上</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">25</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//纹理添加到精灵里</span></span>
<span class="line">                <span class="token keyword">const</span> bunny <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sprite</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                bunny<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">;</span></span>
<span class="line">                bunny<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">;</span></span>
<span class="line">                container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>bunny<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 移动框架容器到屏幕中央</span></span>
<span class="line">            containerFrame<span class="token punctuation">.</span>x <span class="token operator">=</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">            containerFrame<span class="token punctuation">.</span>y <span class="token operator">=</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 将兔子精灵居中放置在本地容器坐标中</span></span>
<span class="line">            <span class="token comment">// pivot 此显示对象在其局部空间中的旋转、缩放和倾斜中心。该位置是枢轴在父对象局部空间中的投影。</span></span>
<span class="line">            container<span class="token punctuation">.</span>pivot<span class="token punctuation">.</span>x <span class="token operator">=</span> container<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">            container<span class="token punctuation">.</span>pivot<span class="token punctuation">.</span>y <span class="token operator">=</span> container<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 监听动画更新</span></span>
<span class="line">            app<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">time</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//不断旋转容器！</span></span>
<span class="line">                <span class="token comment">//*使用delta创建与帧无关的变换*</span></span>
<span class="line">                container<span class="token punctuation">.</span>rotation <span class="token operator">-=</span> <span class="token number">0.01</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">let</span> screenshot<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 截取截图并下载</span></span>
<span class="line">            <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">takeScreenshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//如果对象不为空 直接清理</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>screenshot <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    screenshot<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">//渲染停止</span></span>
<span class="line">                app<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//当前东起转换成base64数据</span></span>
<span class="line">                <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>extract<span class="token punctuation">.</span><span class="token function">base64</span><span class="token punctuation">(</span>containerFrame<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 创建a标签</span></span>
<span class="line">                screenshot <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// a标签加入</span></span>
<span class="line">                document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>screenshot<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// a标签的位置</span></span>
<span class="line">                screenshot<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">"fixed"</span><span class="token punctuation">;</span></span>
<span class="line">                screenshot<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">"20px"</span><span class="token punctuation">;</span></span>
<span class="line">                screenshot<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">"20px"</span><span class="token punctuation">;</span></span>
<span class="line">                screenshot<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">"screenshot"</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//给予其赋值 如果点击就会下载</span></span>
<span class="line">                screenshot<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//创建图片对象</span></span>
<span class="line">                <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//宽度为屏幕的五分之一</span></span>
<span class="line">                image<span class="token punctuation">.</span>width <span class="token operator">=</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//设置url</span></span>
<span class="line">                image<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//将image的html代码 放入到截屏标签中</span></span>
<span class="line">                screenshot<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> image<span class="token punctuation">.</span>outerHTML<span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 设置渲染开始</span></span>
<span class="line">                app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            <span class="token comment">// 设置可以监控</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>eventMode <span class="token operator">=</span> <span class="token string">"static"</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 点击页面大小，整个页面</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>hitArea <span class="token operator">=</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 用户按下鼠标时 执行截图方法</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"pointerdown"</span><span class="token punctuation">,</span> takeScreenshot<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 新增文本风格</span></span>
<span class="line">            <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextStyle</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">fontFamily</span><span class="token operator">:</span> <span class="token string">"Roboto"</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token string">"#999"</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 创建截屏文字</span></span>
<span class="line">            <span class="token keyword">const</span> screenshotText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">"点击可以截屏"</span><span class="token punctuation">,</span> style <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 截屏文字x位置 屏幕的宽度减去文字宽度的一半    y位置 文字高度的一半</span></span>
<span class="line">            screenshotText<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">-</span> screenshotText<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            screenshotText<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>screenshotText<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 将文本添加到舞台上</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>screenshotText<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>示例</li>
</ul>
<p><button @click="state6 = !state6">{{state6?&quot;关闭展示&quot;:&quot;开启展示&quot;}}</button></p>
<div v-if="state6">
    <iframe src="/note-front/animation/pixi/example/html/14.html" width="850" height="650"></iframe>
</div>
<h2 id="_2-7-碰撞检测" tabindex="-1"><a class="header-anchor" href="#_2-7-碰撞检测"><span>2.7 碰撞检测</span></a></h2>
<ul>
<li>代码</li>
</ul>
<div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre v-pre><code><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">        <span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> Assets<span class="token punctuation">,</span> Point<span class="token punctuation">,</span> Sprite<span class="token punctuation">,</span> Texture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../js/pixi.mjs"</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 基于下面这篇文章</span></span>
<span class="line">        <span class="token comment">// https://spicyyoghurt.com/tutorials/html5-javascript-game-development/collision-detection-physics</span></span>
<span class="line">        <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 创建应用程序</span></span>
<span class="line">            <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 初始化应用程序</span></span>
<span class="line">            <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">"#111"</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 应用程序画布加载到页面上</span></span>
<span class="line">            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 对象交互的反应</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 红色方块的移动速度</span></span>
<span class="line">            <span class="token keyword">const</span> movementSpeed <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 两个物体之间的冲击力</span></span>
<span class="line">            <span class="token keyword">const</span> impulsePower <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//命中测试</span></span>
<span class="line">            <span class="token comment">//两个不同方格之间的基本AABB检查</span></span>
<span class="line">            <span class="token comment">//object1 绿色方块 object2 红色方块</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">testForAABB</span><span class="token punctuation">(</span><span class="token parameter">object1<span class="token punctuation">,</span> object2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> bounds1 <span class="token operator">=</span> object1<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> bounds2 <span class="token operator">=</span> object2<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 四个条件都满足才是出现碰撞</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token punctuation">(</span></span>
<span class="line">                    bounds1<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> bounds2<span class="token punctuation">.</span>x <span class="token operator">+</span> bounds2<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span></span>
<span class="line">                    bounds1<span class="token punctuation">.</span>x <span class="token operator">+</span> bounds1<span class="token punctuation">.</span>width <span class="token operator">></span> bounds2<span class="token punctuation">.</span>x <span class="token operator">&amp;&amp;</span></span>
<span class="line">                    bounds1<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> bounds2<span class="token punctuation">.</span>y <span class="token operator">+</span> bounds2<span class="token punctuation">.</span>height <span class="token operator">&amp;&amp;</span></span>
<span class="line">                    bounds1<span class="token punctuation">.</span>y <span class="token operator">+</span> bounds1<span class="token punctuation">.</span>height <span class="token operator">></span> bounds2<span class="token punctuation">.</span>y</span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//计算碰撞的结果，使我们能够给出一个脉冲将物体铲开</span></span>
<span class="line">            <span class="token comment">// object1 绿色方块 object2 红色方块</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">collisionResponse</span><span class="token punctuation">(</span><span class="token parameter">object1<span class="token punctuation">,</span> object2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 都不存在 直接返回0点位置</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>object1 <span class="token operator">||</span> <span class="token operator">!</span>object2<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// 碰撞位置</span></span>
<span class="line">                <span class="token keyword">const</span> vCollision <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>object2<span class="token punctuation">.</span>x <span class="token operator">-</span> object1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> object2<span class="token punctuation">.</span>y <span class="token operator">-</span> object1<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 斜线距离</span></span>
<span class="line">                <span class="token keyword">const</span> distance <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>object2<span class="token punctuation">.</span>x <span class="token operator">-</span> object1<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>object2<span class="token punctuation">.</span>x <span class="token operator">-</span> object1<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>object2<span class="token punctuation">.</span>y <span class="token operator">-</span> object1<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>object2<span class="token punctuation">.</span>y <span class="token operator">-</span> object1<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 碰撞规范 直角边/斜边</span></span>
<span class="line">                <span class="token keyword">const</span> vCollisionNorm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>vCollision<span class="token punctuation">.</span>x <span class="token operator">/</span> distance<span class="token punctuation">,</span> vCollision<span class="token punctuation">.</span>y <span class="token operator">/</span> distance<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 相对速度</span></span>
<span class="line">                <span class="token keyword">const</span> vRelativeVelocity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>object1<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>x <span class="token operator">-</span> object2<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>x<span class="token punctuation">,</span> object1<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>y <span class="token operator">-</span> object2<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 速度</span></span>
<span class="line">                <span class="token keyword">const</span> speed <span class="token operator">=</span> vRelativeVelocity<span class="token punctuation">.</span>x <span class="token operator">*</span> vCollisionNorm<span class="token punctuation">.</span>x <span class="token operator">+</span> vRelativeVelocity<span class="token punctuation">.</span>y <span class="token operator">*</span> vCollisionNorm<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 推动</span></span>
<span class="line">                <span class="token keyword">const</span> impulse <span class="token operator">=</span> <span class="token punctuation">(</span>impulsePower <span class="token operator">*</span> speed<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>object1<span class="token punctuation">.</span>mass <span class="token operator">+</span> object2<span class="token punctuation">.</span>mass<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>impulse <span class="token operator">*</span> vCollisionNorm<span class="token punctuation">.</span>x<span class="token punctuation">,</span> impulse <span class="token operator">*</span> vCollisionNorm<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//计算两个给定点之间的距离</span></span>
<span class="line">            <span class="token comment">// p1当前鼠标的x轴与y值的值，p2红色方块中心点的位置</span></span>
<span class="line">            <span class="token keyword">function</span> <span class="token function">distanceBetweenTwoPoints</span><span class="token punctuation">(</span><span class="token parameter">p1<span class="token punctuation">,</span> p2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> a <span class="token operator">=</span> p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> b <span class="token operator">=</span> p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//  Math.hypot函数返回所有参数的平方和的平方根，</span></span>
<span class="line">                <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">hypot</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 我们要移动的绿色方块</span></span>
<span class="line">            <span class="token keyword">const</span> greenSquare <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sprite</span><span class="token punctuation">(</span>Texture<span class="token punctuation">.</span><span class="token constant">WHITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 设置精灵所在的位置</span></span>
<span class="line">            greenSquare<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            greenSquare<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line">            greenSquare<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 给精灵涂上颜色</span></span>
<span class="line">            greenSquare<span class="token punctuation">.</span>tint <span class="token operator">=</span> <span class="token number">0x00ff00</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 非精灵自带的值 加速</span></span>
<span class="line">            greenSquare<span class="token punctuation">.</span>acceleration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">// 质量</span></span>
<span class="line">            greenSquare<span class="token punctuation">.</span>mass <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 你移动的方块</span></span>
<span class="line">            <span class="token keyword">const</span> redSquare <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sprite</span><span class="token punctuation">(</span>Texture<span class="token punctuation">.</span><span class="token constant">WHITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            redSquare<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            redSquare<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line">            redSquare<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line">            redSquare<span class="token punctuation">.</span>tint <span class="token operator">=</span> <span class="token number">0xff0000</span><span class="token punctuation">;</span></span>
<span class="line">            redSquare<span class="token punctuation">.</span>acceleration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            redSquare<span class="token punctuation">.</span>mass <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">const</span> mouseCoords <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>eventMode <span class="token operator">=</span> <span class="token string">"static"</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//设置可以点击的大小</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span>hitArea <span class="token operator">=</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//一直检测鼠标位置 并赋值</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                mouseCoords<span class="token punctuation">.</span>x <span class="token operator">=</span> event<span class="token punctuation">.</span>global<span class="token punctuation">.</span>x<span class="token punctuation">;</span></span>
<span class="line">                mouseCoords<span class="token punctuation">.</span>y <span class="token operator">=</span> event<span class="token punctuation">.</span>global<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 监听动画更新</span></span>
<span class="line">            app<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">time</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">const</span> delta <span class="token operator">=</span> time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 对两个方块应用减速，每次循环将加速度减少0.01%</span></span>
<span class="line">                <span class="token comment">// 这个点会越来越低</span></span>
<span class="line">                redSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>redSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">0.99</span><span class="token punctuation">,</span> redSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">0.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">0.99</span><span class="token punctuation">,</span> greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">0.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>redSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">,</span> greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 检查绿色方块是否移出屏幕 如果是这样，则沿该方向反向加速</span></span>
<span class="line">                <span class="token comment">//如果x轴 超过两侧</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>greenSquare<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> greenSquare<span class="token punctuation">.</span>x <span class="token operator">></span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span>greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>x<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// 如果y轴超过两侧</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>greenSquare<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> greenSquare<span class="token punctuation">.</span>y <span class="token operator">></span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span>greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>y<span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 如果绿色方块跳出警戒线，它会弹回到中间</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>greenSquare<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">30</span> <span class="token operator">||</span> greenSquare<span class="token punctuation">.</span>x <span class="token operator">></span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token number">30</span> <span class="token operator">||</span> greenSquare<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">30</span> <span class="token operator">||</span> greenSquare<span class="token punctuation">.</span>y <span class="token operator">></span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    greenSquare<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 在屏幕内执行下列动作（如果鼠标不在屏幕上，则不再更新）</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">></span> mouseCoords<span class="token punctuation">.</span>x <span class="token operator">||</span> mouseCoords<span class="token punctuation">.</span>x <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">||</span> app<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">></span> mouseCoords<span class="token punctuation">.</span>y <span class="token operator">||</span> mouseCoords<span class="token punctuation">.</span>y <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">// 获取红色方块的中心点</span></span>
<span class="line">                    <span class="token keyword">const</span> redSquareCenterPosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>redSquare<span class="token punctuation">.</span>x <span class="token operator">+</span> redSquare<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> redSquare<span class="token punctuation">.</span>y <span class="token operator">+</span> redSquare<span class="token punctuation">.</span>height <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 计算鼠标指针和红色方块</span></span>
<span class="line">                    <span class="token keyword">const</span> toMouseDirection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>mouseCoords<span class="token punctuation">.</span>x <span class="token operator">-</span> redSquareCenterPosition<span class="token punctuation">.</span>x<span class="token punctuation">,</span> mouseCoords<span class="token punctuation">.</span>y <span class="token operator">-</span> redSquareCenterPosition<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 使用上述方法计算出方向的角度  atan2 返回值再 -PI与PI之间 代表旋转的角度在0度与360度之间</span></span>
<span class="line">                    <span class="token keyword">const</span> angleToMouse <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>toMouseDirection<span class="token punctuation">.</span>y<span class="token punctuation">,</span> toMouseDirection<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 计算出方块应该行驶的速度，作为红色方块距离鼠标指针多远的函数</span></span>
<span class="line">                    <span class="token comment">// 算出方块中的斜线</span></span>
<span class="line">                    <span class="token keyword">const</span> distMouseRedSquare <span class="token operator">=</span> <span class="token function">distanceBetweenTwoPoints</span><span class="token punctuation">(</span>mouseCoords<span class="token punctuation">,</span> redSquareCenterPosition<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// 获取新的速度</span></span>
<span class="line">                    <span class="token keyword">const</span> redSpeed <span class="token operator">=</span> distMouseRedSquare <span class="token operator">*</span> movementSpeed<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 计算红色方块的加速度</span></span>
<span class="line">                    redSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleToMouse<span class="token punctuation">)</span> <span class="token operator">*</span> redSpeed<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleToMouse<span class="token punctuation">)</span> <span class="token operator">*</span> redSpeed<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 如果两个方块相撞</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">testForAABB</span><span class="token punctuation">(</span>greenSquare<span class="token punctuation">,</span> redSquare<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//计算以下两种情况之间应发生的加速度变化</span></span>
<span class="line">                    <span class="token comment">//每个方块都是碰撞的结果</span></span>
<span class="line">                    <span class="token keyword">const</span> collisionPush <span class="token operator">=</span> <span class="token function">collisionResponse</span><span class="token punctuation">(</span>greenSquare<span class="token punctuation">,</span> redSquare<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 设置两个方块的加速度变化</span></span>
<span class="line">                    redSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>collisionPush<span class="token punctuation">.</span>x <span class="token operator">*</span> greenSquare<span class="token punctuation">.</span>mass<span class="token punctuation">,</span> collisionPush<span class="token punctuation">.</span>y <span class="token operator">*</span> greenSquare<span class="token punctuation">.</span>mass<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">// 绿色获取相反的加速度</span></span>
<span class="line">                    greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span>collisionPush<span class="token punctuation">.</span>x <span class="token operator">*</span> redSquare<span class="token punctuation">.</span>mass<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">(</span>collisionPush<span class="token punctuation">.</span>y <span class="token operator">*</span> redSquare<span class="token punctuation">.</span>mass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// 加速度会一直消减的</span></span>
<span class="line">                <span class="token comment">//x位置 随着加速度一直变化</span></span>
<span class="line">                greenSquare<span class="token punctuation">.</span>x <span class="token operator">+=</span> greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>x <span class="token operator">*</span> delta<span class="token punctuation">;</span></span>
<span class="line">                greenSquare<span class="token punctuation">.</span>y <span class="token operator">+=</span> greenSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>y <span class="token operator">*</span> delta<span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//红色方块也是一样</span></span>
<span class="line">                redSquare<span class="token punctuation">.</span>x <span class="token operator">+=</span> redSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>x <span class="token operator">*</span> delta<span class="token punctuation">;</span></span>
<span class="line">                redSquare<span class="token punctuation">.</span>y <span class="token operator">+=</span> redSquare<span class="token punctuation">.</span>acceleration<span class="token punctuation">.</span>y <span class="token operator">*</span> delta<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 加载到舞台上</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>redSquare<span class="token punctuation">,</span> greenSquare<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>示例</li>
</ul>
<p><button @click="state7 = !state7">{{state7?&quot;关闭展示&quot;:&quot;开启展示&quot;}}</button></p>
<div v-if="state7">
    <iframe src="/note-front/animation/pixi/example/html/15.html" width="850" height="650"></iframe>
</div>
<h2 id="_2-8-旋转器" tabindex="-1"><a class="header-anchor" href="#_2-8-旋转器"><span>2.8 旋转器</span></a></h2>
<ul>
<li>代码</li>
</ul>
<div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html"><pre v-pre><code><span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">    <span class="token keyword">import</span> <span class="token punctuation">{</span> Application<span class="token punctuation">,</span> Assets<span class="token punctuation">,</span> Container<span class="token punctuation">,</span> Graphics<span class="token punctuation">,</span> Point<span class="token punctuation">,</span> Sprite <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"../js/pixi.mjs"</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 创建新的PixiJS应用实例</span></span>
<span class="line">        <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 初始化应用配置（开启抗锯齿/设置背景色/自动适应窗口）</span></span>
<span class="line">        <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span> </span>
<span class="line">            <span class="token literal-property property">antialias</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> </span>
<span class="line">            <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">"#1099bb"</span><span class="token punctuation">,</span> </span>
<span class="line">            <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 将应用画布添加到网页body中</span></span>
<span class="line">        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 加载纹理资源（旋转背景图/圆形元素图）</span></span>
<span class="line">        <span class="token keyword">await</span> Assets<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">"../assets/images/bg_scene_rotate.jpg"</span><span class="token punctuation">,</span> </span>
<span class="line">            <span class="token string">"../assets/images/bg_rotate.jpg"</span><span class="token punctuation">,</span> </span>
<span class="line">            <span class="token string">"../assets/images/circle.png"</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">/* ---------------------------------------</span>
<span class="line">        变化形式1 正方形径向变化</span>
<span class="line">        -------------------------------------- */</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token function-variable function">generateSpinner1</span> <span class="token operator">=</span> <span class="token parameter">position</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 新建一个容器</span></span>
<span class="line">            <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//容器的位置</span></span>
<span class="line">            container<span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//将容器加载到页面上</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//上面展示图片</span></span>
<span class="line">            <span class="token keyword">const</span> base <span class="token operator">=</span> Sprite<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/bg_scene_rotate.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            base<span class="token punctuation">.</span>width <span class="token operator">=</span> size<span class="token punctuation">;</span></span>
<span class="line">            base<span class="token punctuation">.</span>height <span class="token operator">=</span> size<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//下面展示图片</span></span>
<span class="line">            <span class="token keyword">const</span> bottom <span class="token operator">=</span> Sprite<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/bg_rotate.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            bottom<span class="token punctuation">.</span>width <span class="token operator">=</span> size<span class="token punctuation">;</span></span>
<span class="line">            bottom<span class="token punctuation">.</span>height <span class="token operator">=</span> size<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">const</span> mask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            mask<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//基础精灵加载上遮罩</span></span>
<span class="line">            base<span class="token punctuation">.</span>mask <span class="token operator">=</span> mask<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//整个页面也加上纹理</span></span>
<span class="line">            window<span class="token punctuation">.</span>mask <span class="token operator">=</span> mask<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//容器中将三者都加入子元素中</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>bottom<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//这个精灵在上面 但是mask 并没有大小 还是显示的是这个精灵  后续如果增大 会将整个纹理覆盖 只会显示下面的精灵</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 阶段</span></span>
<span class="line">            <span class="token keyword">let</span> phase <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//改变的是mask遮罩，这个数据以自身为中心点，所以会有负值 以坐标轴为原点调整要展示的数据</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token parameter">delta</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 更新阶段</span></span>
<span class="line">                <span class="token comment">// 每次加上每帧时间的的60分之一</span></span>
<span class="line">                phase <span class="token operator">+=</span> delta <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 阶段每次除以360度 如果能除下 phase会第一次等于0</span></span>
<span class="line">                phase <span class="token operator">%=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 计算目标点</span></span>
<span class="line">                <span class="token comment">//通过正弦与余弦计算 位置</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 2π 一个循环</span></span>
<span class="line">                <span class="token comment">// 开始值(phase - Math.PI / 2)  负二分之一π 值为0</span></span>
<span class="line">                <span class="token comment">// sin 0 到1 1到-1 -1到0</span></span>
<span class="line">                <span class="token keyword">const</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>phase <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 2π 一个循环</span></span>
<span class="line">                <span class="token comment">// 开始值(phase - Math.PI / 2)  负二分之一π 值为-1</span></span>
<span class="line">                <span class="token comment">// sin -1 到1 然后1到-1</span></span>
<span class="line">                <span class="token keyword">const</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>phase <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// console.log(delta, phase, phase - Math.PI / 2, x, y);</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 四个边 每两个数字是一个点</span></span>
<span class="line">                <span class="token keyword">const</span> segments <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 上部</span></span>
<span class="line">                    <span class="token punctuation">[</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 右边</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 下边</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 左边</span></span>
<span class="line">                <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 找到线段相交的点</span></span>
<span class="line">                <span class="token keyword">let</span> intersection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//弯曲值为0</span></span>
<span class="line">                <span class="token keyword">let</span> winding <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 每次循环都按照顺时针循环</span></span>
<span class="line">                <span class="token comment">// 循环中每次都按照 每条边进行循环</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> segments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">const</span> segment <span class="token operator">=</span> segments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//获取相交的x与y点</span></span>
<span class="line">                    <span class="token keyword">const</span> hit <span class="token operator">=</span> <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> segment<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> segment<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> segment<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> segment<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">//如果相交点存在</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        intersection <span class="token operator">=</span> hit<span class="token punctuation">;</span></span>
<span class="line">                        <span class="token comment">//判断如果相交的点为负数 就是第五部分</span></span>
<span class="line">                        <span class="token comment">// 从最上边的中间开始走到末尾 winding等于0</span></span>
<span class="line">                        <span class="token comment">// 从最上边开始走到中间 winding 等于 4</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> winding <span class="token operator">=</span> hit<span class="token punctuation">.</span>x <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">else</span> winding <span class="token operator">=</span> i<span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//角度</span></span>
<span class="line">                <span class="token keyword">const</span> corners <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 右上角</span></span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 右下角</span></span>
<span class="line">                    <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 左下角</span></span>
<span class="line">                    <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 左上角</span></span>
<span class="line">                    <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 结束点</span></span>
<span class="line">                <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 重绘遮罩</span></span>
<span class="line">                mask<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>intersection<span class="token punctuation">.</span>x<span class="token punctuation">,</span> intersection<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 充满角</span></span>
<span class="line">                <span class="token comment">// 直接连接可以连接的每个点 越往后连接的越少</span></span>
<span class="line">                <span class="token comment">// 开始值为0 形成一个 缺少（0度 - 45度）的多边形</span></span>
<span class="line">                <span class="token comment">// 值为1 形成一个 缺少0度到135度的多边形</span></span>
<span class="line">                <span class="token comment">// 值为2 形成一个 缺少0度到225度的多边形</span></span>
<span class="line">                <span class="token comment">// 值为3 形成一个 缺少0度到315度的多边形</span></span>
<span class="line">                <span class="token comment">// 值为4 形成一个 缺少0度到360度的多边形</span></span>
<span class="line"></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> winding<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> corners<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//连接x与y点</span></span>
<span class="line">                    mask<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>corners<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corners<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//填充红色 只要填充颜色都会展示数据</span></span>
<span class="line">                mask<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xff0000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">/* -----------------------</span>
<span class="line">        Spinner. 3 缩放球</span>
<span class="line">        ---------------------- */</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token function-variable function">generateSpinner2</span> <span class="token operator">=</span> <span class="token parameter">position</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//新建一个容器</span></span>
<span class="line">            <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//容器位置判断</span></span>
<span class="line">            container<span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//在舞台上添加</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//设置大小</span></span>
<span class="line">            <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//小球数量</span></span>
<span class="line">            <span class="token keyword">const</span> ballAmount <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//球的集合</span></span>
<span class="line">            <span class="token keyword">const</span> balls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//数量循环</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ballAmount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">//加载纹理</span></span>
<span class="line">                <span class="token keyword">const</span> ball <span class="token operator">=</span> Sprite<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/circle.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//设置锚点</span></span>
<span class="line">                ball<span class="token punctuation">.</span>anchor<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//加入舞台上</span></span>
<span class="line">                container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>ball<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//设置球的位置</span></span>
<span class="line">                <span class="token comment">//通过余弦与正弦设置x与y 环绕着中心点放位置</span></span>
<span class="line">                <span class="token comment">//(i / ballAmount) * Math.PI * 2  </span></span>
<span class="line">                <span class="token comment">// 计算结果: 0  2π/7（约0.88） 4π/7（约1.76） 6π/7（约2.64） 8π/7（约3.52） 10π/7（约4.40） 12π/7（约5.28）</span></span>
<span class="line">                <span class="token comment">//cos 1 0.62 -0.22 -0.90 -0.90 -0.22 0.62</span></span>
<span class="line">                <span class="token comment">//sin 0 0.78 0.97 0.43 -0.43 -0.97 -0.78</span></span>
<span class="line">                <span class="token comment">//最后除以3 防止超过设定的值的二分之一</span></span>
<span class="line">                <span class="token comment">//以size/2为坐标轴原点，所有的数据围绕着这个点循环</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//最终的x与y的坐标   83.3 50   70.7 76.0   42.5 82.4   19.9 64.4   19.9 35.5   42.5 17.5   70.7 23.9</span></span>
<span class="line">                ball<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span></span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">/</span> ballAmount<span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> </span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">/</span> ballAmount<span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//加入集合</span></span>
<span class="line">                balls<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ball<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 阶段</span></span>
<span class="line">            <span class="token keyword">let</span> phase <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> <span class="token parameter">delta</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 更新阶段</span></span>
<span class="line">                phase <span class="token operator">+=</span> delta <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">;</span></span>
<span class="line">                phase <span class="token operator">%=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 修改球的大小</span></span>
<span class="line">                balls<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//根据页面缓缓增大</span></span>
<span class="line">                    <span class="token comment">//使用这些数据 0  π/7  2π/7  3π/7 4π/7  5π/7  6π/7 减去一个0-2π的值</span></span>
<span class="line">                    <span class="token comment">// 最后值都在-1到1之间循环</span></span>
<span class="line">                    <span class="token comment">//因为减去的相同，都是按照曲线获取的值 相隔一个π/7</span></span>
<span class="line">                    <span class="token keyword">const</span> sin <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">/</span> ballAmount<span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">-</span> phase<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token comment">// 将sin与自身相乘，得到更陡峭的边缘。</span></span>
<span class="line">                    <span class="token comment">// 0.5 - 0.9 再0.9 - 0.5 定期修改</span></span>
<span class="line">                    <span class="token comment">// 最低是0.5 也是值为0的时候</span></span>
<span class="line">                    <span class="token comment">// Math.abs 计算数据的绝对值，不管是什么最后都等于正数</span></span>
<span class="line">                    b<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>sin <span class="token operator">*</span> sin <span class="token operator">*</span> sin <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">/* ---------------------</span>
<span class="line">        Spinner 3. 径向遮罩</span>
<span class="line">        -------------------- */</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token function-variable function">generateSpinner3</span> <span class="token operator">=</span> <span class="token parameter">position</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//新建一个容器</span></span>
<span class="line">            <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//判断位置</span></span>
<span class="line">            container<span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//容器加载到舞台上</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//加载精灵</span></span>
<span class="line">            <span class="token keyword">const</span> base <span class="token operator">=</span> Sprite<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/bg_scene_rotate.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//设置大小</span></span>
<span class="line">            base<span class="token punctuation">.</span>width <span class="token operator">=</span> size<span class="token punctuation">;</span></span>
<span class="line">            base<span class="token punctuation">.</span>height <span class="token operator">=</span> size<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//设置遮罩</span></span>
<span class="line">            <span class="token keyword">const</span> mask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//遮罩中心位置</span></span>
<span class="line">            mask<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//设置遮罩</span></span>
<span class="line">            base<span class="token punctuation">.</span>mask <span class="token operator">=</span> mask<span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//也是整个页面的遮罩</span></span>
<span class="line">            window<span class="token punctuation">.</span>mask <span class="token operator">=</span> mask<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//精灵与遮罩都加入到容器中</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//阶段</span></span>
<span class="line">            <span class="token keyword">let</span> phase <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> <span class="token parameter">delta</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 更新阶段 phase 是一个不断增大的数 如果大于2π 就会重新开始</span></span>
<span class="line">                phase <span class="token operator">+=</span> delta <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">;</span></span>
<span class="line">                phase <span class="token operator">%=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//开始角度 -90°  -0.44 也是坐标轴上方的竖线</span></span>
<span class="line">                <span class="token keyword">const</span> angleStart <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//角度</span></span>
<span class="line">                <span class="token keyword">const</span> angle <span class="token operator">=</span> phase <span class="token operator">+</span> angleStart<span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//圆角</span></span>
<span class="line">                <span class="token keyword">const</span> radius <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// x1与y1 根据余弦与正弦获取正确的数据</span></span>
<span class="line">                <span class="token keyword">const</span> x1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleStart<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> y1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleStart<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 重新绘制遮罩</span></span>
<span class="line">                <span class="token comment">// 从0点开始 目标点x1与y1 不停变化的数据</span></span>
<span class="line">                <span class="token comment">// arc 前两个参数 弧的中心点 弧度的半径  弧度的开始点 弧度的结束点 是否逆时针(false代表顺时针)</span></span>
<span class="line">                <span class="token comment">// 代表先从原点画 画到目标点 连接一个弧线  再次连接到原点 形成一个扇形  最后加入颜色</span></span>
<span class="line">                mask<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> radius<span class="token punctuation">,</span> angleStart<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xff0000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">/* ---------------------------------</span>
<span class="line">        Spinner 4. 围绕正方形的边</span>
<span class="line">        ------------------------------- */</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token function-variable function">generateSpinner4</span> <span class="token operator">=</span> <span class="token parameter">position</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//新建一个容器</span></span>
<span class="line">            <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//容器的位置</span></span>
<span class="line">            container<span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//圆弧半径</span></span>
<span class="line">            <span class="token keyword">const</span> arcRadius <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//初始化精灵</span></span>
<span class="line">            <span class="token keyword">const</span> base <span class="token operator">=</span> Sprite<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"../assets/images/bg_scene_rotate.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//宽度与高度</span></span>
<span class="line">            base<span class="token punctuation">.</span>width <span class="token operator">=</span> size<span class="token punctuation">;</span></span>
<span class="line">            base<span class="token punctuation">.</span>height <span class="token operator">=</span> size<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 为了获得更好的性能，预先对资产进行设定比遮罩要好。</span></span>
<span class="line">            <span class="token keyword">const</span> roundingMask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 围绕的遮罩 这个遮罩有颜色 会一直展示</span></span>
<span class="line">            roundingMask<span class="token punctuation">.</span><span class="token function">roundRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> size<span class="token punctuation">,</span> arcRadius<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0x0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            base<span class="token punctuation">.</span>mask <span class="token operator">=</span> roundingMask<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 边缘也可以用图像代替</span></span>
<span class="line">            <span class="token keyword">const</span> lineSize <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> edge <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//创建一个圆角边 是边框(stroke)类型的，外部是红色</span></span>
<span class="line">            edge<span class="token punctuation">.</span><span class="token function">roundRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> size<span class="token punctuation">,</span> arcRadius<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> lineSize<span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xff0000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//此示例中的Mask的工作方式与示例1基本相同。</span></span>
<span class="line">            <span class="token comment">//除了它被反转并在边缘中以直线计算遮罩。</span></span>
<span class="line">            <span class="token keyword">const</span> mask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//内部的遮罩</span></span>
<span class="line">            mask<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            edge<span class="token punctuation">.</span>mask <span class="token operator">=</span> mask<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>roundingMask<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>edge<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">let</span> phase <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> <span class="token parameter">delta</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 更新阶段</span></span>
<span class="line">                <span class="token comment">// 除以160 需要更长的时间去获取</span></span>
<span class="line">                phase <span class="token operator">+=</span> delta <span class="token operator">/</span> <span class="token number">160</span><span class="token punctuation">;</span></span>
<span class="line">                phase <span class="token operator">%=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 随时间变化 通过余弦与正弦确认x y变化 计算目标点</span></span>
<span class="line">                <span class="token keyword">const</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>phase <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">const</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>phase <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 线段计算 四个边</span></span>
<span class="line">                <span class="token keyword">const</span> segments <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 上边</span></span>
<span class="line">                    <span class="token punctuation">[</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 右边</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 下边</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span> size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 左边</span></span>
<span class="line">                <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 在每个分段处，应屏蔽到哪个目录继续</span></span>
<span class="line">                <span class="token keyword">let</span> outDir <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 找到线段相交的点</span></span>
<span class="line">                <span class="token keyword">let</span> intersection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">let</span> winding <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">//在找到撞击后，在撞击线尺寸之前，线应该继续朝哪个方向前进</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> segments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">const</span> segment <span class="token operator">=</span> segments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token comment">//相交的点</span></span>
<span class="line">                    <span class="token keyword">const</span> hit <span class="token operator">=</span> <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> segment<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> segment<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> segment<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> segment<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hit<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        intersection <span class="token operator">=</span> hit<span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> winding <span class="token operator">=</span> hit<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">else</span> winding <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">-</span> i<span class="token punctuation">;</span> <span class="token comment">//这里发生了变动 1与3调换位置</span></span>
<span class="line">                        <span class="token comment">//判断 屏蔽目录</span></span>
<span class="line">                        outDir <span class="token operator">=</span> outDir<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">                        <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//角度</span></span>
<span class="line">                <span class="token keyword">const</span> corners <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">                    <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">,</span> <span class="token comment">// 左上角,</span></span>
<span class="line">                    <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">,</span></span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span> <span class="token comment">// 左下角</span></span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span></span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span> <span class="token comment">// 右下角</span></span>
<span class="line">                    size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> lineSize<span class="token punctuation">,</span></span>
<span class="line">                    <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">,</span> <span class="token comment">// 左上角</span></span>
<span class="line">                <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 重绘遮罩</span></span>
<span class="line">                <span class="token comment">// 这些形成一条直线，是竖着的一条线</span></span>
<span class="line">                mask<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>size <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> lineSize<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">// 填充角度</span></span>
<span class="line">                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> winding<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">//循环中连接不同的角</span></span>
<span class="line">                    mask<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>corners<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> corners<span class="token punctuation">[</span>i <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//首先连接短线的上边与下边</span></span>
<span class="line">                <span class="token comment">//然后连接到原点</span></span>
<span class="line">                <span class="token comment">//最后填充颜色</span></span>
<span class="line">                mask<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>intersection<span class="token punctuation">.</span>x <span class="token operator">+</span> outDir<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> lineSize <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> intersection<span class="token punctuation">.</span>y <span class="token operator">+</span> outDir<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> lineSize <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>intersection<span class="token punctuation">.</span>x<span class="token punctuation">,</span> intersection<span class="token punctuation">.</span>y<span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xff0000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">/* ---------------------</span>
<span class="line">        Spinner 5. 圆矩形定长旋转器</span>
<span class="line">        -------------------- */</span></span>
<span class="line">        <span class="token keyword">const</span> <span class="token function-variable function">generateSpinner5</span> <span class="token operator">=</span> <span class="token parameter">position</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">//创建容器</span></span>
<span class="line">            <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//设置位置</span></span>
<span class="line">            container<span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span></span>
<span class="line">            app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//设置半个圆 颜色红色</span></span>
<span class="line">            <span class="token keyword">const</span> halfCircle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xff0000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//设置位置的中心点</span></span>
<span class="line">            halfCircle<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//设置圆角矩形 白色</span></span>
<span class="line">            <span class="token keyword">const</span> rectangle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Graphics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roundRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xffffff</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//圆角矩形的遮罩使用半圆</span></span>
<span class="line">            rectangle<span class="token punctuation">.</span>mask <span class="token operator">=</span> halfCircle<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//再容器中添加圆角矩形与半圆遮罩</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>rectangle<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            container<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>halfCircle<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">//阶段</span></span>
<span class="line">            <span class="token keyword">let</span> phase <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> <span class="token parameter">delta</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 更新阶段</span></span>
<span class="line">                phase <span class="token operator">+=</span> delta <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">;</span></span>
<span class="line">                phase <span class="token operator">%=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">                <span class="token comment">//设置旋转角度，每次角度变化 都会将数据改变</span></span>
<span class="line">                halfCircle<span class="token punctuation">.</span>rotation <span class="token operator">=</span> phase<span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">const</span> onTick <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token function">generateSpinner1</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token function">generateSpinner2</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token function">generateSpinner3</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">270</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token function">generateSpinner4</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">380</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token function">generateSpinner5</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">490</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// Listen for animate update</span></span>
<span class="line">        app<span class="token punctuation">.</span>ticker<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">time</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// Call tick handling for each spinner.</span></span>
<span class="line">            onTick<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">cb</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">cb</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token doc-comment comment">/**</span>
<span class="line">         * 帮助方法</span>
<span class="line"></span>
<span class="line">                Paul Bourke的线截距数学http://paulbourke.net/geometry/pointlineplane/</span>
<span class="line">                确定两条线段的交点</span>
<span class="line">                如果线条不相交，则返回FALSE</span>
<span class="line">                对原始代码进行了修改，以匹配pixi示例的linting规则。</span>
<span class="line"></span>
<span class="line">                前四个参数与后四个参数都代表 一条线</span>
<span class="line">                每两个参数代表一个点 </span>
<span class="line">        */</span></span>
<span class="line">        <span class="token keyword">function</span> <span class="token function">intersect</span><span class="token punctuation">(</span><span class="token parameter">x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x3<span class="token punctuation">,</span> y3<span class="token punctuation">,</span> x4<span class="token punctuation">,</span> y4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 检查每条线的起始位置是否相同 如果相同是个点 不符合判断 直接返回false</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x1 <span class="token operator">===</span> x2 <span class="token operator">&amp;&amp;</span> y1 <span class="token operator">===</span> y2<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>x3 <span class="token operator">===</span> x4 <span class="token operator">&amp;&amp;</span> y3 <span class="token operator">===</span> y4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 分母</span></span>
<span class="line">            <span class="token keyword">const</span> denominator <span class="token operator">=</span> <span class="token punctuation">(</span>y4 <span class="token operator">-</span> y3<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>x4 <span class="token operator">-</span> x3<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 线条是平行的</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>denominator <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">const</span> ua <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x4 <span class="token operator">-</span> x3<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y3<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>y4 <span class="token operator">-</span> y3<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x1 <span class="token operator">-</span> x3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> denominator<span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> ub <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y1 <span class="token operator">-</span> y3<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x1 <span class="token operator">-</span> x3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> denominator<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 是沿线段的交点</span></span>
<span class="line">            <span class="token keyword">if</span> <span class="token punctuation">(</span>ua <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> ua <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">||</span> ub <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> ub <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment">// 返回一个具有交点x和y坐标的对象</span></span>
<span class="line">            <span class="token keyword">const</span> x <span class="token operator">=</span> x1 <span class="token operator">+</span> ua <span class="token operator">*</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">const</span> y <span class="token operator">=</span> y1 <span class="token operator">+</span> ua <span class="token operator">*</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>示例</li>
</ul>
<p><button @click="state8 = !state8">{{state8?&quot;关闭展示&quot;:&quot;开启展示&quot;}}</button></p>
<div v-if="state8">
    <iframe src="/note-front/animation/pixi/example/html/16.html" width="850" height="650"></iframe>
</div></div></template>


<script lang="ts" setup>
    import {ref} from 'vue'
    let state1 = ref(false)
    let state2 = ref(false)
    let state3 = ref(false)
    let state4 = ref(false)
    let state5 = ref(false)
    let state6 = ref(false)
    let state7 = ref(false)
    let state8 = ref(false)
</script>