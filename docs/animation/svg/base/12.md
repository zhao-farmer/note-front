# 十二、动画元素


## 12.1 svg动画介绍

### 12.1.1 css动画

CSS动画是通过CSS3中的animation和transition属性来实现SVG动画的一种方式。它适用于简单的动画效果，如颜色变化、位置移动等。


- 代码示例

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <!-- CSS动画 -->
    <style>
        #circle {
            animation: pulse 2s infinite; /* 应用动画 */
        }
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <!-- SVG图形 -->
    <svg width="100" height="100">
        <circle cx="50" cy="50" r="20" fill="tomato" id="circle"></circle>
    </svg>
</body>
</html>
```

- 运行结果

<iframe src="/note-front/animation/svg/base/html/10.html" width="300" height="150"></iframe>


### 12.1.2 JavaScript动画 

JavaScript动画是通过编写脚本来控制SVG元素属性的变化。这种方式适用于需要复杂逻辑或与用户交互的动画。

- 代码示例

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Document</title>
</head>
<body>
    <!-- SVG图形 -->
    <svg width="100" height="100">
        <circle cx="50" cy="50" r="20" fill="green" id="circle-js"></circle>
    </svg>

    <script>
        var circle = document.getElementById("circle-js");
        var radius = 20;
        let step = 0.1;
        let state = 0;
        function render() {
            if (radius > 50) {
                state = 0;
            } else if (radius < 20) {
                state = 1;
            }

            if (state == 0) {
                radius -= step;
            }

            if (state == 1) {
                radius += step;
            }

            circle.setAttribute("r", radius); // 更新半径
            requestAnimationFrame(render);
        }

        render();
    </script>
</body>
</html>
```

- 运行结果

<iframe src="/note-front/animation/svg/base/html/11.html" width="300" height="150"></iframe>


### 12.1.3 SMIL动画 

SMIL动画是一种内置于SVG中的动画规范，通过`<animate>`、`<animateTransform>`等元素直接在SVG内部定义动画。

- 代码示例：

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <svg width="100" height="100">
        <rect width="50" height="50" fill="blue">
          <animate attributeName="x" from="0" to="50" dur="2s" repeatCount="indefinite" />
        </rect>
    </svg>
</body>
</html>
```

- 运行结果

<iframe src="/note-front/animation/svg/base/html/12.html" width="300" height="150"></iframe>


## 12.2 `<animateTransform>` 动画属性


`<animateTransform>` 是 SVG 中用于 **变换（transform）动画** 的标签，它允许对 `translate`、`scale`、`rotate`、`skewX` 和 `skewY` 进行动画操作。



###  12.2.1  **`<animateTransform>` 属性**

| 属性名 | 作用  | 示例值 |
| --- | --- | --- |
| **attributeName** | 需要动画化的属性，**必须是 `"transform"`** | `"transform"` |
| **type** | 变换类型，可选值：`translate`、`scale`、`rotate`、`skewX`、`skewY` | `"translate"` |
| **from** | 动画起始值（可选） | `"0"` `"1,1"` `"0 50 50"` |
| **to** | 动画结束值 | `"100"` `"2,2"` `"360 50 50"` |
| **by** | 增量方式的动画（可选，不能与 `to` 一起使用） | `"50"` |
| **dur** | 动画时长，支持 `s`（秒） 和 `ms`（毫秒） | `"2s"` |
| **repeatCount** | 动画重复次数，`indefinite` 表示无限循环 | `"indefinite"` |
| **begin** | 动画开始时间： 时间值(`1s`、`200ms`)、事件(`click`) 、相对时间(`click + 1s`)、其他动画结束触发(`previous.end`)） | `"1s"` `"click"` |
| **fill** | 动画结束后如何处理：`freeze` 保持最终状态，`remove` 恢复初始状态(默认) | `"freeze"` |
| **additive** | 处理多动画效果： `sum` 叠加、`replace`覆盖效果(默认) | `"sum"` `"replace"` |



### 12.2.2 **`type` 变换类型示例**

1. **`translate`（平移动画）**

```xml{5}
<svg width="200" height="100">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```


**效果**：矩形在 `X` 轴方向从 `0` 移动到 `100px`，不断重复。

<svg width="200" height="100">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" dur="2s" repeatCount="indefinite"/>
    </rect>
</svg>

2. **`scale`（缩放动画）**

```xml{5}
<svg width="200" height="100">
    <circle cx="50" cy="50" r="20" fill="red">
        <animateTransform 
            attributeName="transform" 
            type="scale" 
            from="1" 
            to="2" 
            dur="1s" 
            repeatCount="indefinite"
        />
    </circle>
</svg>
```

**效果**：圆形在 `1x` 和 `2x` 之间缩放。

<svg width="200" height="100">
    <circle cx="50" cy="50" r="20" fill="red">
        <animateTransform attributeName="transform" type="scale" from="1" to="2" dur="1s" repeatCount="indefinite"/>
    </circle>
</svg>

3. **`rotate`（旋转动画）**

```xml{5}
<svg width="200" height="200">
    <rect x="75" y="75" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="rotate" 
            from="0 100 100" 
            to="360 100 100" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

**效果**：矩形围绕 **(100,100)** 点旋转 **360°**。

<svg width="200" height="200">
    <rect x="75" y="75" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="rotate" from="0 100 100" to="360 100 100" dur="2s" repeatCount="indefinite"/>
    </rect>
</svg>


**旋转格式**：

*   `"角度 旋转中心X 旋转中心Y"`（如 `"360 100 100"`）
*   如果省略旋转中心，则默认围绕图形自身中心旋转。


4. **`skewX`（X 轴倾斜动画）**

```xml{5}
<svg width="200" height="100">
    <rect x="50" y="20" width="50" height="50" fill="purple">
        <animateTransform 
            attributeName="transform" 
            type="skewX" 
            from="0" 
            to="30" 
            dur="1s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

**效果**：矩形沿 `X` 轴倾斜 **30°**。

<svg width="200" height="100">
    <rect x="50" y="20" width="50" height="50" fill="purple">
        <animateTransform attributeName="transform" type="skewX" from="0" to="30" dur="1s" repeatCount="indefinite"/>
    </rect>
</svg>

5. **`skewY`（Y 轴倾斜动画）**

```xml{5}
<svg width="200" height="100">
    <rect x="50" y="20" width="50" height="50" fill="orange">
        <animateTransform 
            attributeName="transform" 
            type="skewY" 
            from="0" 
            to="30" 
            dur="1s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

**效果**：矩形沿 `Y` 轴倾斜 **30°**。

<svg width="200" height="100">
    <rect x="50" y="20" width="50" height="50" fill="orange">
        <animateTransform attributeName="transform" type="skewY" from="0" to="30" dur="1s" repeatCount="indefinite"/>
    </rect>
</svg>

### 12.2.3 `to` 与 `from`

from变换的起始值，to变换的结束值

对于不同动画类型有不同解释

1. `translate` 位移

- 代码

```xml{6-7,15-16}
<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100" 
            dur="2s" 
            repeatCount="indefinite"/>
    </rect>
    <rect x="10" y="20" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0 0" 
            to="100 100" 
            dur="2s" 
            repeatCount="indefinite"/>
    </rect>
</svg>
```

- svg图

<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="10" y="20" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="translate" from="0 0" to="100 100" dur="2s" repeatCount="indefinite" />
    </rect>
</svg>


- 属性值
    - from/to 一个值：值为x轴,y默认为0
    - from/to 二个值：值为x,y

2. `scale` 缩放

- 代码

```xml{6-7,16-17}
<svg width="300" height="300">
    <circle cx="50" cy="50" r="20" fill="red">
        <animateTransform 
            attributeName="transform" 
            type="scale" 
            from="1" 
            to="2" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </circle>
    <circle cx="100" cy="50" r="20" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="scale" 
            from="1 1" 
            to="2 3" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </circle>
</svg>
```

- svg 图

<svg width="300" height="300">
    <circle cx="50" cy="50" r="20" fill="red">
        <animateTransform attributeName="transform" type="scale" from="1" to="2" dur="2s" repeatCount="indefinite" />
    </circle>
    <circle cx="100" cy="50" r="20" fill="green">
        <animateTransform attributeName="transform" type="scale" from="1 1" to="2 3" dur="2s" repeatCount="indefinite" />
    </circle>
</svg>



- 属性值
    - from/to 一个值：x轴与y轴都按照这个比例缩小
    - from/to 二个值：x轴，y轴 按照不同比例缩小

3. `rotate` 旋转

```xml{6-7,16-17,26-27}
<svg width="300" height="300">
    <rect x="75" y="75" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="rotate" 
            from="0" 
            to="360" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <rect x="75" y="75" width="50" height="50" fill="red">
        <animateTransform 
            attributeName="transform" 
            type="rotate" 
            from="0 100 100" 
            to="360 100 100" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <rect x="75" y="75" width="50" height="50" fill="blue">
        <animateTransform 
            attributeName="transform" 
            type="rotate" 
            from="0 75 75" 
            to="360 150 150" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

- svg 图

<svg width="300" height="300">
    <rect x="75" y="75" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="rotate" from="0" to="360" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="75" y="75" width="50" height="50" fill="red">
        <animateTransform attributeName="transform" type="rotate" from="0 100 100" to="360 100 100" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="75" y="75" width="50" height="50" fill="blue">
        <animateTransform attributeName="transform" type="rotate" from="0 75 75" to="360 150 150" dur="2s" repeatCount="indefinite" />
    </rect>
</svg>



- 属性值
    - from/to 一个值：值为旋转角度，圆心的位置始终为0,0
    - from/to 三个值：第一个值是旋转角度，二值、三值为圆心位置x，y位置
    - 如果from与to 二值、三值一致 一致在原地旋转，不一致就会变化位置


4. `skewX`与`skewY` 倾斜

```xml{6-7,16-17}
<svg width="200" height="200">
    <rect x="50" y="20" width="50" height="50" fill="purple">
        <animateTransform 
            attributeName="transform" 
            type="skewX" 
            from="0" 
            to="30" 
            dur="1s" 
            repeatCount="indefinite"
        />
    </rect>

    <rect x="50" y="20" width="50" height="50" fill="orange">
        <animateTransform 
            attributeName="transform" 
            type="skewY" 
            from="0" 
            to="30" 
            dur="1s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

- svg 图

<svg width="200" height="200">
    <rect x="50" y="20" width="50" height="50" fill="purple">
        <animateTransform attributeName="transform" type="skewX" from="0" to="30" dur="1s" repeatCount="indefinite" />
    </rect>
    <rect x="50" y="20" width="50" height="50" fill="orange">
        <animateTransform attributeName="transform" type="skewY" from="0" to="30" dur="1s" repeatCount="indefinite" />
    </rect>
</svg>


- 属性值
    - from/to 一个值：倾斜角度


### 12.2.4 `by` 与 `to`

- 代码

```xml{7,17}
<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="50" 
            to="100"
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <rect x="10" y="120" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="50" 
            by="50"
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

- svg 图

<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform attributeName="transform" type="translate" from="50" to="100" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="10" y="120" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="translate" from="50" by="50" dur="2s" repeatCount="indefinite" />
    </rect>
</svg>


- 两者的区别
    - to属性直接指定了变换的最终值。
    - by属性指定了变换的增量。


### 12.2.5 `dur` 与 `repeatCount`

- 代码

```xml
<svg width="200" height="200">
    <!-- 执行三次 执行总时长6s -->
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100"
            dur="2s" 
            repeatCount="3"
        />
    </rect>
    <!-- repeatCount等于indefinite 是无限时间 -->
    <rect x="10" y="120" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100"
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```


- svg 图

<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" dur="2s" repeatCount="3" />
    </rect>
    <rect x="10" y="120" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" dur="2s" repeatCount="indefinite" />
    </rect>
</svg>



- 属性
    - dur属性：每次动画持续的时间。
    - repeatCount属性：重复动画的次数。
    - 动画总时长 dur * repeatCount


### 12.2.6 `begin` 触发条件

1. 直接使用

- 代码

```xml{18,29,40}
<svg width="200" height="300">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100"
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100"
            begin="1s"
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <rect x="10" y="140" width="50" height="50" fill="red">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100"
            begin="click"
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <rect x="10" y="200" width="50" height="50" fill="purple">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100"
            begin="click+1s"
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

- svg 图

<svg width="200" height="300">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" begin="1s" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="10" y="140" width="50" height="50" fill="red">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" begin="click" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="10" y="200" width="50" height="50" fill="purple">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" begin="click+1s" dur="2s" repeatCount="indefinite" />
    </rect>
</svg>


- 属性值
    - 无属性与参数：直接触发
    - 时间值‌：例如begin="1s"表示动画在1秒后开始。
    - 事件‌：例如begin="click"表示动画在点击事件发生时开始。
    - 事件加时间‌：例如begin="click + 1s"表示在点击事件发生后1秒开始动画‌

2. 其他动画结束或开始后由他触发

- 代码

```xml{9,19-20,30-31}
<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100"
            dur="2s" 
            id="animate1"
        />
    </rect>
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            to="100"
            dur="2s" 
            begin="animate1.end"
            id="animate2"
        />
    </rect>
    <rect x="10" y="140" width="50" height="50" fill="red">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0" 
            by="100"
            dur="2s" 
            begin="animate2.begin"
            id="animate3"
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

- svg图

<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" dur="2s" id="animate1" />
    </rect>
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="translate" from="0" to="100" dur="2s" begin="animate1.end" id="animate2" />
    </rect>
    <rect x="10" y="140" width="50" height="50" fill="red">
        <animateTransform attributeName="transform" type="translate" from="0" by="100" dur="2s" begin="animate2.begin" id="animate3" repeatCount="indefinite" />
    </rect>
</svg>


- 属性值
    - previous.end 其他动画结束时触发
    - previous.begin 其他动画开始时触发
    - repeatCount="1" 才有结束
    - previous 表示其他动画的id

3. 除此之外的键盘或鼠标事件由JS触发

- 代码

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <svg width="200" height="200">
        <rect x="10" y="20" width="50" height="50" fill="blue">
            <animateTransform 
                attributeName="transform" 
                type="translate" 
                from="0" 
                to="100"
                dur="2s" 
                repeatCount="1"
                id="animation_01"
            />
        </rect>
        <rect x="10" y="80" width="50" height="50" fill="green" id="myRect">
            <animateTransform 
                attributeName="transform" 
                type="translate" 
                from="0" 
                to="100"
                dur="2s" 
                repeatCount="1"
                id="animation_02"
            />
        </rect>
    </svg>

    <script>

        const animation1 = document.getElementById('animation_01');
        // 键盘事件监听器
        document.addEventListener('keydown', function(event) {
          if (event.key === 'ArrowRight') { // 例如，当用户按下右箭头键时
            animation1.beginElement(); // 开始动画
          } else if (event.key === 'ArrowLeft') { // 当用户按下左箭头键时
            animation1.endElement(); // 停止动画
          }
        });
       
        const rect = document.getElementById('myRect');
        const animation2 = document.getElementById('animation_02');
        // 鼠标事件监听器（例如，鼠标进入触发，鼠标离开结束）
        rect.addEventListener('mouseenter', function() {
            animation2.beginElement(); // 开始动画
        });
        rect.addEventListener('mouseleave', function() {
            animation1.endElement(); // 停止动画
        });
      </script>
</body>
</html>
```

- svg 示例

点击左右键盘触发，鼠标移入触发

<iframe src="/note-front/animation/svg/base/html/13.html" width="900" height="250"></iframe>

### 12.2.7 `fill` 动画结束处理



- 代码

```xml
<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="50" 
            to="100"
            dur="2s" 
            fill="remove"
        />
    </rect>
    <rect x="10" y="120" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="50" 
            to="100"
            dur="2s" 
            fill="freeze"
        />
    </rect>
</svg>
```

- svg 图

<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animateTransform attributeName="transform" type="translate" from="50" to="100" dur="2s" fill="remove" />
    </rect>
    <rect x="10" y="120" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="translate" from="50" to="100" dur="2s" fill="freeze" />
    </rect>
</svg>


- 属性值
    - remove 图形回到初始位置(默认值)
    - freeze 移动到最后不变

### 12.2.8 多动画处理

1. **多个 `animateTransform` 叠加执行**

```xml{18}
<svg width="200" height="200">
    <rect x="75" y="75" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="0 0" 
            to="50 50" 
            dur="2s" 
            repeatCount="indefinite"
        />
        <animateTransform 
            attributeName="transform" 
            type="rotate" 
            from="0 100 100" 
            to="360 100 100" 
            dur="2s" 
            repeatCount="indefinite"
            additive="sum"
        />
    </rect>
</svg>
```

**效果**：矩形 **边旋转边移动**。


<svg width="200" height="200">
    <rect x="75" y="75" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="translate" from="0 0" to="50 50" dur="2s" repeatCount="indefinite"/>
        <animateTransform attributeName="transform" type="rotate" from="0 100 100" to="360 100 100" dur="2s" repeatCount="indefinite" additive="sum"/>
    </rect>
</svg>


>注意：必须在第一个之外的 `<animateTransform>` 标签内添加 `additive="sum"`

2. **多个 `animateTransform` 顺序执行**


利用是覆盖执行配合时间触发，additive="replace"(默认)

```xml
<animateTransform begin="0s" dur="1s" .../>  <!-- 第一阶段 -->
<animateTransform begin="1s" dur="1.5s" .../> <!-- 第二阶段 -->
<animateTransform begin="2.5s" dur="1s" .../> <!-- 第三阶段 -->
```

- 代码
```xml
<svg width="300" height="300">
    <rect x="75" y="75" width="50" height="50" fill="green">
        <animateTransform 
            attributeName="transform" 
            type="translate" 
            from="200 200" 
            to="100 100"
            begin="0s" 
            dur="1s" 
            fill="freeze"
        />
        <animateTransform 
            attributeName="transform" 
            type="scale" 
            from="1" 
            to="2" 
            begin="1s" 
            dur="1s" 
            fill="freeze"
        />
        <animateTransform 
            attributeName="transform" 
            type="rotate" 
            from="0 100 100" 
            to="360 100 100" 
            begin="2s" 
            dur="1s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

- svg 图

<svg width="300" height="300">
    <rect x="75" y="75" width="50" height="50" fill="green">
        <animateTransform attributeName="transform" type="translate" from="200 200" to="100 100" begin="0s" dur="1s" fill="freeze" />
        <animateTransform attributeName="transform" type="scale" from="1" to="2" begin="1s" dur="1s" fill="freeze" />
        <animateTransform attributeName="transform" type="rotate" from="0 100 100" to="360 100 100" begin="2s" dur="1s" repeatCount="indefinite" />
    </rect>
</svg>



## 12.3 `<animate>` 动画属性


### 12.3.1 属性


1. **核心属性**

| 属性名 | 作用  | 示例值 |
| --- | --- | --- |
| **`attributeName`** | 需要动画化的 SVG 属性 | `"x"` `"fill"` `"opacity"` |
| **`attributeType`** | 指定目标属性的命名空间类型 | `"CSS"` `"XML"`  |



2. **动画时间属性（控制动画时序）**

| 属性名 | 作用  | 示例值 |
| --- | --- | --- |
| **`begin`** | 动画开始时间 | `"2s"`（2秒后开始）  <br>`"click"`（点击触发）  <br>`"previous.end"`（前一个动画结束后开始） |
| **`dur`** | 动画持续时间 | `"3s"`（动画持续 3 秒） |
| **`end`** | 动画结束时间 | `"5s"`（5秒后结束） |
| **`min`** | 动画最短持续时间 | `"1s"`（动画至少持续 1 秒） |
| **`max`** | 动画最长持续时间 | `"10s"`（动画最多持续 10 秒） |
| **`restart`** | 是否允许动画重启 | `"always"`（始终可重启）  <br>`"never"`（不允许重启）  <br>`"whenNotActive"`（动画未运行时可重启） |
| **`repeatCount`** | 设定动画重复次数 | `"3"`（播放 3 次）  <br>`"indefinite"`（无限循环） |
| **`repeatDur`** | 设定动画持续总时长 | `"10s"`（动画总时间不超过 10 秒） |
| **`fill`** | 动画结束后的状态 | `"remove"`（动画结束后恢复初始状态）  <br>`"freeze"`（动画结束后保持最终状态） |

3. **动画取值属性（控制动画轨迹）**

| 属性名 | 作用  | 示例值 |
| --- | --- | --- |
| **`calcMode`** | 插值模式 | `"discrete"`（离散变化）  <br>`"linear"`（线性变化）  <br>`"paced"`（匀速）  <br>`"spline"`（贝塞尔曲线） |
| **`values`** | 关键帧值列表 | `"0;50;100"`（多值关键帧） |
| **`keyTimes`** | 关键帧时间点（需配合 `values`） | `"0;0.5;1"`（分别代表 0%、50%、100% 进度） |
| **`keySplines`** | 贝塞尔曲线控制点（需配合 `calcMode="spline"`） | `"0.25 0.1 0.25 1"`（缓动曲线） |
| **`from`** | 动画起始值 | `"10"`（从 10 开始） |
| **`to`** | 动画结束值 | `"100"`（到 100 结束） |
| **`by`** | 动画增量 | `"50"`（基于当前值增加 50） |


4. **控制动画效果**

| 属性名 | 作用  | 示例值 |
| --- | --- | --- |
| **`additive`** | 叠加动画效果 | `"replace"`（替换原值）  <br>`"sum"`（与当前值相加） |
| **`accumulate`** | 累积动画效果 | `"none"`（不累积）  <br>`"sum"`（累计之前的值） |

5. **动画事件属性（绑定事件监听）**

| 属性名 | 作用  | 示例值 |
| --- | --- | --- |
| **`onbegin`** | 动画开始时触发 | `"alert('动画开始')"` |
| **`onend`** | 动画结束时触发 | `"console.log('动画结束')"` |
| **`onrepeat`** | 动画重复时触发 | `"console.log('动画循环')"` |


### 12.3.2  `attributeName`与`attributeType`


attributeName和attributeType 配合使用修改需要更改的动画样式

- attributeName(目标属性)
    - 位置属性‌
        - x/y：控制元素坐标
        - cx/cy：圆形/椭圆的中心坐标
        - points：多边形的顶点坐标
        - d：路径数据（用于`<path>`元素）
    - 尺寸属性‌
        - width/height：矩形尺寸
        - rx/ry：圆角半径
        - r：圆形半径
    - 颜色属性‌
        - fill：填充色
        - stroke：描边色
        - stop-color：渐变颜色
    - 视觉效果‌
        - opacity：透明度（CSS属性）
        - stroke-width：描边宽度
        - font-size：文字大小
    - ‌文本属性‌
        - textLength：文本长度
        - letter-spacing：字符间距（CSS属性）

- attributeType（命名空间）
    - CSS‌: 将attributeName视为CSS属性（如opacity）
    - XML‌: 将attributeName视为SVG原生XML属性（如cx）
    - auto（默认）‌: 先尝试解析为CSS属性，失败后转为XML属性

---

1. attributeType的XML属性与CSS属性

- 代码

```xml
<svg width="200" height="200">
    <!-- CSS属性动画 -->
    <rect x="20" y="50" width="50" height="50" fill="red">
        <animate 
            attributeName="opacity" 
            attributeType="CSS"
            from="1" 
            to="0.2" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <!-- XML属性动画 -->
    <circle cx="120" cy="80" r="20" fill="blue">
        <animate 
            attributeName="r" 
            attributeType="XML"
            from="20" 
            to="40" 
            dur="1.5s" 
            repeatCount="indefinite"
        />
    </circle>
</svg>
```
- svg 图

<svg width="200" height="200">
    <rect x="20" y="50" width="50" height="50" fill="red">
        <animate attributeName="opacity" attributeType="CSS" from="1" to="0.2" dur="2s" repeatCount="indefinite" />
    </rect>
    <circle cx="120" cy="80" r="20" fill="blue">
        <animate attributeName="r" attributeType="XML" from="20" to="40" dur="1.5s" repeatCount="indefinite" />
    </circle>
</svg>



2. 位置属性

- 代码

```xml
<svg width="200" height="200">
        <!-- 矩形移动 -->
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate 
            attributeName="x" 
            attributeType="XML"
            from="0" 
            to="100" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>

    <!-- 圆形移动 -->
    <circle cx="35" cy="35" r="25" fill="green">
        <animate 
            attributeName="cy" 
            attributeType="XML"
            from="0" 
            to="100" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </circle>

    <!-- 多边形动画 -->
    <polygon points="50,50 150,50 100,150" fill="blue">
        <!-- 顶点坐标动画：从三角形变为倒三角形 -->
        <animate 
                attributeName="points" 
                from="50,50 150,50 100,150" 
                to="50,150 150,150 100,50"
                dur="2s" 
                repeatCount="indefinite"
            />
    </polygon>

    <!-- 路径动画 -->
    <path d="M10,110 Q100,10 200,110" stroke="red" fill="none">
        <animate 
            attributeName="d" 
            attributeType="XML"
            from="M10,110 Q100,10 200,110" 
            to="M10,110 Q200,30 200,110" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </path>
</svg>
```

- svg 图

<svg width="200" height="200">
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate attributeName="x" attributeType="XML" from="0" to="100" dur="2s" repeatCount="indefinite" />
    </rect>
    <circle cx="35" cy="35" r="25" fill="green">
        <animate attributeName="cy" attributeType="XML" from="0" to="100" dur="2s" repeatCount="indefinite" />
    </circle>
    <polygon points="50,50 150,50 100,150" fill="blue">
        <animate attributeName="points" from="50,50 150,50 100,150" to="50,150 150,150 100,50" dur="2s" repeatCount="indefinite" />
    </polygon>
</svg>




3. 尺寸属性‌

- 代码

```xml
<svg width="300" height="200">
        <rect x="10" y="20" width="50" height="50" fill="red">
          <animate 
                attributeName="y" 
                attributeType="XML"
                from="0" 
                to="100" 
                dur="2s" 
                repeatCount="indefinite"
            />
        </rect>
        <rect x="80" y="30" width="70" height="50" fill="green">
            <animate 
                  attributeName="rx" 
                  attributeType="XML"
                  from="0" 
                  to="30" 
                  dur="2s" 
                  repeatCount="indefinite"
              />
          </rect>
       
        <circle cx="235" cy="55" r="25" fill="blue">
            <animate 
                attributeName="r" 
                attributeType="XML"
                from="25" 
                to="50" 
                dur="2s" 
                repeatCount="indefinite"
            />
        </circle>
    </svg>
```

- svg 图

<svg width="300" height="200">
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate attributeName="y" attributeType="XML" from="0" to="100" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="80" y="30" width="70" height="50" fill="green">
        <animate attributeName="rx" attributeType="XML" from="0" to="30" dur="2s" repeatCount="indefinite" />
    </rect>
    <circle cx="235" cy="55" r="25" fill="blue">
        <animate attributeName="r" attributeType="XML" from="25" to="50" dur="2s" repeatCount="indefinite" />
    </circle>
</svg>


4. 颜色属性

- 代码

```xml
<svg width="300" height="200">
    <!-- 处理填充颜色 -->
    <rect x="10" y="30" width="50" height="50" fill="red" >
        <animate 
            attributeName="fill" 
            attributeType="XML"
            from="red" 
            to="green" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <!-- 处理边框颜色 -->
    <rect x="80" y="30" width="70" height="50" fill="none" stroke-width="6" stroke="green">
        <animate 
            attributeName="stroke" 
            attributeType="XML"
            from="green" 
            to="blue" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    
    <!-- 处理渐变动画 -->
    <defs>
        <linearGradient id="MyGradient">
            <stop offset="5%" stop-color="lightblue">
                <animate 
                    attributeName="stop-color" 
                    attributeType="XML"
                    from="lightblue" 
                    to="lightgreen"
                    dur="2s" 
                    repeatCount="indefinite"
                />
            </stop>
            <stop offset="95%" stop-color="lightpink" >
                <animate 
                    attributeName="stop-color" 
                    attributeType="XML"
                    from="lightpink" 
                    to="red"
                    dur="2s" 
                    repeatCount="indefinite"
                />
            </stop>
        </linearGradient>
    </defs>
    <rect fill="url(#MyGradient)" x="180" y="30" width="100" height="50"/>
</svg>
```

- svg 图

<svg width="300" height="200">
    <rect x="10" y="30" width="50" height="50" fill="red">
        <animate attributeName="fill" attributeType="XML" from="red" to="green" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="80" y="30" width="70" height="50" fill="none" stroke-width="6" stroke="green">
        <animate attributeName="stroke" attributeType="XML" from="green" to="blue" dur="2s" repeatCount="indefinite" />
    </rect>
    <defs>
        <linearGradient id="MyGradient">
            <stop offset="5%" stop-color="lightblue">
                <animate attributeName="stop-color" attributeType="XML" from="lightblue" to="lightgreen" dur="2s" repeatCount="indefinite" />
            </stop>
            <stop offset="95%" stop-color="lightpink">
                <animate attributeName="stop-color" attributeType="XML" from="lightpink" to="red" dur="2s" repeatCount="indefinite" />
            </stop>
        </linearGradient>
    </defs>
    <rect fill="url(#MyGradient)" x="180" y="30" width="100" height="50" />
</svg>



5. 视觉效果‌

- 代码

```xml
<svg width="300" height="200">
    <!-- 处理透明度 -->
    <rect x="10" y="30" width="50" height="50" fill="red" >
        <animate 
            attributeName="opacity" 
            attributeType="CSS"
            from="1" 
            to="0.2" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <!-- 处理边框大小-->
    <rect x="80" y="30" width="70" height="50" fill="none" stroke-width="6" stroke="green">
        <animate 
            attributeName="stroke-width" 
            attributeType="XML"
            from="10" 
            to="2" 
            dur="2s" 
            repeatCount="indefinite"
        />
    </rect>
    <!-- 处理文字大小-->
    <text x="200" y="70"  fill="black" style="font-size:40px;">
        <animate 
            attributeName="font-size" 
            attributeType="CSS"
            from="30" 
            to="4" 
            dur="2s" 
            repeatCount="indefinite"
        />
        我爱学习
    </text>
</svg>
```

- svg 图

<svg width="300" height="200">
    <rect x="10" y="30" width="50" height="50" fill="red">
        <animate attributeName="opacity" attributeType="CSS" from="1" to="0.2" dur="2s" repeatCount="indefinite" />
    </rect>
    <rect x="80" y="30" width="70" height="50" fill="none" stroke-width="6" stroke="green">
        <animate attributeName="stroke-width" attributeType="XML" from="10" to="2" dur="2s" repeatCount="indefinite" />
    </rect>
    <text x="200" y="70" fill="black" style="font-size: 40px">
        <animate attributeName="font-size" attributeType="CSS" from="30" to="4" dur="2s" repeatCount="indefinite" />
        我爱学习
    </text>
</svg>

6. 文本属性

- 代码

```html
<svg width="500" height="200">
    <!-- 文字的长度 -->
    <text x="20" y="50"  fill="blue" style="font-size:40px;" >
        <animate 
            attributeName="textLength" 
            attributeType="XMl"
            from="200" 
            to="400" 
            dur="2s" 
            repeatCount="indefinite"
        />
        我爱学习！我爱学习！
    </text>
    
    <!-- 使用XML 中dx值 -->
    <text x="20" y="90"  fill="green" style="font-size:40px;">
        <animate 
            attributeName="dx" 
            attributeType="XML"
            from="10 20 40 50" 
            to="100 200 300 400" 
            dur="2s" 
            repeatCount="indefinite"
        />
        我爱学习！
    </text>

    <!-- 使用CSS里letter-spacing -->
    <text x="20" y="130"  fill="red" style="font-size:40px;">
        <animate 
            attributeName="letter-spacing" 
            attributeType="CSS"
            from="2" 
            to="30" 
            dur="2s" 
            repeatCount="indefinite"
        />
        我爱学习！
    </text>
</svg>
```

- svg 图

<svg width="500" height="200">
    <text x="20" y="50" fill="blue" style="font-size: 40px">
        <animate attributeName="textLength" attributeType="XMl" from="200" to="400" dur="2s" repeatCount="indefinite" />
        我爱学习！我爱学习！
    </text>
    <text x="20" y="90" fill="green" style="font-size: 40px">
        <animate attributeName="dx" attributeType="XML" from="10 20 40 50" to="100 200 300 400" dur="2s" repeatCount="indefinite" />
        我爱学习！
    </text>
    <text x="20" y="130" fill="red" style="font-size: 40px">
        <animate attributeName="letter-spacing" attributeType="CSS" from="2" to="30" dur="2s" repeatCount="indefinite" />
        我爱学习！
    </text>
</svg>




### 12.3.2  `begin` 属性详解

`begin` 属性定义**动画何时开始**，它支持多个时间值（用 **分号 `;`** 隔开），每个值可以是以下几种形式：

1. **时间偏移量**

**格式**：

```ts
<number>s | <number>ms
```

*   以 **秒 (`s`)** 或 **毫秒 (`ms`)** 设定动画延迟启动时间。
*   **示例**：
    
    ```xml
    <svg width="200" height="100">
        <rect x="10" y="20" width="50" height="50" fill="blue">
            <animate 
                attributeName="x" 
                from="0" 
                to="150" 
                dur="2s" 
                begin="3s"
                repeatCount="indefinite"
            />
        </rect>
    </svg>
    ```
    
    **效果**：动画将在 **3 秒后** 开始。

    <svg width="200" height="100">
        <rect x="10" y="20" width="50" height="50" fill="blue">
            <animate 
                attributeName="x" 
                from="0" 
                to="150" 
                dur="2s" 
                begin="1s"
                repeatCount="indefinite"
            />
        </rect>
    </svg>


2. **同步基准时间**

**格式**：

```ts
<animation-id>.<event>
```

*   让当前动画 **基于其他动画的状态** 来决定何时开始。
    
*   **常见事件**：
    
    *   **`.begin`**（另一个动画开始时触发）
    *   **`.end`**（另一个动画结束时触发）
*   **示例**：
    
    ```xml
    <svg width="200" height="200">
        <circle cx="50" cy="50" r="20" fill="blue">
            <animate 
                id="move" 
                attributeName="cx" 
                from="50" to="150" 
                dur="2s" 
                begin="click"
            />
        </circle>
        <rect x="20" y="80" width="50" height="50" fill="red">
            <animate 
                attributeName="x" 
                from="50" 
                to="150" 
                dur="2s" 
                begin="move.end"
            />
        </rect>
    </svg>
    ```
    
    **效果**：
    
    *   点击蓝色圆后，它会 **先移动**。
    *   红色矩形会在 **圆的动画结束后** 才开始移动。

    <svg width="200" height="200">
        <circle cx="50" cy="50" r="20" fill="blue">
            <animate id="move" attributeName="cx" from="50" to="150" dur="2s" begin="click" />
        </circle>
        <rect x="20" y="80" width="50" height="50" fill="red">
            <animate attributeName="x" from="50" to="150" dur="2s" begin="move.end" />
        </rect>
    </svg>


3. **基于事件触发**

**格式**：

```ts
<element-id>.<event>
```

*   **绑定 DOM 事件**，当事件触发时动画开始。
    
*   **常见事件**：
    
    *   `click`（点击）
    *   `mouseover`（鼠标悬停）
    *   `mousedown`（鼠标按下）
    *   `mouseup`（鼠标释放）
    *   `focus`（获取焦点）
    *   `blur`（失去焦点）
*   **示例**：
    
    ```xml
    <svg width="200" height="200">
        <circle id="myCircle" cx="50" cy="50" r="20" fill="green">
            <animate 
                attributeName="cx" 
                from="50" 
                to="150" 
                dur="2s" 
                begin="myCircle.mouseover"
            />
        </circle>
    </svg>
    ```
    
    **效果**：**鼠标悬停** 绿色圆形后，动画开始。
    
    <svg width="200" height="200">
        <circle id="myCircle" cx="50" cy="50" r="20" fill="green">
            <animate attributeName="cx" from="50" to="150" dur="2s" begin="myCircle.mouseover"/>
        </circle>
    </svg>


4. **基于动画重复次数触发**

**格式**：

```ts
<animation-id>.repeat(<repeat-index>)
```

*   当指定的动画重复到某个次数后，触发当前动画。
*   **示例**：
    
    ```xml
     <svg width="200" height="200">
        <circle cx="50" cy="50" r="20" fill="blue">
            <animate 
                id="move" 
                attributeName="cx" 
                from="50" 
                to="150" 
                dur="2s" 
                repeatCount="3"
            />
        </circle>
        <rect x="30" y="80" width="50" height="50" fill="red">
            <animate 
                attributeName="x" 
                from="0" 
                to="150" 
                dur="2s" 
                begin="move.repeat(2)" 
            />
        </rect>
    </svg>
    ```
    
    **效果**：
    *   蓝色圆形 **重复 2 次** 后，红色矩形才开始动画。

    <svg width="200" height="200">
        <circle cx="50" cy="50" r="20" fill="blue">
            <animate id="move" attributeName="cx" from="50" to="150" dur="2s" repeatCount="3" />
        </circle>
        <rect x="30" y="80" width="50" height="50" fill="red">
            <animate attributeName="x" from="0" to="150" dur="2s" begin="move.repeat(2)" />
        </rect>
    </svg>

5. **基于键盘按键触发**


*   JS绑定 **键盘快捷键** 来触发动画。
*   **示例**：
    
    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Document</title>
    </head>
    <body>
        <svg width="300" height="300">
            <!-- 可控制动画的图形 -->
            <rect id="box" x="50" y="50" width="80" height="80" fill="#4CAF50">
                <!-- 向左移动 -->
                <animate 
                    id="move1" 
                    attributeName="x" 
                    from="200" 
                    to="0" 
                    dur="0.8s" 
                    begin="indefinite" 
                    fill="freeze"
                />
                <!-- 向右移动 -->
                <animate 
                    id="move2" 
                    attributeName="x" 
                    from="0" 
                    to="200" 
                    dur="0.8s" 
                    begin="indefinite" 
                    fill="freeze"
                />
                <!-- 向上移动 -->
                <animate 
                id="move3" 
                attributeName="y" 
                from="200" 
                to="0" 
                dur="0.8s" 
                begin="indefinite" 
                fill="freeze"
            />
            <!-- 向下移动 -->
            <animate 
                id="move4" 
                attributeName="y" 
                from="0" 
                to="200" 
                dur="0.8s" 
                begin="indefinite" 
                fill="freeze"
            />
            </rect>
        </svg>
        <script>
            document.addEventListener("keydown", e => {
                switch (e.code) {
                    case "ArrowLeft":
                        document.getElementById("move1").beginElement();
                        break;
                    case "ArrowRight":
                        document.getElementById("move2").beginElement();
                        break;
                    case "ArrowUp":
                        document.getElementById("move3").beginElement();
                        break;
                    case "ArrowDown":
                        document.getElementById("move4").beginElement();
                        break;
                }
            });
        </script>
    </body>
    </html>
    ```
    
    **效果**：按下 **键盘 上下左右 键**，动画开始。

    <iframe src="/note-front/animation/svg/base/html/14.html" width="400" height="400"></iframe>

- 注意事项
    - [MDN中SVG的Begin属性](https://developer.mozilla.org/zh-CN/docs/Web/SVG/Reference/Attribute/begin#accesskey-value) 明确提到使用 `accessKey()` 函数，但是不起作用

6. **多个 `begin` 值**

*   可以用 **`;`（分号）** 连接多个 `begin` 值，满足 **任意一个** 条件时都会触发动画。
    
*   **示例**：
    
    ```xml
    <svg width="200" height="200">
        <circle id="myCircle" cx="50" cy="50" r="20" fill="blue">
            <animate 
                attributeName="cx" 
                from="50" 
                to="150" 
                dur="2s" 
                begin="3s; myCircle.click; move.end"
            />
        </circle>
    </svg>
    ```
    
    **效果**：
    
    *   **3 秒后** 动画开始，或
    *   **点击** 蓝色圆形时开始，或
    *   **另一个动画 `move` 结束后** 开始。

    <svg width="200" height="200">
        <circle id="myCircle" cx="50" cy="50" r="20" fill="blue">
            <animate 
                attributeName="cx" 
                from="50" 
                to="150" 
                dur="2s" 
                begin="3s; myCircle.click; move.end"
            />
        </circle>
    </svg>

### 12.3.3 `dur`与`end`
 
- dur：定义动画单次持续时间	
    - 支持单位：h（小时）、min（分钟）、s（秒）、ms（毫秒）
    - 示例：dur="0.5s"表示动画执行0.5秒完成一次循环
- end：定义动画绝对结束时间，未设置时由dur和repeatCount决定		
    - 优先级高于dur，设置后会强制终止动画5
    - 可与事件结合：end="click + 2s"表示点击后2秒结束


- 示例

```xml
<svg width="200" height="200">
    <!-- 动画未执行完 -->
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate 
            attributeName="x" 
            from="0" to="100" 
            dur="3s" 
            end="1s" 
            fill="freeze"
        />
    </rect>
    <!-- 每次循环2s 一共执行5次 -->
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="2s" 
            repeatCount="indefinite" 
            end="10s" 
            fill="freeze"
        />
    </rect>
        <!-- 点击click 停止执行 -->
    <rect x="10" y="140" width="50" height="50" fill="blue">
        <animate 
            attributeName="x" 
            from="0" to="100" 
            dur="2s" 
            repeatCount="indefinite" 
            fill="freeze"
            end="click" 
        />
    </rect>
</svg>
```

- svg 图

<svg width="200" height="200">
    <!-- 动画未执行完 -->
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate 
            attributeName="x" 
            from="0" to="100" 
            dur="3s" 
            end="1s" 
            fill="freeze"
        />
    </rect>
    <!-- 每次循环2s 一共执行5次 -->
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="2s" 
            repeatCount="indefinite" 
            end="10s" 
            fill="freeze"
        />
    </rect>
        <!-- 点击click 停止执行 -->
    <rect x="10" y="140" width="50" height="50" fill="blue">
        <animate 
            attributeName="x" 
            from="0" to="100" 
            dur="2s" 
            repeatCount="indefinite" 
            fill="freeze"
            end="click" 
        />
    </rect>
</svg>


### 12.3.4 `min` 与 `max`

- 属性值
    - min:定义动画执行的最短时间
    - max:定义动画执行的最长时间

- 代码

```xml
<svg width="400" height="200">
    <!-- 动画基准时长5秒，但实际执行时间会被限制在3-8秒之间 -->
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate 
            attributeName="opacity" 
            from="0" 
            to="1" 
            dur="5s" 
            min="3s" 
            max="8s" 
            fill="freeze"
        />
    </rect>
    <!-- 点击触发动画，最长执行时间不超过6秒 -->
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate 
            attributeName="width" 
            from="50" 
            to="200" 
            begin="click" 
            dur="4s" 
            max="6s" 
            fill="freeze"
        />
    </rect>
</svg>
```

- svg 图

<svg width="400" height="200">
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate attributeName="opacity" from="0" to="1" dur="5s" min="3s" max="8s" fill="freeze" />
    </rect>
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate attributeName="width" from="50" to="200" begin="click" dur="4s" max="6s" fill="freeze" />
    </rect>
</svg>


- 注意事项：
    - 时间单位支持：h/min/s/ms，省略时默认为秒
    - 当dur不在min和max范围内时，优先遵守min/max限制
    - 主要用于控制动画速度，不影响repeatCount等属性

### 12.3.5 restart

- restart属性控制动画的重启行为，主要取值：
    - always（默认）：允许随时重启动画
    - whenNotActive：仅当动画未运行时才能重启
    - never：禁止手动重启（只能通过DOM操作强制重启）

- 代码

```xml
<svg width="400" height="200">
    <!-- 再次点击触发动画 -->
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="1s" 
            restart="always" 
            begin="click"
            fill="freeze"
        />
    </rect>
    <!-- 再次点击不触发动画 -->
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="2s" 
            restart="whenNotActive" 
            begin="click"
            fill="freeze"
        />
    </rect>
    <!-- 只生效一次 -->
    <rect x="10" y="140" width="50" height="50" fill="blue" id="myRect">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="2s" 
            restart="never" 
            begin="click"
            fill="freeze"
            id="neverAnimation"
        />
    </rect>
</svg>
```

- svg 图

<svg width="400" height="200">
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate attributeName="x" from="0" to="100" dur="1s" restart="always" begin="click" fill="freeze" />
    </rect>
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate attributeName="x" from="0" to="100" dur="2s" restart="whenNotActive" begin="click" fill="freeze" />
    </rect>
    <rect x="10" y="140" width="50" height="50" fill="blue" id="myRect">
        <animate attributeName="x" from="0" to="100" dur="2s" restart="never" begin="click" fill="freeze" id="neverAnimation" />
    </rect>
</svg>


- 注意事项：
    - 通过JS调用beginElement()时仍受restart限制
    - 对`<set>`标签同样有效
    - 移动端触摸事件需注意与浏览器默认行为的冲突

### 12.3.6 `repeatCount`与`repeatDur`

- 属性值
    - repeatCount：定义动画重复次数	
        - repeatCount="3"（重复3次）
        - repeatCount="indefinite"（无限循环）
        - 默认值 1
    - repeatDur	定义动画重复的总时间	
        - repeatDur="10s"（10秒内循环）
        - repeatDur="indefinite"（无限时长）
- 代码

```xml
 <svg width="400" height="200">
    <!-- 动画运行3次 -->
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="2s" 
            begin="click"
            fill="freeze"
            repeatCount="3"
        />
    </rect>
    <!-- 动画运行6s -->
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="2s" 
            begin="click"
            fill="freeze"
            repeatDur="6"
        />
    </rect>
</svg>
```

- svg 图

<svg width="400" height="200">
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate attributeName="x" from="0" to="100" dur="2s" begin="click" fill="freeze" repeatCount="3" />
    </rect>
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate attributeName="x" from="0" to="100" dur="2s" begin="click" fill="freeze" repeatDur="6" />
    </rect>
</svg>


- 注意事项
    - 当同时设置repeatCount和repeatDur时，优先满足先达到限制的条件
    - repeatDur计算包含动画间的间隔时间（若有begin延迟）
    - 对`<animateMotion>`路径动画同样有效
- 与其他属性关系
    - 与dur配合：repeatCount × dur ≤ repeatDur（若同时存在）56
    - 与end冲突：若end时间早于repeatDur，以end为准

### 12.3.7 fill

- fill属性控制动画结束后的状态表现：
    - freeze：保持动画结束时的最终状态（默认值）
    - remove：恢复动画开始前的初始状态

- 代码

```xml
 <svg width="400" height="200">
    <!-- 保持动画最终效果 -->
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="2s" 
            begin="click"
            fill="freeze"
        />
    </rect>
    <!-- 动态恢复初始状态 -->
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="2s" 
            begin="click"
            fill="remove"
        />
    </rect>
</svg>
```

- svg 图

<svg width="400" height="200">
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate attributeName="x" from="0" to="100" dur="2s" begin="click" fill="freeze" />
    </rect>
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate attributeName="x" from="0" to="100" dur="2s" begin="click" fill="remove" />
    </rect>
</svg>


--- 



### 12.3.8 **`calcMode`**

`calcMode` **决定动画插值方式**，影响 `values` 或 `from-to/by` 之间的过渡效果。

- **可选值：**

| 值   | 解释  |
| --- | --- |
| `linear` | **线性插值**，在关键点之间均匀变化（默认） |
| `paced` | **匀速插值**，确保动画整体速度均匀（仅适用于数字值） |
| `discrete` | **离散模式**，值直接跳变，没有过渡 |
| `spline` | **贝塞尔曲线插值**，通过 `keySplines` 控制过渡曲线 |

- **示例**

```xml
 <svg width="400" height="300">
    <!-- linear 线性变化 -->
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate 
            attributeName="x" 
            from="0" 
            to="100" 
            dur="2s" 
            calcMode="linear"
            repeatCount="indefinite"
        />
    </rect>
    <!-- paced 匀速插值 -->
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate 
            attributeName="x" 
            from="0" 
            to="150" 
            dur="2s" 
            calcMode="paced"
            repeatCount="indefinite"
        />
        <animate 
            attributeName="y" 
            from="0" 
            to="200" 
            dur="2s" 
            calcMode="paced"
            repeatCount="indefinite"
        />
        
    </rect>
        <!-- discrete 离散模式 -->
        <rect x="10" y="140" width="50" height="50" fill="blue">
        
        <animate 
            attributeName="fill" 
            values="red;green;blue" 
            calcMode="discrete" 
            dur="1s" 
            repeatCount="indefinite"
        />
    </rect>
        <!-- spline 过度曲线插值 -->
        <rect x="10" y="200" width="50" height="50" fill="purple">
        <animate 
            attributeName="opacity"
            from="0" 
            to="1"
            calcMode="spline"
            keySplines="0.1 0.8 0.9 0.2"
            dur="1.5s" 
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

- svg 图

<svg width="400" height="300">
    <rect x="10" y="20" width="50" height="50" fill="red">
        <animate attributeName="x" from="0" to="100" dur="2s" calcMode="linear" repeatCount="indefinite" />
    </rect>
    <rect x="10" y="80" width="50" height="50" fill="green">
        <animate attributeName="x" from="0" to="150" dur="2s" calcMode="paced" repeatCount="indefinite" />
        <animate attributeName="y" from="0" to="200" dur="2s" calcMode="paced" repeatCount="indefinite" />
    </rect>
    <rect x="10" y="140" width="50" height="50" fill="blue">
        <animate attributeName="fill" values="red;green;blue" calcMode="discrete" dur="1s" repeatCount="indefinite" />
    </rect>
    <rect x="10" y="200" width="50" height="50" fill="purple">
        <animate attributeName="opacity" from="0" to="1" calcMode="spline" keySplines="0.1 0.8 0.9 0.2" dur="1.5s" repeatCount="indefinite" />
    </rect>
</svg>




### 12.3.9  **`values`**


- values属性用于定义动画关键帧序列，特点如下：
    - 替代from/to/by实现多值过渡
    - 值之间用分号分隔（如values="0;50;100"）
    - 与keyTimes配合可精确控制时间分配

- 代码

```xml
<svg width="600" height="200">
    <!-- 多阶段动画 -->
    <circle cx="100" cy="100" fill="blue">
        <animate 
            attributeName="r" 
            values="30;80;30" 
            dur="1s" 
            repeatCount="indefinite"
        />
    </circle>
    <!-- 颜色渐变序列 -->
    <circle cx="240" cy="100" r="50">
        <animate 
            attributeName="fill" 
            values="orange;#4ed8a1;#a2d8d5" 
            dur="5s" 
            repeatCount="indefinite"
        />
    </circle>
    <!-- 位置变化 -->
    <circle cx="360" cy="100" r="50" fill="red">
        <animate 
            attributeName="cx" 
            values="360; 420; 480; 420; 360" 
            dur="4s"
            repeatCount="indefinite"
        />
    </circle>
</svg>
```

- svg 图

<svg width="600" height="200">
    <circle cx="100" cy="100" fill="blue">
        <animate attributeName="r" values="30;80;30" dur="1s" repeatCount="indefinite" />
    </circle>
    <circle cx="240" cy="100" r="50">
        <animate attributeName="fill" values="orange;#4ed8a1;#a2d8d5" dur="5s" repeatCount="indefinite" />
    </circle>
    <circle cx="360" cy="100" r="50" fill="red">
        <animate attributeName="cx" values="360; 420; 480; 420; 360" dur="4s" repeatCount="indefinite" />
    </circle>
</svg>


- 注意事项
    - 设置values后会忽略from/to/by属性
    - 值类型需与目标属性匹配（如颜色值需用HEX/RGB格式）



### 12.3.10  **`keyTimes`**


- keyTimes用于定义动画关键帧的时间比例，特点如下：
    - 值范围0~1（0=开始，1=结束）
    - 需与values属性数量严格匹配
    - 时间点必须单调递增
    - 配合calcMode指定插值模式（除discrete外均适用）
    - 配合keySplines控制变速曲线（需calcMode="spline"）

- 代码
	
```xml
<svg width="300" height="200">
    <!-- 非均匀时间分配 -->
    <circle cx="50" cy="50" r="20" fill="green">
        <animate 
            attributeName="cx" 
            values="50; 100; 150; 100; 50" 
            keyTimes="0; 0.2; 0.6; 0.8; 1" 
            dur="5s"
            repeatCount="indefinite"
        />
    </circle>
    <!-- ‌配合spline插值 -->
    <circle cx="50" cy="150" r="20" fill="red">
        <animate 
            attributeName="opacity"
            values="0;1;0.5;1"
            keyTimes="0;0.4;0.8;1"
            calcMode="spline"
            dur="3s"
            repeatCount="indefinite"
            keySplines=".5 0 .5 1; 0 0 1 1; .5 0 .5 1"
        />
    </circle>
</svg>
```

- svg 图

<svg width="300" height="200">
    <circle cx="50" cy="50" r="20" fill="green">
        <animate attributeName="cx" values="50; 100; 150; 100; 50" keyTimes="0; 0.2; 0.6; 0.8; 1" dur="5s" repeatCount="indefinite" />
    </circle>
    <circle cx="50" cy="150" r="20" fill="red">
        <animate attributeName="opacity" values="0;1;0.5;1" keyTimes="0;0.4;0.8;1" calcMode="spline" dur="3s" repeatCount="indefinite" keySplines=".5 0 .5 1; 0 0 1 1; .5 0 .5 1" />
    </circle>
</svg>


- 注意事项
    - 必须与values或path属性配合使用
    - 默认均匀分配时间（不声明时）


### 12.3.11  **`keySplines`**



- keySplines用于定义贝塞尔曲线控制动画速度变化，特点如下：
    - 需配合`calcMode="spline"`使用
    - 每组值包含4个0-1的数字（定义三次贝塞尔曲线的两个控制点）
    - 控制点数量需比keyTimes少一组

    
*   **与 `keyTimes` 数量一致**（N 个 `values` 需要 N-1 个 `keySplines`）, 每个控制点描述都是一组四个值：x1 y1 x2 y2，描述一个时间段的贝塞尔控制点。keyTimes定义相关段的值是贝塞尔“锚点”，值keySplines是控制点。因此，控制点集的数量必须比少一组keyTimes。
    
- 代码

```xml
<svg width="300" height="200">
    <circle cx="50" cy="50" r="20" fill="purple">
        <animate 
            attributeName="cx" 
            values="50; 150; 50" 
            keyTimes="0; 0.5; 1"           
            keySplines="0.25 0.1 0.25 1;0.5 0.4 0.2 0.9" 
            calcMode="spline" 
            dur="3s"
            repeatCount="indefinite"
        />
    </circle>
</svg>
```

- svg 图

<svg width="300" height="200">
    <circle cx="50" cy="50" r="20" fill="purple">
        <animate 
            attributeName="cx" 
            values="50; 150; 50" 
            keyTimes="0; 0.5; 1"           
            keySplines="0.25 0.1 0.25 1;0.5 0.4 0.2 0.9" 
            calcMode="spline" 
            dur="3s"
            repeatCount="indefinite"
        />
    </circle>
</svg>


### 12.3.12  **`from`/`to`/`by`**


- 属性定义‌
    - from：指定动画起始值（可省略，默认取元素当前值）
    - to：指定动画结束值（绝对值）
    - by：指定相对变化量（to = from + by）
- ‌互斥规则‌
    - 使用to或by时必须二选一，不能同时存在
    - 设置values属性时会忽略这三个属性

- 代码

```xml
<svg width="300" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animate 
            attributeName="x" 
            from="50" 
            to="100" 
            dur="2s"
            repeatCount="indefinite"
        />
    </rect>
    <rect x="10" y="120" width="50" height="50" fill="green">
        <animate 
            attributeName="x" 
            from="50" 
            by="50" 
            dur="2s"
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

- 示例

<svg width="300" height="200">
    <rect x="10" y="20" width="50" height="50" fill="blue">
        <animate 
            attributeName="x" 
            from="50" 
            to="100" 
            dur="2s"
            repeatCount="indefinite"
        />
    </rect>
    <rect x="10" y="120" width="50" height="50" fill="green">
        <animate 
            attributeName="x" 
            from="50" 
            by="50" 
            dur="2s"
            repeatCount="indefinite"
        />
    </rect>
</svg>


### 12.3.13 additive

- additive控制动画值的叠加方式：
    - ‌默认值‌：replace（覆盖原值）
    - ‌可选值‌：sum（与原值相加）

- 代码

```xml
<svg width="300" height="200">
    <!-- x值等于 50 (原值) + 50 (from值) = 100 -->
    <rect x="50" y="20" width="50" height="50" fill="blue">
        <animate 
            attributeName="x" 
            from="50" 
            to="100" 
            dur="2s"
            additive="sum"
            repeatCount="indefinite"
        />
    </rect>
     <!-- x值等于 50 (from值) -->
    <rect x="50" y="120" width="50" height="50" fill="green">
        <animate 
            attributeName="x" 
            from="50" 
            to="100" 
            dur="2s"
            additive="replace"
            repeatCount="indefinite"
        />
    </rect>
</svg>
```

- svg 图

<svg width="300" height="200">
    <rect x="50" y="20" width="50" height="50" fill="blue">
        <animate attributeName="x" from="50" to="100" dur="2s" additive="sum" repeatCount="indefinite" />
    </rect>
    <rect x="50" y="120" width="50" height="50" fill="green">
        <animate attributeName="x" from="50" to="100" dur="2s" additive="replace" repeatCount="indefinite" />
    </rect>
</svg>


### 12.3.14 accumulate

- 控制重复动画时属性值的累积方式，仅对repeatCount>1的动画有效
    - sum：每次循环叠加前次动画的最终值2
    - none（默认）：每次循环重置为初始值

- 代码

```xml
<svg width="500" height="300">
    <!-- 初始值 -->
    <circle cx="80" cy="150" r="50" fill="blue">
        <animate 
            attributeName="r" 
            from="50" 
            to="60" 
            repeatCount="3" 
            accumulate="none" 
            dur="2s"
        />
    </circle>

    <!-- 累加 
        第一次：50→60
        第二次：50+60→120
        第三次：50+60+60→180
    -->
    <circle cx="300" cy="150" r="50" fill="red">
        <animate 
            attributeName="r" 
            from="50" 
            to="60" 
            repeatCount="3" 
            accumulate="sum" 
            dur="2s"
        />
    </circle>
</svg>
```


- svg 图

<svg width="500" height="300">
    <circle cx="80" cy="150" r="50" fill="blue">
        <animate attributeName="r" from="50" to="60" repeatCount="3" accumulate="none" dur="2s" />
    </circle>
    <circle cx="300" cy="150" r="50" fill="red">
        <animate attributeName="r" from="50" to="60" repeatCount="3" accumulate="sum" dur="2s" />
    </circle>
</svg>




### 12.3.15 `onbegin`/`onend`/`onrepeat`

- 事件触发器‌
    - onbegin：动画开始时触发13
    - onend：动画正常结束时触发（非中断情况）13
    - onrepeat：每次动画重复时触发（需配合repeatCount使用）

- 代码

```xml
<svg width="200" height="100">
    <circle cx="50" cy="50" r="20" fill="blue">
        <animate
            attributeName="cx"
            from="50"
            to="150"
            dur="2s"
            repeatCount="3"
            onbegin="console.log('动画开始')"
            onend="console.log('动画结束')"
            onrepeat="console.log('动画循环')"
        />
    </circle>
</svg>
```

- 控制台

![](/animation/svg/base/image/059.png)


## 12.4 `<animateMotion>`动画属性

### 12.4.1 属性

1. 路径定义

    - path‌: 直接定义运动路径（等效于`<mpath>`子元素）

    ```xml
    <animateMotion path="M0,0 L100,100 Q150,50 200,0"/>
    ```

    - mpath‌（子元素）: 引用外部`<path>`元素作为运动轨迹

    ```xml
    <animateMotion>
        <mpath xlink:href="#myPath"/>
    </animateMotion>
    ```

2. 运动控制属性

| 属性        | 作用      | 值类型                   | 示例                   |
|-----------|---------|-----------------------|----------------------|
| keyPoints | 路径关键点比例 | 0-1的分号列表              | keyPoints="0;0.3;1" |
| keyTimes  | 时间关键点比例 | 0-1的分号列表              | keyTimes="0;0.5;1"  |
| rotate    | 旋转控制    | auto/auto-reverse/角度值 | rotate="auto"       |
| origin    | 变换原点    | default/坐标值           | origin="20,30"       |


3. 事件控制属性

| 属性        | 作用      |  示例                   |
|-------------|--------|--------------------------|
| dur         | 单次动画时长 | dur="5s"                 |
| begin       | 延迟开始时间 | begin="click"            |
| end         | 结束条件   | end="click+5s"           |
| repeatCount | 重复次数   | repeatCount="indefinite" |
| repeatDur   | 总持续时间  | repeatDur="10s"          |


4. 计算模式属性
‌
    - calcMode‌
        - linear：匀速运动（默认）
        - discrete：离散跳跃
        - paced：自动速度调整
        - spline：贝塞尔曲线控制
    - keySplines‌
        - 配合calcMode="spline"定义贝塞尔曲线控制点


5. 其他属性

| 属性         | 作用     | 示例                |
|------------|--------|-------------------|
| additive   | 动画叠加方式 | additive="sum"   |
| accumulate | 重复累积效果 | accumulate="sum" |
| fill       | 动画结束状态 | fill="freeze"     |


### 12.4.2  **`<animateMotion>` 基础使用**

`<animateMotion>` 用于**沿着路径（path）移动对象**。它和 offset 类似，适用于路径动画。


- 代码

```xml
<svg width="400" height="200">
    <path id="myPath" d="M40,40 Q150,300 300,40" fill="none" stroke="gray"/>
    <circle x="40" y="40" r="20" fill="red">
        <animateMotion dur="2s" repeatCount="indefinite">
        <mpath xlink:href="#myPath"/>
        </animateMotion>
    </circle>
</svg>
```

- svg 图

<svg width="400" height="200">
    <path id="myPath" d="M40,40 Q150,300 300,40" fill="none" stroke="gray"/>
    <circle x="40" y="40" r="20" fill="red">
        <animateMotion dur="2s" repeatCount="indefinite">
            <mpath xlink:href="#myPath"/>
        </animateMotion>
    </circle>
</svg>



- 属性解释
    *   `attributeName="motion"` **（固定值）**
    *   `dur="2s"` **动画持续时间**
    *   `repeatCount="indefinite"` **无限循环**
    *   `<mpath href="#pathID"/>` **引用 `<path>` 定义的轨迹**


### 12.4.3 `path`与`<mpath>`

- 路径设置
    - path属性（直接定义路径）
        - 直接在animateMotion标签内定义路径数据
        - 简单直线/折线路径
        - 独立动画且无需复用
    - mpath子元素（引用外部路径）
        - 引用外部已定义的`<path>`元素
        - 路径需要被多个动画复用
        - 路径数据复杂（如贝塞尔曲线）

- 代码
```xml
<svg width="400" height="200">
    <!--直接使用path -->
    <circle cx="10" cy="10" r="5" fill="red">
        <animateMotion 
            path="M10,10 C50,150 150,50 190,190" 
            dur="3s" 
            repeatCount="indefinite" 
        />
    </circle>

    <!-- 定制轨迹 -->
    <path id="myPath" d="M10,10 C50,150 150,50 190,190" fill="transparent" stroke="black" />
    
    <!-- mpath使用 -->
    <circle cx="10" cy="10" r="5" fill="blue">
        <animateMotion 
            dur="3s" 
            begin="1s"
            repeatCount="indefinite"
        >
            <mpath href="#myPath"/>
        </animateMotion>
    </circle>
</svg>
```

- svg 图

<svg width="400" height="200">
    <circle cx="10" cy="10" r="5" fill="red">
        <animateMotion path="M10,10 C50,150 150,50 190,190" dur="3s" repeatCount="indefinite" />
    </circle>
    <path id="myPath2" d="M10,10 C50,150 150,50 190,190" fill="transparent" stroke="black" />
    <circle cx="10" cy="10" r="5" fill="blue">
        <animateMotion dur="3s" begin="1s" repeatCount="indefinite">
            <mpath href="#myPath2" />
        </animateMotion>
    </circle>
</svg>


### 12.4.4 keyPoints与keyTimes

- keyPoints属性用于精确控制对象沿路径的运动比例
    - 值格式‌：分号分隔的0-1比例值（如`"0;0.3;0.8;1"`）
    - 作用原理‌：每个值对应路径的百分比位置，与keyTimes的时间点一一匹配
- keyTimes属性用于定义动画关键帧的时间节点
    - 值格式‌：分号分隔的0-1比例值（如`"0;0.3;0.8;1"`）
    - ‌作用原理‌：每个值对应动画总时长的百分比，控制运动节奏


- keyPoints与keyTimes配合实现非匀速运动效果,对应每一段距离分配运动的时间
    *   **`keyPoints="0; 0.3; 0.7; 1"`** 物体移动到路径 0%、30%、70%、100% 的位置
    *   **`keyTimes="0; 0.2; 0.8; 1"`** 这些位置的动画时间为 0%、20%、80%、100%


- 代码

```xml
 <svg width="300" height="200">
    <path id="motionPath" d="M10,50 Q100,0 200,50 T390,50" fill="none" stroke="gray" />
    <circle r="8" fill="blue">
        <animateMotion 
            dur="4s" 
            repeatCount="indefinite" 
            keyTimes="0;0.3;0.8;1" 
            keyPoints="0;0.2;0.7;1">
            <mpath xlink:href="#motionPath" />
        </animateMotion>
    </circle>

    <circle r="8" fill="red">
        <animateMotion 
            dur="4s" 
            repeatCount="indefinite" 
            keyTimes="0;0.8;1" 
            keyPoints="0;0.2;1">
            <mpath xlink:href="#motionPath" />
        </animateMotion>
    </circle>
</svg>
```

- svg 图

<svg width="300" height="200">
    <path id="motionPath" d="M10,50 Q100,0 200,50 T390,50" fill="none" stroke="gray" />
    <circle r="8" fill="blue">
        <animateMotion 
            dur="4s" 
            repeatCount="indefinite" 
            keyTimes="0;0.3;0.8;1" 
            keyPoints="0;0.2;0.7;1">
            <mpath xlink:href="#motionPath" />
        </animateMotion>
    </circle>
    <circle r="8" fill="red">
        <animateMotion 
            dur="4s" 
            repeatCount="indefinite" 
            keyTimes="0;0.8;1" 
            keyPoints="0;0.2;1">
            <mpath xlink:href="#motionPath" />
        </animateMotion>
    </circle>
</svg>

### 12.4.5 `rotate`

- rotate属性控制对象沿运动路径的方向旋转，支持三种模式：
    1. ‌自动旋转‌ rotate="auto"：对象x轴始终与路径切线方向一致
    2. 反向旋转‌ rotate="auto-reverse"：对象x轴与路径切线方向相反
    3. 固定角度‌ rotate="角度值"：保持固定旋转（如rotate="90"）

```xml
<svg width="200" height="200">
    <path id="path" d="M10,10 C50,150 150,50 190,190" fill="transparent" stroke="black"/>
    
     <!-- 自动旋转 -->
    <rect width="20" height="20" fill="green">
        <animateMotion 
        dur="3s" 
        repeatCount="indefinite" 
        rotate="auto">
        <mpath href="#path"/>
        </animateMotion>
    </rect>

    <!-- 反方向旋转 -->
    <rect width="20" height="20" fill="blue">
        <animateMotion 
            dur="3s" 
            repeatCount="indefinite" 
            begin="0.5s"
            rotate="auto-reverse">
            <mpath href="#path"/>
        </animateMotion>
    </rect>

    <!-- 角度旋转 目前设置无效 -->
    <rect width="20" height="20" fill="red">
        <animateMotion 
            dur="3s" 
            repeatCount="indefinite" 
            begin="1s"
            rotate="90">
            <mpath href="#path"/>
        </animateMotion>
    </rect>
</svg>
```

- svg 图

<svg width="200" height="200">
    <path id="path" d="M10,10 C50,150 150,50 190,190" fill="transparent" stroke="black" />
    <rect width="20" height="20" fill="green">
        <animateMotion dur="3s" repeatCount="indefinite" rotate="auto">
            <mpath href="#path" />
        </animateMotion>
    </rect>
    <rect width="20" height="20" fill="blue">
        <animateMotion dur="3s" repeatCount="indefinite" begin="0.5s" rotate="auto-reverse">
            <mpath href="#path" />
        </animateMotion>
    </rect>
    <rect width="20" height="20" fill="red">
        <animateMotion dur="3s" repeatCount="indefinite" begin="1.2s" rotate="90">
            <mpath href="#path" />
        </animateMotion>
    </rect>
</svg>


- 注意事项
    - 未指定rotate时对象保持原始方向
    - rotate="角度值" 目前不能使用（20250518），但是[MDN中SVG的rotate](https://developer.mozilla.org/en-US/docs/Web/SVG/Reference/Attribute/rotate) 是有选项的

### 12.4.6 `from` 与 `to`

- 属性
    - from属性‌：定义运动路径的起始点坐标（格式：x,y），未指定时默认从路径起点开始
    - to属性‌：定义运动路径的终点坐标（格式：x,y），必须与from配对使用

- 代码

```xml
<svg width="200" height="200">
    <path id="path" d="M10,10 L180,80 " fill="transparent" stroke="black"/>
    <rect width="20" height="20" fill="green">
    <animateMotion 
        from="0,0" 
        to="180,80" 
        dur="2s" 
        repeatCount="indefinite"/>
    </rect>
</svg>
```

- svg 图

<svg width="200" height="200">
    <path id="path" d="M10,10 L180,80 " fill="transparent" stroke="black"/>
    <rect width="20" height="20" fill="green">
    <animateMotion  from="0,0"  to="180,80" dur="2s" repeatCount="indefinite"/>
    </rect>
</svg>

- 注意事项
    - `from + to` 与 path或`<mpath>` 互斥，不能同时存在
    - `from + to` 与 keyPoints 冲突



### 12.4.7 `begin` 与 `dur` 与 `end`
- 属性值
    - begin属性‌：定义动画开始触发条件（支持多种触发方式） 默认值：0s（
    - end属性‌：定义动画结束条件（优先级高于dur）
    - dur‌属性：设置动画持续时间
    - 仅设置dur: 动画立即开始并持续指定时长
    - begin+dur: 延迟开始后运行固定时长
    - begin+end: 在时间区间内持续运行
    - 三者同时设置: end会覆盖dur的结束时间

- 代码

```xml
 <svg width="220" height="120">
    <rect width="40" height="40" fill="blue">
    <animateMotion 
        path="M0,0 L180,80" 
        begin="2s" 
        dur="2s" 
        end="click + 1s" 
        repeatCount="indefinite"/>
    </rect>
</svg>
```

- svg 图

<svg width="220" height="120">
    <rect width="40" height="40" fill="blue">
    <animateMotion 
        path="M0,0 L180,80" 
        begin="2s" 
        dur="2s" 
        end="click + 1s" 
        repeatCount="indefinite"/>
    </rect>
</svg>


### 12.4.8 `repeatCount` 与  `repeatDur`

- 属性值
    - repeatCount：定义动画重复次数
        - repeatCount="3"（重复3次）
        - repeatCount="indefinite"（无限循环）
        - 默认值 1
    - repeatDur 定义动画重复的总时间
        - repeatDur="10s"（10秒内循环）
        - repeatDur="indefinite"（无限时长）

- 代码

```xml
<svg width="200" height="200">
    <path id="motionPath" d="M10,10 C50,50 150,50 190,10" stroke="gray" fill="none"/>
    <!-- 使用结束次数 -->
    <circle x="10" y="10" r="5" fill="red">
    <animateMotion 
        dur="2s" 
        repeatCount="2" >
        <mpath xlink:href="#motionPath"/>
    </animateMotion>
    </circle>
    <!-- 使用结束时间 -->
    <circle x="10" y="10" r="5" fill="blue">
    <animateMotion 
        begin="1s"
        dur="2s" 
        repeatDur="5s">
        <mpath xlink:href="#motionPath"/>
    </animateMotion>
    </circle>
</svg>
```

- svg 图

<svg width="200" height="200">
    <path id="motionPath8" d="M10,10 C50,50 150,50 190,10" stroke="gray" fill="none" />
    <circle x="10" y="10" r="5" fill="red">
        <animateMotion dur="2s" repeatCount="2">
            <mpath xlink:href="#motionPath8" />
        </animateMotion>
    </circle>
    <circle x="10" y="10" r="5" fill="blue">
        <animateMotion begin="1s" dur="2s" repeatDur="5s">
            <mpath xlink:href="#motionPath8" />
        </animateMotion>
    </circle>
</svg>


### 12.4.9 `calcMode‌`

- `<animateMotion>`中的calcMode‌
    - linear：匀速运动（默认值），严格按时间均匀分配路径进度
    - spline：通过贝塞尔曲线控制速度变化（需配合keySplines属性）

- 代码

```xml
<svg width="500" height="300" >
    <!-- 路径定义 -->
    <path id="motionPath" d="M50,50 C100,150 400,150 450,50" stroke="gray" fill="none"/>
    
    <!-- 线性运动（默认） -->
    <circle r="8" fill="red">
        <animateMotion 
        dur="4s" 
        calcMode="linear"
        repeatCount="indefinite">
        <mpath xlink:href="#motionPath"/>
        </animateMotion>
    </circle>
    <!-- 贝塞尔曲线变速 -->
    <circle r="8" fill="purple" >
        <animateMotion 
        dur="4s" 
        calcMode="spline"
        keyTimes="0;0.5;1"
        keySplines="0.1 0.8 0.9 0.2; 0.3 0.4 0.5 0.6"
        repeatCount="indefinite">
        <mpath xlink:href="#motionPath"/>
        </animateMotion>
    </circle>
</svg>
```

- svg 图

<svg width="500" height="300">
    <path id="motionPath9" d="M50,50 C100,150 400,150 450,50" stroke="gray" fill="none" />
    <circle r="8" fill="red">
        <animateMotion dur="4s" calcMode="linear" repeatCount="indefinite">
            <mpath xlink:href="#motionPath9" />
        </animateMotion>
    </circle>
    <circle r="8" fill="purple">
        <animateMotion dur="4s" calcMode="spline" keyTimes="0;0.5;1" keySplines="0.1 0.8 0.9 0.2; 0.3 0.4 0.5 0.6" repeatCount="indefinite">
            <mpath xlink:href="#motionPath9" />
        </animateMotion>
    </circle>
</svg>


### 12.4.10 `keySplines‌`

- keySplines用于定义动画速度变化的贝塞尔曲线，需配合calcMode="spline"使用。
    - ‌控制原理‌：通过三阶贝塞尔曲线（4个控制点）定义时间-进度映射关系
    - ‌值格式‌：x1 y1 x2 y2（每组值范围0~1，定义两个控制点）
    - ‌依赖属性‌：必须与keyTimes配对使用，且两者分段数需匹配

- 代码

```xml
<svg width="300" height="200">
    <path id="path" d="M10,100 C50,20 250,20 290,100" stroke="gray" fill="none"/>
    <circle r="10" fill="red">
        <animateMotion 
        dur="4s" 
        calcMode="spline"
        keyTimes="0;0.3;1"
        keySplines="0.1 0.8 0.2 0.9; 0.5 0 0.5 1"
        repeatCount="indefinite">
        <mpath xlink:href="#path"/>
        </animateMotion>
    </circle>
</svg>
```

- svg 图

<svg width="300" height="200">
    <path id="path" d="M10,100 C50,20 250,20 290,100" stroke="gray" fill="none"/>
    <circle r="10" fill="red">
        <animateMotion 
        dur="4s" 
        calcMode="spline"
        keyTimes="0;0.3;1"
        keySplines="0.1 0.8 0.2 0.9; 0.5 0 0.5 1"
        repeatCount="indefinite">
        <mpath xlink:href="#path"/>
        </animateMotion>
    </circle>
</svg>



### 12.4.11 `additive`

- additive控制动画值是否叠加到基础值上，支持两种模式：
    - ‌replace‌（默认）：还是以原本原点为基础
    - ‌sum‌：以上个动画的结束点为原点计算新的轨迹

- 代码

```xml
<svg width="300" height="300" >
    <path id="path1" d="M20,20 L280,20" stroke="gray" />
    <path id="path2" d="M20,200 L280,200" stroke="blue" />
    <circle r="5" fill="red">
        <!-- 基础运动 -->
        <animateMotion 
            dur="2s" 
            path="M20,20 L280,20" 
            fill="freeze" />

        <!-- 叠加偏移运动 -->
        <animateMotion 
            dur="2s" 
            path="M0,0 L0,180 -260,180" 
            additive="sum" 
            begin="2s" 
            fill="freeze" />
    </circle>
</svg>
```


- svg 图

<svg width="300" height="300">
    <path id="path1" d="M20,20 L280,20" stroke="gray" />
    <path id="path2" d="M20,200 L280,200" stroke="blue" />
    <circle r="5" fill="red">
        <animateMotion dur="2s" path="M20,20 L280,20" fill="freeze" />
        <animateMotion dur="2s" path="M0,0 L0,180 -260,180" additive="sum" begin="2s" fill="freeze" />
    </circle>
</svg>


### 12.4.12 `accumulate`

- accumulate控制动画重复时是否累加前次结果，主要作用于repeatCount或restart触发的重复动画
    - 适用场景‌：路径动画、位移变换等需要增量叠加的场景
    - ‌默认值‌：none（每次循环重置初始状态）
    - ‌启用累加‌：accumulate="sum"（每次循环基于前次终点继续

- 关键特性
    - additive的区别‌
        - additive控制单次动画内的值叠加
        - accumulate控制多次循环间的值累加
    - 路径动画特殊规则‌
        - 当path属性包含相对坐标（如l/h/v命令）时，累加效果更明显


- 代码

```xml
<svg width="600" height="400">
    <path id="motionPath" d="M20,50 L100,50" stroke="gray"/>
    <path id="motionPath" d="M100,100 L180,100" stroke="gray"/>
    <path id="motionPath" d="M230,150 L310,150" stroke="gray"/>
    <circle r="10" fill="red">
        <animateMotion 
            dur="2s" 
            repeatCount="3"
            accumulate="sum"
            fill="freeze"
            path="M0,0 L50,0">
            <mpath xlink:href="#motionPath"/>
        </animateMotion>
    </circle>
</svg>
```


- svg 图

<svg width="600" height="400">
    <path id="motionPath12" d="M20,50 L100,50" stroke="gray"/>
    <path id="motionPath12" d="M100,100 L180,100" stroke="gray"/>
    <path id="motionPath12" d="M230,150 L310,150" stroke="gray"/>
    <circle r="10" fill="red">
        <animateMotion dur="2s"  repeatCount="3" accumulate="sum" fill="freeze"path="M0,0 L50,0">
            <mpath xlink:href="#motionPath12"/>
        </animateMotion>
    </circle>
</svg>

### 12.4.13 `fill`

- fill属性控制动画结束后的状态保持方式，主要分为两种模式：
    - freeze‌：动画结束后保持最终状态
    - remove‌（默认）：动画结束后恢复初始状态

- 代码

```xml
<svg width="250" height="100" >
    <!-- 保持终点状态 -->
    <circle cx="50" cy="20" r="10" fill="red">
        <animateMotion 
        dur="2s" 
        path="M0,0 L180,0" 
        fill="freeze"/>
    </circle>

    <!-- 恢复初始状态 -->
    <circle cx="50" cy="80" r="10" fill="blue">
    <animateMotion 
        dur="2s" 
        path="M0,0 L180,0" 
        fill="remove"/>
    </circle>
</svg>
```

- svg 图

<svg width="250" height="100">
    <circle cx="50" cy="20" r="10" fill="red">
        <animateMotion dur="2s" path="M0,0 L180,0" fill="freeze" />
    </circle>
    <circle cx="50" cy="80" r="10" fill="blue">
        <animateMotion dur="2s" path="M0,0 L180,0" fill="remove" />
    </circle>
</svg>

## 12.5 `<set>` 属性

`<set>`是SVG动画中最简单的动画元素，用于在指定时间点直接修改属性值而不产生过渡效果。

- 主要特点：
    - 适用于非数值属性（如颜色、可见性等）
    - 无中间过渡状态，直接切换目标值
    - 常用于触发式动画或状态切换

### 12.5.1 基础语法

```xml
<set attributeName="属性名" 
     to="目标值" 
     begin="触发时机" 
     end="结束时机(可选)"/>
```

**必要属性**：

- attributeName：要修改的属性名（如fill、opacity等）
- to：目标属性值6
- begin：动画开始时间（支持事件触发如mouseover）


### 12.5.2 基础示例


1. 颜色切换

目标效果：点击时圆形从蓝色直接变红色

- 代码

```xml
<svg width="200" height="100" >
    <circle cx="50" cy="50" r="40" fill="blue">
        <set attributeName="fill" to="red" begin="click" />
    </circle>
</svg>

```

- svg 图

<svg width="200" height="100" >
    <circle cx="50" cy="50" r="40" fill="blue">
        <set attributeName="fill" to="red" begin="click" />
    </circle>
</svg>


2. 显示/隐藏控制

目标效果：2秒后矩形突然消失

- 代码

```xml
<svg width="250" height="100" >
    <rect x="10" y="10" width="100" height="50">
        <set attributeName="visibility" to="hidden" begin="2s"/>
    </rect>
</svg>
```

- svg 图

<svg width="250" height="100" >
    <rect x="10" y="10" width="100" height="50">
        <set attributeName="visibility" to="hidden" begin="2s"/>
    </rect>
</svg>

3. 事件触发动画

目标效果：鼠标悬停文字时关联矩形变色

- 代码

```xml
<svg width="200" height="200">
    <text id="tEnglish" x="100" y="100" font-size="20px" >覆盖变色</text>
    <rect fill="#E0E0E0" width="50" height="50" x="20" y="50">
        <set 
        attributeName="fill" 
        to="#FF8888" 
        begin="tEnglish.mouseover" 
        end="tEnglish.mouseout" />
    </rect>
</svg>
```

- svg 图

<svg width="200" height="200">
    <text id="tEnglish" x="100" y="100" font-size="20px" >覆盖变色</text>
    <rect fill="#E0E0E0" width="50" height="50" x="20" y="50">
        <set 
        attributeName="fill" 
        to="#FF8888" 
        begin="tEnglish.mouseover" 
        end="tEnglish.mouseout" />
    </rect>
</svg>

