# 二、绑定

## 2.1 单模块应用

1. 创建项目

    ```sh
    npx @angular/cli@16 new ng-project
    ```
2. 修改端口号

    ```js
    "start": "ng serve --port 3307",
    ```
3. 调整根目录组件

    - app.component.css 删除
    - app.component.html 删除
    - app.component.spec.ts 删除 
    - app.component.ts 修改

        ```ts
        import { Component } from '@angular/core';

        @Component({
            selector: 'app-root',
            template: `
                <router-outlet></router-outlet>
            `,
            })
        export class AppComponent {
            title = 'ng-project';
        }
        ```
4. 创建单页面组件

    - 执行命令

        ```sh
        # 进入目录
        cd src/app
        # 新建目录
        mkdir 01-oc
        # 进入应用
        cd 01-oc
        # 安装组件
        echo "" > 01.component.ts
        ```
    - 项目文件 oc-01/01.component.ts 代码

        ```ts
        import { Component } from '@angular/core';

        @Component({
            // 一定要已字母开头
            selector:"oc-01",
            // html代码直接写在这里
            template:`
                <h1>单模块应用</h1>
            `,
            // css代码 写在这里
            styles: [`
                h1 { color: red }
            `]
        })
        export class Oc01Component{
            title = "单模块应用"
        }
        ```


5. 路由中配置

    - 模块注册 app.module.ts

        ```ts{6,11}
        import { NgModule } from '@angular/core';
        import { BrowserModule } from '@angular/platform-browser';

        import { AppRoutingModule } from './app-routing.module';
        import { AppComponent } from './app.component';
        import { Oc01Component } from './01-oc/01.component';

        @NgModule({
            declarations: [
                AppComponent,
                Oc01Component,
            ],
            imports: [
                BrowserModule,
                AppRoutingModule
            ],
            providers: [],
            bootstrap: [AppComponent]
        })
        export class AppModule { }

        ```
    - 模块添加到路由 app-routing.module.ts

        ```ts
        import { NgModule } from '@angular/core';
        import { RouterModule, Routes } from '@angular/router';
        import { Oc01Component } from "./01-oc/01.component"

        const routes: Routes = [
            {
                path:"oc-01",
                component:Oc01Component,
                title:"单模块应用"
            }
        ];

        @NgModule({
            imports: [RouterModule.forRoot(routes)],
            exports: [RouterModule]
        })
        export class AppRoutingModule { }

        ```
6. 运行结果

    ![](/framework/angular/base16/006.png)

## 2.2 数据绑定

### 2.2.1 插值单项绑定

最基本的展示数据方式，使用双大括号 `{{ }}`

1. 项目文件 02-data/01.component.ts

    ```ts
    import { Component } from '@angular/core';

    @Component({
        // 一定要已字母开头
        selector:"data-01",
        // html代码直接写在这里
        template: `
            <h1>{{ title }}</h1>
            <p>当前用户: {{ currentUser.name }}</p>
            <!-- 内置了DatePipe 可以直接格式化 -->
            <p>注册时间: {{ currentUser.joinDate }}</p>
            <p>状态: {{ isActive ? '活跃' : '未激活' }}</p>
        `,
    })
    export class Data01Component{
        title = '用户信息';
        currentUser = {
            name: '张三',
            joinDate:  new Date(2020, 5, 15)
        };
        isActive = true;
    }
    ```
2. 模块注册

    ```ts
    declarations: [Data01Component]
    ```

3. 路由配置

    ```ts
    {
        path: 'data',
        children: [
            { path: '01',component: Data01Component, title: '单项绑定' },
        ],
    },
    ```
4. 运行结果

    ![](/framework/angular/base16/007.png)

### 2.2.2 双向数据绑定

使用 `[(ngModel)]` 实现双向数据绑定（需要导入 FormsModule）。


1. 主模块引入 FormsModule 

    ```ts
    import { FormsModule } from '@angular/forms';

    @NgModule({
        imports: [
            FormsModule
        ]
    })
    ```

2. 项目文件 02-data/02.component.ts

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'data-02',
        template: `
            <!-- 基本双向绑定 -->
            <input [(ngModel)]="username" placeholder="输入用户名">
            <p>当前用户名: {{ username }}</p>

            <!-- 复选框双向绑定 -->
            <input type="checkbox" [(ngModel)]="isAgreed">
            <label>我同意条款</label>

            <!-- 单选按钮双向绑定 -->
            <div>
                <input type="radio" [(ngModel)]="gender" value="male"> 男
                <input type="radio" [(ngModel)]="gender" value="female"> 女
            </div>
            <p>选择的性别: {{ gender }}</p>

            <!-- 下拉选择框双向绑定 -->
            <select [(ngModel)]="selectedCity">
                <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
            </select>
            <p>选择的城市: {{ selectedCity }}</p>
        `
    })
    export class Data02Component {
        username = '';
        isAgreed = false;
        gender = 'male';
        cities = ['北京', '上海', '广州', '深圳'];
        selectedCity = '北京';
    }
    ```
3. 模块注册

    ```ts
    declarations: [Data02Component]
    ```

4. 路由配置

    ```ts
    {
        path: 'data',
        children: [
            { path: '01',component: Data01Component, title: '单向绑定' },
            { path: '02',component: Data01Component, title: '双向绑定' },
        ],
    },
    ```
5. 运行结果

    ![](/framework/angular/base16/008.gif)

### 2.2.3 属性绑定 

使用方括号 [] 将组件属性绑定到 DOM 元素的属性上。

1. 项目文件 02-data/03.component.ts

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'data-03',
        template: `
            <!-- 绑定到标准HTML属性 -->
            <img [src]="imageUrl" [alt]="imageAlt" [width]="imageWidth">

            <!-- 绑定到自定义属性 -->
            <div [attr.data-id]="userId">用户信息</div>

            <!-- 绑定到class属性 -->
            <button [class.active]="isActive">按钮</button>

            <!-- 绑定到style属性 -->
            <p [style.color]="textColor">样式绑定示例</p>

            <!-- 绑定到多个样式 -->
            <div [style]="dynamicStyles">动态样式</div>
        `,
        styles: [`
            .active {
            background-color: #4CAF50;
            color: white;
            }
        `]
    })
    export class Data03Component {
        imageUrl = 'assets/logo.jpg';
        imageAlt = '应用Logo';
        imageWidth = 100;
        userId = 'user123';
        isActive = true;
        textColor = 'blue';
        dynamicStyles = {
            'font-size': '1.2em',
            'padding': '10px',
            'border': '1px solid #ccc'
        };
    }

    ```
2. 模块注册

    ```ts
    declarations: [Data03Component]
    ```

3. 路由配置

    ```ts
    {
        path: 'data',
        children: [
            { path: '01',component: Data01Component, title: '单向绑定' },
            { path: '02',component: Data02Component, title: '双向绑定' },
            { path: '03',component: Data03Component, title: '属性绑定' },
        ],
    },
    ```
4. 运行结果

    ![](/framework/angular/base16/009.png)


## 2.3 事件绑定

### 2.3.1 基础使用

使用 (event)="handler()" 的语法来绑定事件：

1. 代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector:"handler-01",
        template: `
            <button (click)="onClick()">点击我</button>
            <p>我的名字 {{ myname }}</p>
        `,
    })
    export class Handler01Component{
        myname = "未知"
        onClick(){
            this.myname = "张三"
        }
    }
    ```
2. 路由

    ```ts
     {
        path: 'handler',
        children: [
            { path: '01',component: Handler01Component, title: '事件绑定基础' },
        ],
     }
    ```

3. 运行结果

    ![](/framework/angular/base16/020.gif)

### 2.3.2 基础鼠标事件


1. 代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'handler-02',
        template: `
            <div (click)="handleClick($event)">单击事件</div>
            <div (dblclick)="handleDoubleClick($event)">双击事件</div>
            <div (mouseenter)="handleMouseEnter($event)">鼠标进入</div>
            <div (mouseleave)="handleMouseLeave($event)">鼠标离开</div>
            <div (mousemove)="handleMouseMove($event)">鼠标移动</div>
            <div (mousedown)="handleMouseDown($event)">鼠标按下</div>
            <div (mouseup)="handleMouseUp($event)">鼠标释放</div>
            <div (contextmenu)="handleContextMenu($event)">右键菜单</div>

            <hr>
            <div> 当前事件 {{handlerName}} </div>
        `,
    })
    export class Handler02Component {
        handlerName = "无"

        handleClick(event: MouseEvent) {
            this.handlerName = "单击事件";
            console.log('单击事件', event);
        }
        handleDoubleClick(event: MouseEvent) {
            this.handlerName = "双击事件";
            console.log('双击事件', event);
        }
        handleMouseEnter(event: MouseEvent) {
            this.handlerName = "鼠标进入元素";
            console.log('鼠标进入元素', event.target);
        }
        handleMouseLeave(event: MouseEvent) {
            this.handlerName = "鼠标离开元素";
            console.log('鼠标离开元素', event.target);
        }
        handleMouseMove(event: MouseEvent) {
            this.handlerName = "鼠标移动";
            console.log('鼠标移动', event.target);
        }
        handleMouseDown(event: MouseEvent) {
            this.handlerName = "鼠标按下";
            console.log('鼠标按下', event.target);
        }
        handleMouseUp(event: MouseEvent) {
            this.handlerName = "鼠标释放";
            console.log('鼠标释放', event.target);
        }
        handleContextMenu(event: MouseEvent) {
            this.handlerName = "右键菜单";
            console.log('右键菜单', event.target);
        }
    }

    ```
2. 路由

    ```ts
     {
        path: 'handler',
        children: [
            { path: '01',component: Handler01Component, title: '事件绑定基础' },
            { path: '02',component: Handler02Component, title: '鼠标事件' },
        ],
     }
    ```
3. 运行结果

    ![](/framework/angular/base16/021.gif)

### 2.3.3 键盘事件

1. 代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'handler-03',
        template: `
            <input
            (keydown)="handleKeyDown($event)"
            (keyup)="handleKeyUp($event)"
            (keypress)="handleKeyPress($event)"
            placeholder="输入内容"
            />
        `,
    })
    export class Handler03Component {
        handleKeyDown(event: KeyboardEvent) {
            console.log('键按下:', event.key, '键码:', event.keyCode);

            // 阻止默认行为示例
            if (event.key === 'Enter') {
            event.preventDefault();
            console.log('阻止了回车键默认行为');
            }
        }

        handleKeyUp(event: KeyboardEvent) {
            console.log('键释放:', event.key);
        }

        handleKeyPress(event: KeyboardEvent) {
            console.log('按键:', event.key);
        }
    }
    ```
2. 路由

    ```ts
     {
        path: 'handler',
        children: [
            { path: '01',component: Handler01Component, title: '事件绑定基础' },
            { path: '02',component: Handler02Component, title: '鼠标事件' },
            { path: '03',component: Handler03Component, title: '键盘事件' },
        ],
     }
    ```
### 2.3.4 表单事件

1. 代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'handler-04',
        template: `
            <input
            (input)="handleInput($event)"
            (change)="handleChange($event)"
            (blur)="handleBlur($event)"
            (focus)="handleFocus($event)"
            placeholder="表单输入"
            />
        `,
    })
    export class Handler04Component {
        handleInput(event: Event) {
            const value = (event.target as HTMLInputElement).value;
            console.log('输入值变化:', value);
        }

        handleChange(event: Event) {
            console.log('值已改变:', (event.target as HTMLInputElement).value);
        }

        handleBlur(event: Event) {
            console.log('失去焦点');
        }

        handleFocus(event: Event) {
            console.log('获得焦点');
        }
    }

    ```
2. 路由

    ```ts
     {
        path: 'handler',
        children: [
            { path: '01',component: Handler01Component, title: '事件绑定基础' },
            { path: '02',component: Handler02Component, title: '鼠标事件' },
            { path: '03',component: Handler03Component, title: '键盘事件' },
            { path: '04',component: Handler04Component, title: '表单事件' },
        ],
     }
    ```
### 2.3.5 拖拽事件


1. 代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'handler-05',
        template: `
            <div
                draggable="true"
                (dragstart)="handleDragStart($event)"
                (dragend)="handleDragEnd($event)"
                (drag)="handleDrag($event)"
            >
            可拖拽元素
            </div>

            <div
                (dragover)="handleDragOver($event)"
                (dragenter)="handleDragEnter($event)"
                (dragleave)="handleDragLeave($event)"
                (drop)="handleDrop($event)"
                class="drop-zone"
            >
            放置区域
            </div>
        `,
    })
    export class Handler05Component {
        handleDragStart(event: DragEvent) {
            console.log('开始拖拽');
            event.dataTransfer?.setData('text/plain', '拖拽数据');
        }

        handleDrop(event: DragEvent) {
            event.preventDefault();
            const data = event.dataTransfer?.getData('text/plain');
            console.log('放置数据:', data);
        }
        handleDragEnd(event: DragEvent) {
            console.log('拖拽结束');
        }
        handleDrag(event: DragEvent) {
            console.log('拖拽中');
        }
        handleDragOver(event: DragEvent) {
            console.log('拖拽相交');
        }
        handleDragEnter(event: DragEvent) {
            console.log('拖拽进入');
        }

        handleDragLeave(event: DragEvent) {
            console.log('拖拽离开');
        }
    }

    ```
2. 路由

    ```ts
     {
        path: 'handler',
        children: [
            { path: '01',component: Handler01Component, title: '事件绑定基础' },
            { path: '02',component: Handler02Component, title: '鼠标事件' },
            { path: '03',component: Handler03Component, title: '键盘事件' },
            { path: '04',component: Handler04Component, title: '表单事件' },
            { path: '05',component: Handler05Component, title: '拖拽事件' },
        ],
     }
    ```

### 2.3.6 剪贴板事件


1. 代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'handler-06',
        template: `
            <input
                (copy)="handleCopy($event)"
                (cut)="handleCut($event)"
                (paste)="handlePaste($event)"
                placeholder="尝试复制/剪切/粘贴"
            />
        `
    })
    export class Handler06Component {
        handleCopy(event: ClipboardEvent) {
            console.log('内容被复制');
        }

        handleCut(event: ClipboardEvent) {
            console.log('内容被剪切');
        }

        handlePaste(event: ClipboardEvent) {
            const pastedText = event.clipboardData?.getData('text');
            console.log('粘贴的内容:', pastedText);
        }
    }

    ```
2. 路由

    ```ts
     {
        path: 'handler',
        children: [
            { path: '01',component: Handler01Component, title: '事件绑定基础' },
            { path: '02',component: Handler02Component, title: '鼠标事件' },
            { path: '03',component: Handler03Component, title: '键盘事件' },
            { path: '04',component: Handler04Component, title: '表单事件' },
            { path: '05',component: Handler05Component, title: '拖拽事件' },
            { path: '06',component: Handler05Component, title: '剪贴板事件' },
        ],
     }
    ```

### 2.3.7 事件修饰符


1. 代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'handler-07',
        template: `
            <!-- 特定按键事件 -->
            <input (keydown.enter)="onEnterPressed()" />
            <input (keydown.arrowup)="onArrowUp()" />
            <input (keydown.escape)="onEscape()" />

            <!-- 组合键事件 -->
            <button (click.shift)="onShiftClick()">Shift+点击</button>
            <button (click.ctrl)="onCtrlClick()">Ctrl+点击</button>
            <button (click.meta)="onMetaClick()">Meta(Command)+点击</button>

            <!-- 阻止默认行为和事件冒泡 -->
            <a href="#" (click)="$event.preventDefault(); logClick()"
            >阻止默认链接行为</a
            >
            <div (click)="onOuterClick()">
                外层
                <div (click)="$event.stopPropagation(); onInnerClick()">
                    内层(阻止冒泡)
                </div>
            </div>
        `,
    })
    export class Handler07Component {
        onEnterPressed() {}
        onArrowUp() {}
        onEscape() {}
        onShiftClick() {}
        onCtrlClick() {}
        onMetaClick() {}
        logClick() {}
        onOuterClick() {}
        onInnerClick() {}
    }

    ```
2. 路由

    ```ts
     {
        path: 'handler',
        children: [
            { path: '01',component: Handler01Component, title: '事件绑定基础' },
            { path: '02',component: Handler02Component, title: '鼠标事件' },
            { path: '03',component: Handler03Component, title: '键盘事件' },
            { path: '04',component: Handler04Component, title: '表单事件' },
            { path: '05',component: Handler05Component, title: '拖拽事件' },
            { path: '06',component: Handler05Component, title: '剪贴板事件' },
            { path: '07',component: Handler05Component, title: '事件修饰符' },
        ],
     }
    ```