
# 三、指令

## 3.1 结构指令

### 3.3.1 *ngFor指令

1. 指令介绍

    - 基础使用

        ```html
        <ul>
            <li *ngFor="let item of items; let i = index">
                {{ i + 1 }}. {{ item }}
            </li>
        </ul>
        ```
    - 通过 trackBy 设置索引

        ```ts
        // 组件中定义trackBy函数
        trackById(index: number, item: any): number {
            return item.id; // 返回唯一标识符
        }
        ```

        ```html
        <ul>
            <li *ngFor="let item of items; trackBy: trackById">
                {{ item.name }}
            </li>
        </ul>
        ```
    - 与异步数据结合

        ```html
        <ul>
        <li *ngFor="let item of items$ | async">
            {{ item }}
        </li>
        </ul>
        ```
2. 项目文件 

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'structure-01',
        template: `
            <h2>产品列表</h2>
            <ul>
            <li *ngFor="let product of products; let i = index">
                {{ i + 1 }}. {{ product.name }} - {{ product.price }}
            </li>
            </ul>

            <h2>带条件的列表</h2>
            <div *ngFor="let user of users">
            <div *ngIf="user.active" class="user-card">
                {{ user.name }} ({{ user.email }})
            </div>
            </div>
        `,
        styles: [
            `
            .user-card {
                padding: 10px;
                margin: 5px;
                border: 1px solid #ddd;
            }
            `,
        ],
    })
    export class Structure01Component {
        products = [
            { name: '笔记本电脑', price: 5999 },
            { name: '智能手机', price: 2999 },
            { name: '平板电脑', price: 1999 },
        ];

        users = [
            { name: '张三', email: 'zhang@example.com', active: true },
            { name: '李四', email: 'li@example.com', active: false },
            { name: '王五', email: 'wang@example.com', active: true },
        ];
    }
    ```
3. 路由配置

    ```ts
    {
        path: 'data',
        children: [
           {
                path: '01',
                component: Data01Component,
                title: '插值表达式',
            },
            {
                path: '02',
                component: Data02Component,
                title: '*ngfor循环',
            },
        ],
    },
    ```
4. 运行结果

    ![](/framework/angular/base16/010.png)

### 3.3.2 *ngIf指令

1. 指令详解

    - 条件表达式示例

        ```html
        <!-- 布尔值 -->
        <div *ngIf="isLoggedIn">欢迎回来！</div>

        <!-- 比较运算 -->
        <div *ngIf="score > 60">及格</div>

        <!-- 逻辑运算 -->
        <div *ngIf="isAdmin && hasPermission">管理员面板</div>

        <!-- 非空检查 -->
        <div *ngIf="user">用户名: {{user.name}}</div>
        ```
    - 结合 else 使用

        Angular 提供了 else 语法来显示条件不满足时的内容：

        ```html
        <div *ngIf="condition; else elseBlock">
            条件为真时显示
        </div>

        <ng-template #elseBlock>
            <div>条件为假时显示</div>
        </ng-template>
        ```
    - 使用 then/else 语法
        ```html
        <ng-container *ngIf="condition; then thenBlock; else elseBlock"></ng-container>

        <ng-template #thenBlock>
        <div>条件为真时显示</div>
        </ng-template>

        <ng-template #elseBlock>
        <div>条件为假时显示</div>
        </ng-template>
        ```
    - 与异步数据结合 使用 async 管道

        ```html
        <div *ngIf="data$ | async as data; else loading">
        数据加载完成: {{ data }}
        </div>

        <ng-template #loading>
            <div>加载中...</div>
        </ng-template>
        ```
2. 项目文件 

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'structure-02',
        template: `
            <div *ngIf="isLoggedIn; else loginPrompt">
                <p>欢迎回来, {{ userName }}!</p>
                <button (click)="logout()">退出登录</button>
            </div>

            <ng-template #loginPrompt>
                <p>请登录以查看内容</p>
                <button (click)="login()">登录</button>
            </ng-template>

            <div [hidden]="!hasMessages">
                <h3>您的消息</h3>
                <p>{{ message }}</p>
            </div>
        `
    })
    export class Structure03Component {
        isLoggedIn = false;
        userName = '张三';
        hasMessages = true;
        message = '您有3条未读消息';

        login() {
            this.isLoggedIn = true;
        }

        logout() {
            this.isLoggedIn = false;
        }
    }
    ```

3. 运行结果

    ![](/framework/angular/base16/011.gif)

### 3.3.3 ngSwitch指令

1. 指令详解 (多条件渲染)

    ```html
    <div [ngSwitch]="status">
        <span *ngSwitchCase="'success'">成功</span>
        <span *ngSwitchDefault>默认</span>
    </div>
    ```
2. 项目文件 

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'switch-01',
        template: `
            <h3>用户状态显示</h3>

            <select [(ngModel)]="userStatus">
                <option value="active">活跃</option>
                <option value="inactive">非活跃</option>
                <option value="pending">待审核</option>
            </select>

            <div [ngSwitch]="userStatus">
                <div *ngSwitchCase="'active'">✅ 用户处于活跃状态</div>
                <div *ngSwitchCase="'inactive'">⏸️ 用户非活跃</div>
                <div *ngSwitchCase="'pending'">⏳ 用户等待审核中</div>
                <div *ngSwitchDefault>❓ 未知状态</div>
            </div>

            <h4>消息类型</h4>
                <div [ngSwitch]="messageType">
                <div *ngSwitchCase="'success'">🎉 操作成功！</div>
                <div *ngSwitchCase="'error'">❗ 发生错误</div>
                <div *ngSwitchDefault>ℹ️ 普通信息</div>
            </div>
        `
    })
    export class Switch01Component {
        userStatus = 'active';
        messageType = 'info';
    }

    ```

3. 运行结果

    ![](/framework/angular/base16/074.gif)

## 3.2 组件指令(父子组件)

### 3.2.1 基础认识

组件本质上是一种带有模板的指令，是最常见的指令类型

1. 代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'app-child-01',
        template: `<h1>Hello, {{name}}!</h1>`,
        styles: [`h1 { color: blue; }`]
    })
    export class Child01Component  {
        name = '我是子组件';
    }


    @Component({
    selector: 'app-parent-02',
        // 使用组件指令 app-child-01 调用了其他组件
        template: `
            <h2>{{name}}</h2>
            <app-child-01></app-child-01>
        `
    })
    export class Parent01Component {
        name = '父组件';
    }
    ```
2. 组件注册

    ```ts
     declarations: [Child01Component,Parent01Component]
    ```
3. 路由配置

    ```ts
    {
        path: 'component',
        children: [
            { path: '01',component: Parent01Component, title: '组件指令' },
        ],
    },
    ```
4. 运行结果

    ![](/framework/angular/base16/012.png)

### 3.2.2 父传子（@Input）

1. 代码

    ```ts
    import { Component, Input } from '@angular/core';

    @Component({
    selector: 'app-child-02',
        template: `
            <h3>子组件</h3>
            <p>来自父组件的消息: {{ messageFromParent }}</p>
            <p>用户年龄: {{ user.age }}</p>
        `
    })
    export class Child02Component {
        // 使用input接收父组件的消息
        @Input() messageFromParent: string = '';
        @Input() user: any = {};
    }

    @Component({
        selector: 'app-parent-02',
        template: `
            <h2>父组件</h2>
            <app-child-02
            [messageFromParent]="parentMessage"
            [user]="currentUser">
            </app-child-02>
        `
    })
    export class Parent02Component {
        parentMessage = '你好，子组件！';
        currentUser = { name: '张三', age: 30 };
    }

    ```
2. 组件注册

    ```ts
     declarations: [Child02Component,Parent02Component]
    ```
3. 路由配置

    ```ts
    {
        path: 'component',
        children: [
            { path: '01',component: Parent01Component, title: '组件指令' },
            { path: '02',component: Parent02Component, title: '父传子' },
        ],
    },
    ```
4. 运行结果

    ![](/framework/angular/base16/013.png)


### 3.2.3 子传父（@output）

1. 代码

    ```ts
    import { Component, Output, EventEmitter } from '@angular/core';

    // 子组件
    @Component({
        selector: 'app-child-03',
        template: `
            <button (click)="sendMessage()">发送消息给父组件</button>
            <button (click)="updateCount()">增加计数</button>
        `
    })
    export class Child03Component {
        // 绑定父组件的方法
        @Output() messageEvent = new EventEmitter<string>();
        @Output() countChanged = new EventEmitter<number>();

        private count = 0;

        sendMessage() {
            // 通过emit传递
            this.messageEvent.emit('来自子组件的问候!');
        }

        updateCount() {
            this.count++;
            this.countChanged.emit(this.count);
        }
    }

    // 父组件
    @Component({
        selector: 'app-parent-03',
        template: `
            <h2>父组件</h2>
            <p>来自子组件的消息: {{ childMessage }}</p>
            <p>子组件计数: {{ childCount }}</p>

            <app-child-03
            (messageEvent)="receiveMessage($event)"
            (countChanged)="handleCountChange($event)">
            </app-child-03>
        `
    })
    export class Parent03Component {
        childMessage = '';
        childCount = 0;

        receiveMessage(message: string) {
            this.childMessage = message;
        }

        handleCountChange(count: number) {
            this.childCount = count;
        }
    }
    ```

2. 组件注册

    ```ts
     declarations: [Child03Component,Parent03Component]
    ```
3. 路由配置

    ```ts
    {
        path: 'component',
        children: [
            { path: '01',component: Parent01Component, title: '组件指令' },
            { path: '02',component: Parent02Component, title: '父传子' },
            { path: '03',component: Parent03Component, title: '子传父' },
        ],
    },
    ```
4. 运行结果

    ![](/framework/angular/base16/014.gif)

### 3.2.4 模板变量ref

1. 代码

    ```ts
    import { Component, ViewChild } from '@angular/core';

    // 子组件
    @Component({
        selector: 'app-child-04',
        template: `<p>子组件内容</p>`
    })
    export class Child04Component {
        childStatus = '活跃';

        doSomething() {
            console.log('子组件方法被调用');
            this.childStatus = '处理中...';
        }
    }

    // 父组件
    @Component({
        selector: 'app-parent-04',
        template: `
            <app-child-04 #childRef></app-child-04>
            <button (click)="callChildMethod()">调用子组件方法</button>
            <p>子组件状态: {{ childRef.childStatus }}</p>
        `
    })
    export class Parent04Component {
        @ViewChild('childRef') childComponent!: Child04Component;

        callChildMethod() {
            this.childComponent.doSomething();
        }
    }
    ```
 
2. 组件注册

    ```ts
     declarations: [Child04Component,Parent04Component]
    ```
3. 路由配置

    ```ts
    {
        path: 'component',
        children: [
            { path: '01',component: Parent01Component, title: '组件指令' },
            { path: '02',component: Parent02Component, title: '父传子' },
            { path: '03',component: Parent03Component, title: '子传父' },
            { path: '04',component: Parent04Component, title: '使用ref' },
        ],
    },
    ```
4. 运行结果

    ![](/framework/angular/base16/015.gif)

### 3.2.5 通过服务发送

1. 设置服务

    ```ts
    // data.service.ts
    import { Injectable } from '@angular/core';
    import { Subject } from 'rxjs';

    @Injectable({ providedIn: 'root' })
    export class DataService {
        private parentToChild = new Subject<string>();
        private childToParent = new Subject<number>();

        parentToChild$ = this.parentToChild.asObservable();
        childToParent$ = this.childToParent.asObservable();

        sendToChild(message: string) {
            this.parentToChild.next(message);
        }

        sendToParent(count: number) {
            this.childToParent.next(count);
        }
    }
    ```
2. 代码

    ```ts
    import { Component } from '@angular/core';
    import { DataService } from '../data.service';

    // 子组件
    @Component({
        selector: 'app-child-05',
        template: `
            <p>来自服务的消息: {{ serviceMessage }}</p>
            <button (click)="sendCount()">通过服务发送计数</button>
        `
    })
    export class Child05Component {
        serviceMessage = '';

        constructor(private dataService: DataService) {
            this.dataService.parentToChild$.subscribe(msg => {
            this.serviceMessage = msg;
            });
        }

        sendCount() {
            this.dataService.sendToParent(Math.floor(Math.random() * 100));
        }
    }

    // 父组件
    @Component({
        selector: 'app-parent-05',
        template: `
            <button (click)="sendMessage()">通过服务发送</button>
            <app-child-05></app-child-05>
            <p>来自服务的计数: {{ serviceCount }}</p>
        `
    })
    export class Parent05Component {
        serviceCount = 0;

        constructor(private dataService: DataService) {
            this.dataService.childToParent$.subscribe(count => {
            this.serviceCount = count;
            });
        }

        sendMessage() {
            this.dataService.sendToChild('通过服务传递的消息');
        }
    }
    ```
3. 运行结果

    ![](/framework/angular/base16/016.gif)

## 3.3 属性指令-自定义指令

### 3.3.1 基础属性指令实现

1. 自定义指令 directive/focus.directive.ts

    ```ts
    import { Directive, ElementRef, AfterViewInit } from '@angular/core';

    @Directive({
        selector: '[appAutoFocus]'
    })
    export class AutoFocusDirective implements AfterViewInit {
        constructor(private el: ElementRef) {}

        ngAfterViewInit() {
            this.el.nativeElement.focus();
        }
    }
    ```
2. 使用 自定义指令的代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'attr-01',
        template: `
            <input appAutoFocus placeholder="自动获取焦点">
        `,
    })
    export class Attr01Component {}
    ```
3. 使用 app.module 注册

    ```ts
    declarations[AutoFocusDirective,Attr01Component]
    ```
4. 路由

    ```ts
    {
        path: 'attr',
        children: [
            { path: '01',component: Attr01Component, title: '基础属性指令' },
        ],
    },
    ```

5. 运行结果

    ![](/framework/angular/base16/017.gif)

### 3.3.2 带输入参数的指令


1. 自定义指令 directive/focus.directive.ts

    ```ts
    import { Directive, Input, HostBinding } from '@angular/core';

    @Directive({
        selector: '[appDynamicBorder]'
    })
    export class DynamicBorderDirective {
        @Input() borderColorOther: string = '1px solid';
        @Input() borderColor: string = '#ccc';

        // get borderStyle() 等于是一个组合的参数
        @HostBinding('style.border') get borderStyle() {
            return `${this.borderColor} ${this.borderColorOther}`;
        }

        @HostBinding('style.padding') padding = '10px';
    }

    ```
2. 使用 自定义指令的代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'attr-02',
        template: `
            <div appDynamicBorder borderColor="#ff0">红色边框</div>
        `,
    })
    export class Attr02Component {}

    ```
3. 使用 app.module 注册

    ```ts
    declarations[AutoFocusDirective,Attr01Component]
    ```
4. 路由

    ```ts
    {
        path: 'attr',
        children: [
            { path: '01',component: Attr01Component, title: '基础属性指令' },
            { path: '02',component: Attr02Component, title: '带参数指令' },
        ],
    },
    ```
5. 运行结果

    ![](/framework/angular/base16/018.png)


### 3.3.3 响应式指令

1. 自定义指令 directive/focus.directive.ts

    ```ts
    import { Directive, ElementRef, Input, OnDestroy, OnInit, Renderer2 } from '@angular/core';
    import { fromEvent, Subscription } from 'rxjs';
    import { debounceTime } from 'rxjs/operators';

    @Directive({
        selector: '[appResponsiveSize]',
    })
    export class ResponsiveSizeDirective implements OnInit, OnDestroy {
        @Input() appResponsiveSize: { sm: string; md: string; lg: string } = {
            sm: '12px',
            md: '16px',
            lg: '20px'
        };

        private resizeSubscription!: Subscription;

        constructor(private el: ElementRef, private renderer: Renderer2) {}

        ngOnInit() {
            this.updateFontSize();
            this.resizeSubscription = fromEvent(window, 'resize')
            .pipe(debounceTime(100))
            .subscribe(() => this.updateFontSize());
        }

        ngOnDestroy() {
            if (this.resizeSubscription) {
            this.resizeSubscription.unsubscribe();
            }
        }

        private updateFontSize() {
            const width = window.innerWidth;
            let size: string;

            if (width < 576) {
                size = this.appResponsiveSize.sm;
            } else if (width >= 576 && width < 992) {
                size = this.appResponsiveSize.md;
            } else {
                size = this.appResponsiveSize.lg;
            }

            this.renderer.setStyle(this.el.nativeElement, 'font-size', size);
        }
    }

    ```
2. 使用 自定义指令的代码

    ```ts
   import { Component } from '@angular/core';

    @Component({
        selector: 'attr-03',
        template: `
            <p [appResponsiveSize]="{ sm: '14px', md: '18px', lg: '22px' }">
            我的字号会根据屏幕大小变化
            </p>
        `,
    })
    export class Attr03Component {}
    ```

3. 使用 app.module 注册

    ```ts
    declarations[ResponsiveSizeDirective,Attr03Component]
    ```
4. 路由

    ```ts
    {
        path: 'attr',
        children: [
            { path: '01',component: Attr01Component, title: '基础属性指令' },
            { path: '02',component: Attr02Component, title: '带参数指令' },
            { path: '03',component: Attr03Component, title: '响应式属性指令' },
        ],
    },
    ```
5. 运行结果

    ![](/framework/angular/base16/019.gif)



## 3.4 内置属性指令-样式

### 3.4.1 style 样式绑定指令

1. `[style.property]` - 单一样式绑定

    - 组件

        ```ts
        @Component({
            selector: 'style-01',
            template: `
                <div [style.color]="textColor">这段文字的颜色会变化</div>
                <div [style.font-size.px]="fontSize">字体大小可调节</div>
                <button (click) = "increaseFont()">字体增大</button>
            `,
        })
        export class Sytel01Component {
            textColor = 'red';
            fontSize = 16;

            increaseFont() {
                this.fontSize += 2;
            }
        }
        ```
    - 运行结果

        ![](/framework/angular/base16/055.gif)

2. `[style]` - 多样式绑定

    - 组件
    
        ```ts
        @Component({
            selector: 'style-02',
            template: `
                <!-- 绑定多个样式属性 -->
                <div [style]="currentStyles">这个div的样式会动态变化</div>
                <button (click) = "updateStyles()">更新样式</button>
            `,
        })
        export class Sytel02Component {

            currentStyles = {
                'font-style': 'italic',
                'font-weight': 'bold',
                'background-color': '#f0f0f0'
            };

            updateStyles() {
                this.currentStyles = {
                ...this.currentStyles,
                'background-color':'#ff00ff'
                };
            }
        }
        ```
    - 运行结果

        ![](/framework/angular/base16/056.gif)

3. 带单位的样式绑定

    - 组件

        ```ts   
        @Component({
            selector: 'style-03',
            template: `
                <!-- 绑定多个样式属性 -->
                <div [style.height.px]="width" [style.width.%]="height">1</div>
                <div [style.margin.rem]="margin">2</div>
            `,
            styles:[`
                div{
                background-color: pink;
                }
            `]
        })
        export class Sytel03Component {
            width = 200;
            height = 10;
            margin = 5;
        }

        ```
    - 运行结果

        ![](/framework/angular/base16/057.png)

### 3.4.2 ngStyle 动态内联样式

>注意：必须在跟组件中注册

1. 对象语法

    - 组件

        ```ts
        @Component({
            selector: 'ngstyle-01',
            template: `
                <div [ngStyle]="{'color': textColor, 'font-size.px': fontSize}">
                这段文字的颜色会变化
                </div>
                <button (click) = "increaseFont()">字体增大</button>
            `,
        })
        export class NgSytel01Component {
            textColor = 'red';
            fontSize = 16;

            increaseFont() {
                this.fontSize += 2;
            }
        }
        ```
    - 运行结果

        ![](/framework/angular/base16/058.gif)

2. 根据条件设置样式

    - 组件
    
        ```ts
        @Component({
            selector: 'style-02',
            template: `
                <!-- 绑定多个样式属性 -->
                <div [style]="currentStyles">这个div的样式会动态变化</div>
                <button (click) = "updateStyles()">更新样式</button>
            `,
        })
        export class Sytel02Component {

            currentStyles = {
                'font-style': 'italic',
                'font-weight': 'bold',
                'background-color': '#f0f0f0'
            };

            updateStyles() {
                this.currentStyles = {
                ...this.currentStyles,
                'background-color':'#ff00ff'
                };
            }
        }
        ```
    - 运行结果

        ![](/framework/angular/base16/059.png)

3. 使用组件方法返回样式对象

    - 组件

        ```ts   
        @Component({
            selector: 'style-03',
            template: `
                <!-- 绑定多个样式属性 -->
                <div [style.height.px]="width" [style.width.%]="height">1</div>
                <div [style.margin.rem]="margin">2</div>
            `,
            styles:[`
                div{
                background-color: pink;
                }
            `]
        })
        export class Sytel03Component {
            width = 200;
            height = 10;
            margin = 5;
        }

        ```
    - 运行结果

        ![](/framework/angular/base16/060.png)


### 3.4.3 类绑定指令 class

- 组件

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'class-01',
        template: `
            <p [class.active]="showType">被改变样式的文字</p>
            <button (click)="changeColor()">点击后改变颜色</button>
        `,
        styles:[`
            .active {
            font-weight: bold;
            color: red;
            font-size:20px;
            }
        `]
    })
    export class Class01Component {
        showType = false
        changeColor(){
            this.showType = !this.showType
        }
    }
    ```
- 运行结果

    ![](/framework/angular/base16/061.gif)

### 3.4.4 ngClass 加载动态样式

1. 对象语法

    - 组件

        ```ts
        import { Component } from '@angular/core';

        @Component({
            selector: 'ngClass-01',
            template: `
                <!-- 根据条件添加类 -->
                <div [ngClass]="{ 'active': isActive, 'error': hasError }">
                对象语法示例
                </div>

                <!-- 使用组件属性 -->
                <button [ngClass]="buttonClasses">点击我</button>

                <!-- 动态计算 -->
                <div [ngClass]="{
                'text-success': score >= 80,
                'text-warning': score >= 60 && score < 80,
                'text-danger': score < 60
                }">
                分数: {{ score }}
                </div>
            `,
            styles:[`
                /* 状态样式 */
                .active { background-color: #e3f2fd; }
                .error { border-color: red; color: red; }

                /* 按钮样式 */
                .btn { padding: 8px 16px; border: none; cursor: pointer; }
                .btn-primary { background: blue; color: white; }
                .btn-disabled { opacity: 0.5; cursor: not-allowed; }

                /* 文本样式 */
                .text-success { color: green; }
                .text-warning { color: orange; }
                .text-danger { color: red; }
            `]
        })
        export class NgClass01Component {
            isActive = true;
            hasError = false;
            score = 75;

            buttonClasses = {
                'btn': true,
                'btn-primary': true,
                'btn-disabled': false
            };
        }
        ```
    - 运行结果

        ![](/framework/angular/base16/062.png)

2. 数组语法

    - 组件
    
        ```ts
        @Component({
            selector: 'ngClass-02',
            template: `
                <!-- 静态类数组 -->
                <div [ngClass]="['base-class', 'additional-class']">
                    静态类数组
                </div>

                <!-- 混合静态和动态类 -->
                <div [ngClass]="['card', isFeatured ? 'featured' : '']">
                    卡片内容
                </div>

                <!-- 使用组件方法返回数组 -->
                <div [ngClass]="getClasses()">
                    动态类数组
                </div>

                <!-- 条件类组合 -->
                <button [ngClass]="[
                    'btn',
                    type === 'primary' ? 'btn-primary' : 'btn-secondary',
                    size === 'large' ? 'btn-lg' : ''
                ]">
                    按钮
                </button>
            `,
            styles:[`
                /* 基础样式 */
                .base-class { padding: 10px; margin: 5px; }
                .additional-class { border: 1px solid #ccc; }

                /* 卡片样式 */
                .card { border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
                .featured { border: 2px solid gold; }

                /* 用户卡片 */
                .user-card { padding: 15px; margin: 10px; }
                .highlighted {
                    background-color: #fff3cd;
                    border-color: #ffc107;
                    box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
                }
                .animated {
                    animation: pulse 2s infinite;
                }
                @keyframes pulse {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                    100% { transform: scale(1); }
                }


                /* 按钮样式 */
                .btn { padding: 8px 16px; border: none; cursor: pointer; }
                .btn-primary { background: blue; color: white; }
                .btn-secondary { background: gray; color: white; }
                .btn-disabled { opacity: 0.5; cursor: not-allowed; }
                .btn-lg { font-size:"22px" }

            `]
        })
        export class NgClass02Component {
            isFeatured = true;
            type = 'primary';
            size = 'large';

            getClasses() {
                return [
                    'user-card',
                    this.isFeatured ? 'highlighted' : '',
                    'animated'
                ];
            }
        }

        ```
    - 运行结果

        ![](/framework/angular/base16/063.gif)

3. 字符串语法

    - 组件

        ```ts   
        @Component({
            selector: 'ngClass-03',
            template: `
                <!-- 直接字符串 -->
                <div [ngClass]="'class1 class2 class3'">
                    字符串语法
                </div>

                <!-- 动态字符串 -->
                <div [ngClass]="currentClassString">
                    动态类字符串
                </div>

                <!-- 条件字符串 -->
                <div [ngClass]="isSpecial ? 'special highlighted' : 'normal'">
                    条件类字符串
                </div>

                <!-- 使用模板字符串 -->
                <div [ngClass]="'base-' + variant + ' size-' + size">
                    模板字符串类
                </div>
            `,
            styles:[`
                .class1 { color: red }
                .class2 { font-size: 22px }
                .class3 { font-weight: bold }
                .alert { padding: 10px;background-color:pink }
                .alert-info { color: orange; font-size: 12px }
                .special { font-style: italic }
                .highlighted {
                    background-color: #fff3cd;
                    border-color: #ffc107;
                    box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
                }
                .base-primary {
                    background-color: #77ec5fff;
                }
                .size-large {
                    font-size: 26px
                }
            `]
        })
        export class NgClass03Component {
            currentClassString = 'alert alert-info';
            isSpecial = true;
            variant = 'primary';
            size = 'large';
        }
        ```
    - 运行结果

        ![](/framework/angular/base16/064.png)

## 3.5 内置属性指令-表单


### 3.4.1 表单指令介绍

1. 指令类型

    | 指令              | 适用策略 | 作用与描述                                                                          |
    |-----------------|------|--------------------------------------------------------------------------------|
    | ngModelGroup    | 模板驱动 | 为模板驱动表单中的一组控件创建一个顶级 FormGroup 的子组。用于分组验证和组织数据。                                 |
    | formControl     | 响应式  | 将一个现有的、在组件类中创建的 FormControl 实例绑定到模板中的一个表单控件上。                                  |
    | formControlName | 响应式  | 将一个现有的、在组件类中创建的 FormControl 实例（它是父 FormGroup 的一部分）通过其名称绑定到模板中的一个表单控件上。         |
    | formGroup       | 响应式  | 将一个现有的、在组件类中创建的 FormGroup 实例绑定到一个 `<form>` 元素上。                                  |
    | formGroupName   | 响应式  | 将一个嵌套的、在组件类中创建的 FormGroup 实例（它是父 FormGroup 的一部分）通过其名称绑定到模板中的一个 DOM 元素（如 div）上。 |
    | formArrayName   | 响应式  | 将一个嵌套的、在组件类中创建的 FormArray 实例（它是父 FormGroup 的一部分）通过其名称绑定到模板中的一个 DOM 元素上。        |

2. 前置准备

    ```ts
    import { NgModule } from '@angular/core';
    import { BrowserModule } from '@angular/platform-browser';
    import { FormsModule, ReactiveFormsModule } from '@angular/forms';

    import { AppComponent } from './app.component';

    @NgModule({
        declarations: [AppComponent],
        imports: [
            BrowserModule,
            FormsModule,        // 用于模板驱动表单
            ReactiveFormsModule // 用于响应式表单
        ],
        bootstrap: [AppComponent]
    })
    export class AppModule { }
    ```

### 3.4.2  `ngModel` 验证表单

1. 状态属性详解

    1. valid / invalid
        - 作用: 表示控件的验证状态。
        - valid: true - 控件的值通过了所有验证规则
        - invalid: true - 控件的值未通过至少一个验证规则
    2. touched / untouched
        - 作用: 表示用户是否与控件发生过交互（聚焦后又失焦）。
        - touched: true - 用户已经聚焦过该控件然后离开了（blur）
        - untouched: true - 用户从未聚焦过该控件，或者聚焦后还未离开
    3. dirty / pristine
        - 作用: 表示用户是否修改过控件的值。
        - dirty: true - 用户已经修改过控件的值（至少输入过一次）
        - pristine: true - 控件的值仍然是初始值，用户从未修改过
    4. 内置验证器对应的 errors
        1. required - 必填验证

            ```ts
            // 当值为空时
            nameCtrl.errors = { 'required': true }
            ```
        2. minlength - 最小长度验证

            ```ts
            // 当输入 "abc" (长度3) 时
            pwdCtrl.errors = {
                'minlength': {
                    requiredLength: 6,
                    actualLength: 3
                }
            }
            ```
        3. maxlength - 最大长度验证

            ```ts
            // 当输入超过50个字符时
            titleCtrl.errors = {
                'maxlength': {
                    requiredLength: 50,
                    actualLength: 55
                }
            }
            ```
        4. email - 邮箱格式验证

            ```ts
            // 当输入 "invalid-email" 时
            emailCtrl.errors = { 'email': true }
            ```
        5. pattern - 正则表达式验证

            ```ts
            // 当输入 "abc123" 时
            phoneCtrl.errors = {
                'pattern': {
                    requiredPattern: '^[0-9]{10}$',
                    actualValue: 'abc123'
                }
            }
            ```
2. 代码展示

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'ngMode-01',
        template: `
        <input
            type="email"
            name="email"
            [(ngModel)]="userEmail"
            required
            email
            #emailCtrl="ngModel">

            <div *ngIf="emailCtrl.invalid && emailCtrl.touched">
                <div *ngIf="emailCtrl.errors?.['required']">邮箱必填</div>
                <div *ngIf="emailCtrl.errors?.['email']">邮箱格式不正确</div>
            </div>

            <p>控件状态:
                Valid: {{ emailCtrl.valid }},
                Touched: {{ emailCtrl.touched }},
                Dirty: {{ emailCtrl.dirty }}
            </p>
        `,
    })
    export class NgModel01Component {
        userEmail:string = ''
    }
    ```
3. 运行结果

    ![](/framework/angular/base16/065.gif)

### 3.4.3 ngModelGroup - 分组示例

1. 组件代码

    ```ts  
    @Component({
        selector: 'ngModelGroup-01',
        template: `
            <form #userForm="ngForm">

                <!-- 单个字段 -->
                <div>
                    <label>用户名:</label>
                    <input [(ngModel)]="user.username" name="username" placeholder="输入用户名">
                </div>

                <!-- 地址信息分组 -->
                <div ngModelGroup="address" 
                    style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;"
                >
                    <h3>地址信息</h3>

                    <div>
                        <label>街道:</label>
                        <input [(ngModel)]="user.address.street" name="street" placeholder="输入街道">
                    </div>

                    <div>
                        <label>城市:</label>
                        <input [(ngModel)]="user.address.city" name="city" placeholder="输入城市">
                    </div>

                    <div>
                        <label>邮编:</label>
                        <input [(ngModel)]="user.address.zipCode" name="zipCode" placeholder="输入邮编">
                    </div>
                </div>

                <!-- 显示表单值 -->
                <div style="margin-top: 20px;">
                    <h4>当前表单值:</h4>
                    <pre>{{ userForm.value | json }}</pre>
                </div>

            </form>
        `,
    })
    export class NgModelGroup01Component {
        user = {
            username: '',
            address: {
                street: '',
                city: '',
                zipCode: ''
            }
        };
    }
    ```
2. 运行结果

    ![](/framework/angular/base16/066.gif)

### 3.4.4 formControl - 独立控件

1. 组件代码

    ```ts
    import { Component } from '@angular/core';
    import { FormControl,Validators } from '@angular/forms';

    @Component({
        selector: 'formControl-01',
        template: `
            <input type="text" [formControl]="usernameControl">
            <p>值: {{ usernameControl.value }}</p>
            <p>状态: {{ usernameControl.status }}</p>
        `,
    })
    export class FormControl01Component {
        usernameControl = new FormControl('初始值', {
            validators: [Validators.required, Validators.minLength(3)]
        });
    }
    ```
2. 运行结果

    ![](/framework/angular/base16/067.gif)

### 3.4.5 formGroup + formControlName - 基本表单

1. 组件代码

    ```ts
    import { Component } from '@angular/core';
    import { FormGroup, FormControl, Validators } from '@angular/forms';

    @Component({
        selector: 'baseForml-01',
        template: `
            <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
                <input type="text" formControlName="username" placeholder="用户名">
                <input type="password" formControlName="password" placeholder="密码">

                <button type="submit" [disabled]="!loginForm.valid">登录</button>
            </form>

            <p>表单值: {{ loginForm.value | json }}</p>
            <p>表单状态: {{ loginForm.status }}</p>
        `,
    })
    export class BaseForm01Component {
        loginForm = new FormGroup({
            username: new FormControl('', Validators.required),
            password: new FormControl('', [Validators.required, Validators.minLength(6)])
        });

        onSubmit() {
            console.log('提交的数据:', this.loginForm.value);
        }
    }
    ```
2. 运行结果

    ![](/framework/angular/base16/068.gif)

### 3.4.6 formGroupName - 嵌套分组

1. 组件代码

    ```ts
    import { Component } from '@angular/core';
    import { FormGroup, FormControl, Validators } from '@angular/forms';

    @Component({
        selector: 'formGroupName-01',
        template: `
            <form [formGroup]="userForm">
                <input type="text" formControlName="name" placeholder="姓名">

                <div formGroupName="contact">
                    <input type="email" formControlName="email" placeholder="邮箱">
                    <input type="tel" formControlName="phone" placeholder="电话">
                </div>
            </form>

            <p>表单值: {{ userForm.value | json }}</p>
            <p>表单状态: {{ userForm.status }}</p>
        `,
    })
    export class FormGroupName01Component {
        userForm = new FormGroup({
            name: new FormControl('', Validators.required),
            contact: new FormGroup({
                email: new FormControl('', [Validators.required,Validators.email]),
                phone: new FormControl('', [Validators.required,Validators.minLength(11)])
            })
        });
    }

    ```
2. 运行结果

    ![](/framework/angular/base16/069.gif)

### 3.4.7 formArrayName - 动态表单数组

1. 组件代码

    ```ts
    import { Component } from '@angular/core';
    import { FormGroup, FormArray, FormControl } from '@angular/forms';

    @Component({
        selector: 'FormArray-01',
        template: `
            <h3>兴趣爱好列表</h3>
            <form [formGroup]="userForm">
                <div formArrayName="hobbies">
                    <div *ngFor="let hobby of hobbies.controls; let i = index" class="hobby-item">
                        <input [formControlName]="i" placeholder="输入爱好">
                        <button type="button" (click)="removeHobby(i)">删除</button>
                    </div>
                </div>

                <button type="button" (click)="addHobby()">添加爱好</button>

                <div>
                    <h4>当前爱好:</h4>
                    <pre>{{ hobbies.value | json }}</pre>
                    <p>共有 {{ hobbies.length }} 个爱好</p>
                </div>
            </form>
        `,
        styles: [`
            .hobby-item {
                margin: 10px 0;
                display: flex;
                gap: 10px;
            }
            button {
                padding: 5px 10px;
            }
        `]
    })
    export class FormArray01Component {
        userForm: FormGroup;

        constructor() {
            this.userForm = new FormGroup({
            hobbies: new FormArray([
                new FormControl('游泳'),
                new FormControl('阅读')
            ])
            });
        }

        // 获取 hobbies FormArray
        get hobbies() {
            return this.userForm.get('hobbies') as FormArray;
        }

        // 添加新爱好
        addHobby() {
            this.hobbies.push(new FormControl(''));
        }

        // 删除爱好
        removeHobby(index: number) {
            this.hobbies.removeAt(index);
        }
    }

    ```
2. 运行结果

    ![](/framework/angular/base16/070.gif)

### 3.4.8 FormBuilder

FormBuilder 是 Angular 的一个服务类，它提供了创建 FormGroup、FormControl 和 FormArray 的快捷方法，使表单创建代码更加简洁和可读。

1. 创建 FormControl 的简单示例

    - 组件代码

        ```ts
        @Component({
            selector: 'formBuilder-control',
            template: `
                <div>
                    <label>用户名:</label>
                    <input [formControl]="usernameControl">
                    <p>值: {{ usernameControl.value }}</p>
                    <p>状态: {{ usernameControl.status }}</p>
                </div>
            `
        })
        export class FormBuilder01Component {
            // 使用 FormBuilder 创建 FormControl
            usernameControl = this.fb.control('默认值', [
                Validators.required,
                Validators.minLength(3)
            ]);

            constructor(private fb: FormBuilder) {}
        }
        ```
    - 运行结果

        ![](/framework/angular/base16/071.gif)

2. 创建 FormGroup 的简单示例

    - 组件代码

        ```ts
        @Component({
            selector: 'formBuilder-group',
            template: `
                <form [formGroup]="userForm">
                    <input formControlName="firstName" placeholder="名字">
                    <input formControlName="lastName" placeholder="姓氏">
                    <p>表单值: {{ userForm.value | json }}</p>
                    <p>状态: {{ userForm.status }}</p>
                </form>
            `
        })
        export class FormBuilder02Component {
            // 使用 FormBuilder 创建 FormGroup
            userForm = this.fb.group({
                firstName: ['', Validators.required],
                lastName: ['', Validators.required]
            });

            constructor(private fb: FormBuilder) {}
        }

        ```
    - 运行结果

        ![](/framework/angular/base16/072.gif)
3. 创建 FormArray 的简单示例

    - 组件代码

        ```ts
        @Component({
            selector: 'formBuilder-array',
            template: `
                <h3>兴趣爱好列表</h3>
                <form [formGroup]="userForm">
                    <div formArrayName="hobbies">
                        <div *ngFor="let hobby of hobbies.controls; let i = index" class="hobby-item">
                            <input [formControlName]="i" placeholder="输入爱好">
                            <button type="button" (click)="removeHobby(i)">删除</button>
                        </div>
                    </div>

                    <button type="button" (click)="addHobby()">添加爱好</button>

                    <div>
                        <h4>当前爱好:</h4>
                        <pre>{{ hobbies.value | json }}</pre>
                        <p>共有 {{ hobbies.length }} 个爱好</p>
                    </div>
                </form>
            `,
            styles: [`
                .hobby-item {
                    margin: 10px 0;
                    display: flex;
                    gap: 10px;
                }
                button {
                    padding: 5px 10px;
                }
            `]
        })
        export class FormBuilder03Component {
            userForm: FormGroup;

            constructor(private fb: FormBuilder) {
                this.userForm = this.fb.group({
                    hobbies: this.fb.array([
                        '游泳',
                        '阅读'
                    ])
                });
            }

            // 获取 hobbies FormArray
            get hobbies() {
                return this.userForm.get('hobbies') as FormArray;
            }

            // 添加新爱好
            addHobby() {
                this.hobbies.push(this.fb.control(''));
            }

            // 删除爱好
            removeHobby(index: number) {
                this.hobbies.removeAt(index);
            }
        }
        ```
    - 运行结果

        ![](/framework/angular/base16/073.gif)
                

## 3.6 内置属性指令-HTML属性

### 3.6.1  `[hidden]` - 显示/隐藏

1. 示例

    ```html
    <!-- 简单隐藏 -->
    <div [hidden]="!isVisible">内容</div>
    ```
2. 项目代码

    ```ts
    import { Component } from '@angular/core';

    @Component({
        selector: 'hidden-01',
        template: `
            <h3>内容显示控制</h3>

            <button (click)="isVisible = !isVisible">
                {{ isVisible ? '隐藏' : '显示' }}内容
            </button>

            <button (click)="showSecret = !showSecret">
                {{ showSecret ? '隐藏' : '显示' }}秘密
            </button>

            <div [hidden]="!isVisible">这是可见的内容</div>
            <div [hidden]="!showSecret">🔒 秘密信息</div>
            <div [hidden]="!isVisible || !showSecret">只有两个都显示时我才出现</div>

            <h4>权限控制</h4>
            <div [hidden]="!user.isAdmin">管理员功能</div>
            <div [hidden]="user.level < 3">VIP功能</div>
        `
    })
    export class Hidden01Component {
        isVisible = true;
        showSecret = false;

        user = {
            isAdmin: true,
            level: 5
        };
    }
    ```
3. 运行结果

    ![](/framework/angular/base16/075.gif)

### 3.6.2 `[title]` - 工具提示


1. 示例

    ```html
    <span [title]="tooltipText">悬停查看提示</span>
    ```

2. 项目代码

    ```ts
    
    @Component({
        selector: 'title-01',
        template: `
            <h3>悬停提示示例</h3>

            <button [title]="buttonTooltip">悬停查看按钮提示</button>

            <input
            type="text"
            [title]="inputTitle"
            placeholder="输入内容"
            (input)="onInputChange($event)">

            <div [title]="isValid ? '数据有效' : '请检查输入'">
                数据验证状态: {{ isValid ? '有效' : '无效' }}
            </div>

            <span [title]="getUserTooltip()">用户信息</span>

            <img
            src="https://via.placeholder.com/50"
            [title]="'图片ID: ' + imageId"
            alt="示例图片">

            <a href="#" [title]="linkDescription">重要链接</a>
        `
    })
    export class Title01Component {
        buttonTooltip = '点击此按钮执行操作';
        inputTitle = '请输入您的姓名';
        isValid = true;
        imageId = '12345';
        linkDescription = '这是一个导航链接';

        getUserTooltip() {
            return `用户信息：张三，25岁，管理员`;
        }

        onInputChange(event: any) {
            this.isValid = event.target.value.length > 3;
        }
    }

    ```

3. 运行结果

    ![](/framework/angular/base16/076.gif)

### 3.6.3 `[tabindex]` - 标签索引


1. 示例

    ```html
    <!-- 简单隐藏 -->
   <button [tabindex]="isDisabled ? -1 : 0">按钮</button>
    ```

2. 项目代码

    ```ts
    @Component({
        selector: 'tabindex-01',
        template: `
            <h3>Tab键导航顺序</h3>
            <p>使用 Tab 键在不同元素间导航</p>

            <input type="text" placeholder="第一个输入框" tabindex="1">
            <input type="text" placeholder="第二个输入框" tabindex="2">

            <button (click)="toggleDisabled()" [tabindex]="isDisabled ? -1 : 0">
                {{ isDisabled ? '禁用按钮' : '可点击按钮' }}
            </button>

            <div [tabindex]="0" (keydown.enter)="onDivClick()">
                这个div也可以获得焦点（按Enter触发）
            </div>

            <h4>动态Tab索引</h4>
            <button *ngFor="let btn of buttons; let i = index"
                    [tabindex]="i + 10">
                按钮 {{ i + 1 }}
            </button>

            <h4>条件Tab索引</h4>
            <input type="text" placeholder="条件输入框"
                [tabindex]="allowEditing ? 5 : -1">
            <label>
                <input type="checkbox" [(ngModel)]="allowEditing">
                允许编辑
            </label>
        `
    })
    export class Tabindex01Component {
        isDisabled = false;
        allowEditing = true;
        buttons = [1, 2, 3, 4];

        toggleDisabled() {
            this.isDisabled = !this.isDisabled;
        }

        onDivClick() {
            alert('Div被激活！');
        }
    }
    ```

3. 运行结果 (tab键一直点)

    ![](/framework/angular/base16/077.gif)