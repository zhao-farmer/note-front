# 九、使用官方UI material

## 9.1 安装 安装和配置 Angular Material

1.  **使用 CLI 添加 Angular Material**  
    - 运行以下命令，它会处理大部分配置工作，包括主题、字体和图标。

        ```bash
        ng add @angular/material
        ```
    
    - 在安装过程中，CLI 会询问你一些配置选项：

        *   **Choose a prebuilt theme name, or "custom" for a custom theme:** 选择一个预构建的主题，例如 `Indigo/Pink`。
            
        *   **Set up global Angular Material typography styles?** 输入 `Yes`。
            
        *   **Set up browser animations for Angular Material?** 输入 `Yes`。这对于组件的动画效果（如对话框、菜单）是必需的。
            
    
    - 这个命令会自动：
        
        *   安装 `@angular/material` 和 `@angular/cdk` 包。
            
        *   在 `angular.json` 中导入预选的主题 CSS 文件。
            
        *   在 `index.html` 中添加 Roboto 字体和 Material Icons 的 `<link>` 标签。
            
        *   在 `src/app/app.module.ts` 中导入 `BrowserAnimationsModule`。
        
2.  **(可选) 检查自动配置**  
    你可以打开 `index.html` 和 `app.module.ts` 查看 CLI 所做的更改。
    
    - **src/index.html (部分内容)**
    
        ```html
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        ```
    
    - **src/app/app.module.ts (部分内容)**
    
        ```ts
        import { BrowserAnimationsModule } from '@angular/platform-browser/animations';
        
        @NgModule({
            declarations: [
                AppComponent
            ],
            imports: [
                BrowserModule,
                AppRoutingModule,
                BrowserAnimationsModule // <-- 已自动添加
            ],
            ...
        })
        export class AppModule { }
        ```
    
## 9.2 常用组件案例

1. 导入所需模块

    打开 `src/app/app.module.ts`，一次性导入我们将要使用的所有模块。

    ```ts
    import { NgModule } from '@angular/core';
    import { BrowserModule } from '@angular/platform-browser';
    import { BrowserAnimationsModule } from '@angular/platform-browser/animations';
    // 用于双向数据绑定
    import { FormsModule } from '@angular/forms';

    // 导入 Angular Material 模块
    import { MatButtonModule } from '@angular/material/button';
    import { MatCardModule } from '@angular/material/card';
    import { MatCheckboxModule } from '@angular/material/checkbox';
    import { MatFormFieldModule } from '@angular/material/form-field';
    import { MatIconModule } from '@angular/material/icon';
    import { MatInputModule } from '@angular/material/input';
    import { MatMenuModule } from '@angular/material/menu';
    import { MatToolbarModule } from '@angular/material/toolbar';
    import { MatSnackBarModule } from '@angular/material/snack-bar';
    import { MatDialogModule } from '@angular/material/dialog';

    import { AppRoutingModule } from './app-routing.module';
    import { AppComponent } from './app.component';

    @NgModule({
        declarations: [
            AppComponent
        ],
        imports: [
            BrowserModule,
            AppRoutingModule,
            BrowserAnimationsModule, // 必须的动画模块
            FormsModule,
            // 添加 Material 模块
            MatToolbarModule,
            MatButtonModule,
            MatIconModule,
            MatMenuModule,
            MatCardModule,
            MatFormFieldModule,
            MatInputModule,
            MatCheckboxModule,
            MatSnackBarModule,
            MatDialogModule
        ],
        providers: [],
        bootstrap: [AppComponent]
    })
    export class AppModule { }
    ```




2. 使用组件 (app.component.html)

    替换 `src/app/app.component.html` 的内容为以下代码，它展示了多个常用组件。


    ```html
    <!-- 1. 应用栏 (Toolbar) -->
    <mat-toolbar color="primary">
        <span>Material 应用</span>

        <!-- 这是一个 spacer，用来将后续内容推到右边 -->
        <span class="example-spacer"></span>

        <!-- 2. 图标按钮 (Icon Button) -->
        <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon>更多</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
            <button mat-menu-item>
                <mat-icon>设置</mat-icon>
                <span>设置</span>
            </button>
            <button mat-menu-item>
                <mat-icon>帮助</mat-icon>
                <span>帮助</span>
            </button>
        </mat-menu>
    </mat-toolbar>

    <div class="content">
        <!-- 3. 卡片 (Card) -->
        <mat-card class="example-card">
            <mat-card-header>
                <div mat-card-avatar class="example-header-image"></div>
                <mat-card-title>Angular Material</mat-card-title>
                <mat-card-subtitle>内容模块</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
                <p>
                    这是一些常用的Material组件的演示。尝试与他们互动！
                </p>
            </mat-card-content>
            <mat-card-actions>
                <!-- 4. 按钮 (Button) -->
                <button mat-button (click)="isChecked = !isChecked">切换复选框</button>
                <button mat-raised-button color="accent" (click)="openSnackbar()">展示Snackbar</button>
                <button mat-stroked-button color="warn" (click)="openDialog()">打开弹框</button>
            </mat-card-actions>
        </mat-card>

        <!-- 5. 表单字段和输入框 (Form Field & Input) -->
        <mat-card>
            <mat-card-header>
                <mat-card-title>表单示例</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <mat-form-field appearance="fill" class="example-full-width">
                    <mat-label>你的名字</mat-label>
                    <input matInput placeholder="e.g. John Doe" [(ngModel)]="name">
                    <mat-icon matSuffix>sentiment_very_satisfied</mat-icon>
                    <mat-hint>请输入您的全名</mat-hint>
                </mat-form-field>

                <br>
                <!-- 6. 复选框 (Checkbox) -->
                <mat-checkbox [(ngModel)]="isChecked">我同意条款和条件</mat-checkbox>
            </mat-card-content>
        </mat-card>
    </div>
    ```

3. 添加样式 (app.component.css)

    添加一些简单的布局样式到 `src/app/app.component.css`。


    ```css
    .example-spacer {
        flex: 1 1 auto;
    }

    .content {
        padding: 20px;
    }

    .example-card {
        max-width: 600px;
        margin-bottom: 20px;
    }

    .example-header-image {
        background-image: url('https://angular.io/assets/images/logos/angular/angular.svg');
        background-size: cover;
    }

    .example-full-width {
        width: 100%;
    }
    ```

4. 添加组件逻辑 (app.component.ts)

    最后，在 `src/app/app.component.ts` 中添加与模板交互的逻辑，比如打开 Snackbar 和 Dialog 的方法。


    ```ts
    import { Component } from '@angular/core';
    import { MatSnackBar } from '@angular/material/snack-bar';
    import { MatDialog } from '@angular/material/dialog';
    import { ExampleDialogComponent } from './example-dialog/example-dialog.component';

    @Component({
        selector: 'app-root',
        templateUrl: './app.component.html',
        styleUrls: ['./app.component.css']
    })
    export class AppComponent {
        title = 'material-demo';
        name: string = '';
        isChecked: boolean = false;

        // 注入 MatSnackBar 和 MatDialog 服务
        constructor(private _snackBar: MatSnackBar, public dialog: MatDialog) {}

        openSnackbar() {
            // 打开一个简单的 Snackbar
            this._snackBar.open('你好 Angular Material!', '提示信息', {
            duration: 3000 // 3秒后自动消失
            });
        }

        openDialog(): void {
            // 打开对话框，并传递数据
            const dialogRef = this.dialog.open(ExampleDialogComponent, {
                width: '250px',
                data: { name: this.name } // 将输入框的 name 传递给对话框
            });

            // 订阅对话框关闭后返回的数据
            dialogRef.afterClosed().subscribe(result => {
                console.log('The dialog was closed');
                if (result) {
                    this.name = result;
                }
            });
        }
    }
    ```

5. 创建对话框组件

    上面的代码引用了一个 `ExampleDialogComponent`，我们现在来创建它。

    1.  **使用 CLI 生成组件**

        ```sh
        ng generate component example-dialog
        ```
        
    2.  **配置对话框组件 (example-dialog.component.ts)**  

        修改 `src/app/example-dialog/example-dialog.component.ts`：
        
        ```ts
        import { Component, Inject } from '@angular/core';
        import { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';

        export interface DialogData {
            name: string;
        }

        @Component({
            selector: 'app-example-dialog',
            template: `
                <h1 mat-dialog-title>你好 {{ data.name }}</h1>
                <div mat-dialog-content>
                <p>你最喜欢的动物是什么？</p>
                <mat-form-field appearance="fill">
                    <mat-label>最喜欢的动物</mat-label>
                    <input matInput [(ngModel)]="data.name" />
                </mat-form-field>
                </div>
                <div mat-dialog-actions>
                <button mat-button (click)="onNoClick()">不，谢谢</button>
                <button mat-button [mat-dialog-close]="data.name" cdkFocusInitial>
                    好的
                </button>
                </div>
            `,
        })
        export class ExampleDialogComponent {
            constructor(
                public dialogRef: MatDialogRef<ExampleDialogComponent>,
                @Inject(MAT_DIALOG_DATA) public data: DialogData // 接收传入的数据
            ) {}

            onNoClick(): void {
                this.dialogRef.close(); // 关闭对话框，不返回数据
            }
        }

        ```
   
    3.  **将对话框组件添加到模块**  
        由于我们使用了 CLI 生成组件，它已经自动在 `app.module.ts` 的 `declarations` 数组中声明了 `ExampleDialogComponent`，所以这一步不需要再做任何操作。
        
6. 运行结果

    ![](/framework/angular/base16/078.gif)