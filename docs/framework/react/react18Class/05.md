

# 五、react 路由 


## 5.1 相关理解

1. SPA 的理解

    - 单页Web 应用(single page web application，SPA)。
    - 整个应用只有一个完整的页面。
    - 点击页面中的链接不会刷新页面，只会做页面的局部更新。
    - 数据都需要通过 ajax 请求获取, 并在前端异步展现。

2. 路由的理解

    1. 什么是路由?
        - 一个路由就是一个映射关系(key:value)
        - key 为路径, value 可能是 function或component
    2. 路由分类
        - 后端路由:
            - 理解: value 是 function,用来处理客户端提交的请求。
            - 注册路由:router.get(path, function(req, res))。
            - 工作过程:当 node 接收到一个请求时,根据请求路径找到匹配的路由,调用路由中的函数来处理请求,返回响应数据
        - 前端路由:
            - 浏览器端路由，value 是component，用于展示页面内容。
            - 注册路由: `<Route path="/test" component={Test}>`
            - 工作过程: 当浏览器的 path 变为/test 时,当前路由组件就会变为 Test 组件

3. 路由的原理

    前端路由的主要依靠的时 history ，也就是浏览器的历史记录

    history 是 BOM 对象下的一个属性，在 H5 中新增了一些操作 history 的 API

    浏览器的历史记录就类似于一个栈的数据结构，前进就相当于入栈，后退就相当于出栈

    并且历史记录上可以采用 listen 来监听请求路由的改变，从而判断是否改变路径

    在 H5 中新增了 createBrowserHistory 的 API ，用于创建一个 history 栈，允许我们手动操作浏览器的历史记录

    新增 API：pushState ，replaceState，原理类似于 Hash 实现。 用 H5 实现，单页路由的 URL 不会多出一个 # 号，这样会更加的美观

4. React Router 概述

    1. React Router 以三个不同的包发布到 npm 上，它们分别为:
        1. react-router: 路由的核心库，提供了很多的:组件、钩子。
        2. react-router-dom: 包含react-router所有内容，并添加一些专门用于 DOM 的组件，例如 `<BrowserRouter>`等
        3. react-router-native:包括react-router所有内容，并添加一些专门用于ReactNative的API，例如: `<NativeRouter>`等
    2. 与React Router 5.x 版本相比，改变了什么？

        1. 内置组件的变化:移除`<switch/>`，新增 `<Routes/>` 等。
        2. 语法的变化:`element={<About/>}`变为 `component={About}`
        3. 新增多个hook:`useMatch`、`useParams`、`useNavigate`等
        4. 官方明确推荐函数式组件了!!!

## 5.2 初始化项目

1. 创建项目

    ```sh
    # 创建项目
    create-react-app react02
    # 进入目录
    cd react02
    # 安装react18
    npm install react@18 react-dom@18
    # 安装react router6
    npm install react-router-dom@6
    ```

2. 删除public下文件，并新建index.html

    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>react router6</title>
    </head>
    <body>
        <div id="root"></div>
    </body>
    </html>
    ```

3. 删除src下项目

    - 新建App.jsx

        ```jsx
        import React, { Component } from 'react'

        export default class App extends Component {
            render() {
                return (
                <div>App</div>
                )
            }
        }
        ```
    - 新建index.js

        ```js
        import React from "react";
        import ReactDOM from "react-dom"
        import App from "./App"


        // 设置根组件节点
        const root = ReactDOM.createRoot(document.getElementById('root'));

        // 渲染App到页面
        root.render(<App/>)
        ```

## 5.3 一级路由

1. 新建About 组件
    
    ```jsx
    import React, { Component } from 'react'

    export default class About extends Component {
        render() {
            return (
            <div>这是about内容</div>
            )
        }
    }

    ```
2. 新建Home 组件

    ```jsx
    import React, { Component } from 'react'

    export default class Home extends Component {
        render() {
            return (
            <div>这是Home内容</div>
            )
        }
    }
    ```

3. 修改index.js (必须包裹 BrowserRouter)

    ```js
    import React from "react";
    import ReactDOM from "react-dom"
    import App from "./App"
    import {BrowserRouter} from "react-router-dom"

    // 设置根组件节点
    const root = ReactDOM.createRoot(document.getElementById('root'));

    // 渲染App到页面
    root.render(
        <BrowserRouter>
            <App />
        </BrowserRouter>
    )
    ```
4. App.js中展示路由

    - 基础路由

        ```jsx
        import React, { Component } from 'react'
        import { NavLink,Routes,Route } from "react-router-dom"
        import Home from './components/Home'
        import About from './components/About'

        export default class App extends Component {
            render() {
                return (
                    <div>
                        <h2>React Router Demo</h2>
                        <div>
                            {/* 路由链接 */}
                            <NavLink to="/about">About</NavLink>
                            | 
                            <NavLink to="/home">Home</NavLink>
                        </div>
                        <div>
                            {/* 注册路由 */}
                            <Routes>
                                <Route path="/about" element={<About/>}></Route>
                                <Route path='/home' element={<Home/>}></Route>
                            </Routes>
                        </div>
                    </div>
                )
            }
        }
        ```

    - 运行结果

        ![](/framework/react/react18Class/030.gif)

5. 重定向功能

    - App.js 修改

        ```jsx{2,22}
        import React, { Component } from 'react'
        import { NavLink,Routes,Route, Navigate } from "react-router-dom"
        import Home from './components/Home'
        import About from './components/About'

        export default class App extends Component {
            render() {
                return (
                    <div>
                        <h2>React Router Demo</h2>
                        <div>
                            {/* 路由链接 */}
                            <NavLink to="/about">About</NavLink>
                            | 
                            <NavLink to="/home">Home</NavLink>
                        </div>
                        <div>
                            {/* 注册路由 */}
                            <Routes>
                                <Route path="/about" element={<About/>}/>
                                <Route path='/home' element={<Home/>}/>
                                <Route path='/' element={<Navigate to="/home"/>}/>
                            </Routes>
                        </div>
                    </div>
                )
            }
        }
        ```
    - 运行结果

        ![](/framework/react/react18Class/031.gif)

6. NavLink 高亮

    - public/index.html 添加样式

        ```html
        <style>
            .acguigu{
                background-color: orange;
                color: white;
            }
        </style>
        ```
    - App.jsx 调用

        ```jsx
        import React, { Component } from 'react'
        import { NavLink,Routes,Route, Navigate } from "react-router-dom"
        import Home from './components/Home'
        import About from './components/About'

        export default class App extends Component {
            render() {
                // 调用函数
                function computedClassName({isActive}){
                    return isActive ? 'atgugui' : ''
                }

                return (
                    <div>
                        <h2>React Router Demo</h2>
                        <div>
                            {/* 路由链接 */}
                            <NavLink className={({isActive})=>isActive ? 'atgugui' : ''} to="/about">About</NavLink>
                            | 
                            <NavLink className={computedClassName} to="/home">Home</NavLink>
                        </div>
                        <div>
                            {/* 注册路由 */}
                            <Routes>
                                <Route path="/about" element={<About/>}/>
                                <Route path='/home' element={<Home/>}/>
                                <Route path='/' element={<Navigate to="/home"/>}/>
                            </Routes>
                        </div>
                    </div>
                )
            }
        }
        ```
    - 运行结果

        ![](/framework/react/react18Class/032.gif)
        
## 5.4 路由表 useRoutes

1. 使用路由表

    ```jsx
    import React from "react";
    import { NavLink, Navigate, useRoutes } from "react-router-dom";
    import Home from "./components/Home";
    import About from "./components/About";

    export default function App() {
        // 路由表
        const element = useRoutes([
            {
                path: "/about",
                element: <About />,
            },
            {
                path: "/home",
                element: <Home />,
            },
            {
                path:"/",
                element:<Navigate to="/about"/>
            }
        ]);

        return (
            <div>
                <h2>React Router Demo</h2>
                <div>
                    {/* 路由链接 */}
                    <NavLink className={({ isActive }) => (isActive ? "atgugui" : "")} to="/about">
                        About
                    </NavLink>
                    |
                    <NavLink className={({ isActive }) => (isActive ? "atgugui" : "")} to="/home">
                        Home
                    </NavLink>
                </div>
                <div>
                    {/* 注册路由 */}
                    {element}
                </div>
            </div>
        );
    }
    ```
    >注意：useRoutes只能在函数组件才能使用

2. 外部导入路由表

    - 创建 routes/index.js

        ```js
        import Home from "../components/Home";
        import About from "../components/About";
        import { Navigate } from "react-router-dom";

        const routes =  [
            {
                path: "/about",
                element: <About />,
            },
            {
                path: "/home",
                element: <Home />,
            },
            {
                path:"/",
                element:<Navigate to="/about"/>
            }
        ]

        export default routes;
        ```
    - App.jsx 中使用

        ```jsx
        import React from "react";
        import { NavLink, useRoutes } from "react-router-dom";
        import routes from "./routes"



        export default function App() {
            // 根据路由表生成对应的路由规则
            const element = useRoutes(routes);

            return (
                <div>
                    <h2>React Router Demo</h2>
                    <div>
                        {/* 路由链接 */}
                        <NavLink className={({ isActive }) => (isActive ? "atgugui" : "")} to="/about">
                            About
                        </NavLink>
                        |
                        <NavLink className={({ isActive }) => (isActive ? "atgugui" : "")} to="/home">
                            Home
                        </NavLink>
                    </div>
                    <div>
                        {/* 注册路由 */}
                        {element}
                    </div>
                </div>
            );
        }

        ```

## 5.5 嵌套路由

1. 新增 src/components/Message.jsx

    ```jsx
    import React from "react";

    export default function Message() {
        return (
            <div>
                <ul>
                    <li>message01</li>
                    <li>message02</li>
                    <li>message03</li>
                </ul>
            </div>
        );
    }
    ```
2. 新增 src/components/New.jsx

    ```jsx
    import React from "react";

    export default function News() {
        return (
            <div>
                <ul>
                    <li>News01</li>
                    <li>News02</li>
                    <li>News03</li>
                </ul>
            </div>
        );
    }
    ```

3. 修改路由表 src/routes/index.js

    ```js{3-4,16-25}
    import Home from "../components/Home";
    import About from "../components/About";
    import Message from "../components/Message"
    import New from "../components/New"
    import { Navigate } from "react-router-dom";


    const routes =  [
        {
            path: "/about",
            element: <About />,
        },
        {
            path: "/home",
            element: <Home />,
            children:[
                {
                    path:"news",
                    element:<New />
                },
                {
                    path:"message",
                    element:<Message />
                }
            ]
        },
        {
            path:"/",
            element:<Navigate to="/about"/>
        }
    ]

    export default routes;
    ```

4. 修改 Home.jsx 文件

    ```jsx
    import React, { Component } from 'react'
    import { NavLink,Outlet } from "react-router-dom";

    export default class Home extends Component {
        render() {
            return (
                <div>
                    <h2>这是Home内容</h2>
                    <div>
                        <NavLink to="/home/news">News</NavLink>
                        |
                        {/* 可以不写完整路径 ./message 或 message */}
                        <NavLink to="message">Message</NavLink>
                    </div>
                    {/* 指定路由组件呈现的位置 */}
                    <Outlet/>
                </div>
            )
        }
    }
    ```

5. 运行结果

    ![](/framework/react/react18Class/033.gif)

## 5.6 路由参数

### 5.6.1 路由的params参数

1. 新增组件 Detail.jsx

    ```jsx
    import React from "react";
    import { useParams,useMatch } from "react-router-dom";

    export default function Detail() {
        // 使用 useParams 接收参数
        const { id, title, content } = useParams();
        // 使用 useMatch
        const x = useMatch('/home/message/detail/:id/:title/:counent')
        console.log(x);
        
        return (
            <ul>
                <li>ID:{id}</li>
                <li>标题：{title}</li>
                <li>内容：{content}</li>
            </ul>
        );
    }
    ```
2. 修改组件 Message.jsx

    ```jsx
    import React,{useState} from "react";
    import { Link, Outlet } from 'react-router-dom'

    export default function Message() {
        const [messages] = useState([
            {id:"001",title:"消息1",content:"悯农"},
            {id:"002",title:"消息2",content:"锄禾日当午"},
            {id:"003",title:"消息3",content:"汗滴禾下土"},
            {id:"004",title:"消息4",content:"谁知盘中餐"},
            {id:"005",title:"消息5",content:"粒粒皆辛苦"},
        ])

        return (
            <div>
                <ul>
                    {
                        messages.map((item) => {
                            return (
                            <li key={item.id}>
                                <Link to={`detail/${item.id}/${item.title}/${item.content}`}>{item.title}</Link>
                            </li>
                            )
                        })
                    }
                </ul>
                <hr />
                {/* 指定路由展示的位置 */}
                <Outlet />
            </div>
        )
    }

    ```
3. message路由下新增子路由

    ```js
    {
        path:"message",
        element:<Message />,
        children:[
            {
                path:'detail/:id/:title/:content',
                element:<Detail/>
            }
        ]
    }
    ```
4. 运行结果

    ![](/framework/react/react18Class/034.gif)

### 5.6.2 路由的search参数

1. 路由配置

    ```js
    {
        path:"message",
        element:<Message />,
        children:[
            {
                path:'detail',
                element:<Detail/>
            }
        ]
    }
    ```  

2. message 修改传递参数

    ```js
    {
        messages.map((item) => {
            return (
                <li key={item.id}>
                    <Link to={`detail?id=${item.id}&title=${item.title}&content=${item.content}`}>{item.title}</Link>
                </li>
            )
        })
    }
    ```
3. Detail.jsx 使用useSearch接收参数

    ```js
    import React from "react";
    import { useSearchParams } from "react-router-dom";

    export default function Detail() {
        const [search] = useSearchParams();
        const id = search.get("id");
        const title = search.get("title");
        const content = search.get("content");
        return (
            <ul>
                <li>ID：{id}</li>
                <li>标题：{title}</li>
                <li>内容：{content}</li>
            </ul>
        );
    }
    ```

### 5.6.3 路由的state参数

1. 路由配置

    ```js
    {
        path:"message",
        element:<Message />,
        children:[
            {
                path:'detail',
                element:<Detail/>
            }
        ]
    }
    ```  

2. message 修改传递参数

    ```js
    {
        messages.map((item) => {
            return (
                <li key={item.id}>
                    <Link to="detail" state={{
                        id: item.id,
                        title: item.title,
                        content: item.content
                    }}>
                        {item.title}
                    </Link>
                </li>
            )   
        })
    }
    ```
3. Detail.jsx 使用useSearch接收参数

    ```js
    import React from 'react'
    import { useLocation } from 'react-router-dom'

    export default function Detail() {
        const { state: { id, title, content } } = useLocation()
        return (
            <ul>
                <li>ID：{id}</li>
                <li>标题：{title}</li>
                <li>内容：{content}</li>
            </ul>
        )
    }
    ```
## 5.7 编程式路由导航

1. 修改message 组件

    ```js{13-24}
    import React, { useState } from "react";
    import { useNavigate, Outlet } from "react-router-dom";

    export default function Message() {
        const [messages] = useState([
            { id: "001", title: "消息1", content: "悯农" },
            { id: "002", title: "消息2", content: "锄禾日当午" },
            { id: "003", title: "消息3", content: "汗滴禾下土" },
            { id: "004", title: "消息4", content: "谁知盘中餐" },
            { id: "005", title: "消息5", content: "粒粒皆辛苦" },
        ]);

        // 编程式路由导航
        const navigate = useNavigate();
        function jumpDetail(item) {
            navigate("detail", {
                replace: false,
                state: {
                    id: item.id,
                    title: item.title,
                    content: item.content,
                },
            });
        }

        return (
            <div>
                <ul>
                    {
                        messages.map(item => {
                            return (
                                <li key={item.id}>
                                    <button onClick={() => jumpDetail(item)}>跳转到详情{item.id}</button>
                                </li>
                            );
                        })
                    }
                </ul>
                <hr />
                {/* 指定路由展示的位置 */}
                <Outlet />
            </div>
        );
    }

    ```
2. 运行结果

    ![](/framework/react/react18Class/035.png)