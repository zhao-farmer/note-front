# 一、服务端渲染与nuxt

## 1.1 单页面应用程序

### SPA简介

- 单页应用程序(SPA)全称是:Single-page application，SPA应用是在客户端呈现的(术语称:CRS)
    - SPA应用默认只返回一个空HTML页面，如:body只有`<divid=“app”></div>`。
    - 而整个应用程序的内容都是通过 javascript 动态加载，包括应用程序的逻辑、U1 以及与服务器通信相关的所有数据。
    - 构建 SPA 应用常见的库和框架有: React、AngularJS、Vue.js 等

- 流程实例

![](/framework/vue/nuxt/001.png)

- SPA的优点
    1. 只需加载一次
        - SPA应用程序只需要在第一次请求时加载页面，页面切换不需重新加载，而传统的Web应用程序必须在每次请求时都得加载页面，需要花费更多时间。因此，SPA页面加载速度要比传统 Web 应用程序更快。
    2. 更好的用户体验
        - SPA 提供类似于桌面或移动应用程序的体验。用户切换页面不必重新加载新页面
        - 切换页面只是内容发生了变化，页面并没有重新加载，从而使体验变得更加流畅
    3. 可轻松的构建功能丰富的Web应用程序

- SPA的缺点
    1. SPA应用默认只返回一个空HTML页面，不利于SEO （search engine optimization）
    2. 首屏加载的资源过大时，一样会影响首屏的渲染
    3. 也不利于构建复杂的项目，复杂 Web 应用程序的大文件可能变得难以维护


## 1.2 爬虫

Google 爬虫的工作流程分为3 个阶段，并非每个网页都会经历这3 个阶段:

- 抓取:
    - 爬虫(也称蜘蛛)，从互联网上发现各类网页,网页中的外部连接也会被发现。
    - 抓取数以十亿被发现网页的内容，如:文本、图片和视频

- 索引编制:
    - 爬虫程序会分析网页上的文本、图片和视频文件。
    - 并将信息存储在大型数据库(索引区)中。
    - 例如 `<title>` 元素和 Alt 属性、图片、视频等。
    - 爬虫会对内容类似的网页归类分组
    - 不符合规则内容和网站会被清理
	    - 如:禁止访问 或 需要权限网站等等
	
呈现搜索结果:

![](/framework/vue/nuxt/002.png)

当用户在 Google 中搜索时，搜索引擎会根据内容的类型，选择一组网页中最具代表性的网页进行呈现

## 1.2 SEO的优化

- 语义性HTML标记
    - 标题用`<h1>`，一个页面只有一个; 副标题用`<h2>`到`<h6>`。
    - 不要过度使用h标签，多次使用不会增加 SEO(search engine optimization).
    - 段落用`<p>`，列表用`<ul>`，并且li只放在 ul 中 等等,

- 每个页面需包含: 标题 + 内部链接
    - 每个页面对应的title，同一网站所有页面都有内链可以指向首页
- 确保链接可供抓取，如以下表格所示:

| HTMUL板签               | 含文                                           | SEO权期 |
|-----------------------|----------------------------------------------|-------|
| `<title> `              | 标题                                           | 10分   |
| `<a>`                   | 内部链接文字                                       | 10分   |
| `<h1>`/`<h2> `            | 标题，其实是H1-H6，不过H1和H2是最重要的，一般一个页面最好一个，不要5分过多使用 | 5分    |
| `<p> `                  | 每段首句                                         | 5分    |
| `<p>`                   | 每句开头                                         | 1.5分  |
| `<b>`/`<strong>`          | 加相                                           | 1分    |
| `<a title=''/>`         | title属性                                      | 1分    |
| `<img alt=''> `         | img alt标记                                    | 0.5分  |
| `<meta description=''>` | meta标签的网站descrlption                         | 0.5分  |
| `<meta keywords='> `    | meta标签的网站keywords                            | 0.05分 |


- meta标签优化:设置 description keywords 等
- 文本标记和img:
    - 比如`<b>`和`<strong>`加粗文本的标签，爬虫也会关注到该内容口 
    - img标签添加 alt 属，图片加载失败，爬虫会取alt内容。
- robots.txt 文件:规定爬虫可访问您网站上的哪些网址。
- sitemap.xml站点地图:在站点地图列出所有网页，确保爬虫不会漏掉某些网页
- 更多查看:https://developers.google.com/search/docs/crawling-indexing/valid-page-metadata


## 1.3 静态站点生成（SSG）
- 静态站点生成(SSG) 全称是：Static Site Generate，是预先生成好的静态网站。
    - SSG 应用一般在构建阶段就确定了网站的内容。  如果网站的内容需要更新了，那必须得重新再次构建和部署。
    - 构建 SSG 应用常见的库和框架有： Vue Nuxt、 React Next.js 等。
- SSG的优点：
    - 访问速度非常快，因为每个页面都是在构建阶段就已经提前生成好了。
    - 直接给浏览器返回静态的HTML，也有利于SEO
    - SSG应用依然保留了SPA应用的特性，比如：前端路由、响应式数据、虚拟DOM等
- SSG的缺点：
    - 页面都是静态，不利于展示实时性的内容，实时性的更适合SSR。
    - 如果站点内容更新了，那必须得重新再次构建和部署。

## 1.4 SSR 服务器端渲染
- 服务器端渲染全称是:Server Side Render，在服务器端渲染页面，并将渲染好HTML返回给浏览器呈现。
	- SSR应用的页面是在服务端渲染的，用户每请求一个SSR页面都会先在服务端进行渲染，然后将渲染好的页面，返回给浏览器呈现。
	- 构建 SSR 应用常见的库和框架有: Vue Nuxt、React Next.js等(SSR应用也称同构应用)

- 流程示例

![](/framework/vue/nuxt/003.png)

- 优点
    - 更快的首屏渲染速度
    - 更好的SDO
    - SSR应用程序在 Hydration 之后依然可以保留 Web 应用程序的交互性。比如：前端路由、响应式数据、虚拟DOM等。
- 缺点
    - SSR 通常需要对服务器进行更多 API 调用，以及在服务器端渲染需要消耗更多的服务器资源，成本高
    - 增加了一定的开发成本，用户需要关心哪些代码是运行在服务器端，哪些代码是运行在浏览器端
    - SSR 配置站点的缓存通常会比SPA站点要复杂一点

## 1.5 SSR的解决方案
1. php、jsp…………
2. 从0搭建SSR项目
3. 直接使用流行的框架

1.6 跨请求状态污染

>在SPA中，整个生命周期中只有一个App对象实例 或 一个Router对象实例 或 一个Store对象实例都是可以的，因为每个用户在使用浏览器访问SPA应用时，应用模块都会重新初始化，这也是一种单例模式

>然而，在 SSR 环境下，App应用模块通常只在服务器启动时初始化一次。同一个应用模块会在多个服务器请求之间被复用，而我们的单例状态对象也一样，也会在多个请求之间被复用，比如:当某个用户对共享的单例状态进行修改，那么这个状态可能会意外地泄露给另一个在请求的用户
>这种情况称之为跨请求状态污染

- 可以在每个请求中为整个应用创建一个全新的实例，包括后面的 router 和全局 store等实例。
- 所以我们在创建App 或 路由 或 Store对象时都是使用一个函数来创建，保证每个请求都会创建一个全新的实例
- 这样也会有缺点：需要消耗更多的服务器的资源



## 2.6 nuxt与ssr

1. 定义
    - Nuxt 使用 h3来实现部署可移植性
    - Nuxt 框架可以用来快速构建下一个 Vue.js 应用程序，如支持 CSR 、SSR、SSG 渲染模式的应用等

2. 特点

    1. Nuxt3 是基于 Vue3 + Vue Router + Vite 等技术栈，全程 Vue3+Vite 开发体验（Fast）。
    2. 自动导包
        - Nuxt 会自动导入辅助函数、组合 API和 Vue API ，无需手动导入。
        - 基于规范的目录结构，Nuxt 还可以对自己的组件、 插件使用自动导入
    3. 约定式路由（目录结构即路由）
        - Nuxt 路由基于vue-router，在 pages/ 目录中创建的每个页面，都会根据目录结构和文件名来自动生成路由
    4. 渲染模式：Nuxt 支持多种渲染模式（SSR、CSR、SSG等）
        - 通用渲染（服务器端渲染和水合）
        - 仅客户端渲染
        - 全静态站点生成
        - 混合渲染（每条路由缓存策略）
    5. 利于搜索引擎优化：服务器端渲染模式，不但可以提高首屏渲染速度，还利于SEO
    6. 服务器引擎
        - 在开发环境中，它使用 Rollup 和 Node.js
        - 在生产环境中，使用 Nitro 将您的应用程序和服务器构建到一个通用.output目录中
        - Nitro服务引擎提供了跨平台部署的支持，包括 Node、Deno、Serverless、Workers等平台上部署

3. 官网

    - [官方网站](https://nuxt.com/)
    - [中文网站](https://nuxt.com.cn/docs)