# 二、快速使用

## 2.1 创建初始化目录

1. 编辑 Hosts 文件

    - 使用管理员打开记事本

        ![](/framework/vue/nuxt/005.png)

    - 点击 "文件" 菜单，然后选择 "打开"。导航到以下路径：`C:\Windows\System32\drivers\etc\`， 然后打开"hosts"文件。

    - 在文件的末尾添加新的行，每行的格式是 IP 地址，空格，域名，将下面的配置添加进去即可。 

        ```
        185.199.109.133 raw.githubusercontent.com
        ```

        这会将 raw.githubusercontent.com 映射到主机（185.199.109.133）。

    - 验证 是否成功

        ```
        ping raw.githubusercontent.com
        ```

2. 运行命令行

    - 官网推荐

        ```sh
        npm create nuxt@latest <project-name>
        ```

    - 第二种方式

        ```sh
        # 全局安装nuxi（命令行工具）
        npm install –g nuxi 
        # 使用 nuxi 创建项目
        nuxi init <project-name>
        ```
    - 安装的4.0.3 的选项

        ![](/framework/vue/nuxt/004.png)

3. 启动项目 

    ```sh
    # 进入项目
    cd <project-name>
    # 启动项目
    npm run dev 
    ```

## 2.2 初始化

1. app/app.vue 删除原来的组件

2. 改造 app/app.vue

    ```vue
    <template>
      <div>
        <NuxtLayout>
          <NuxtPage />
        </NuxtLayout>
      </div>
    </template>
    ```
    
3. 添加 app/layouts/default.vue

    ```vue
    <template>
      <div>
        <h1 class="header">header</h1>
          <div class="main" style="min-height: 80vh">
            <slot></slot>
          </div>
        <div class="footer">footer</div>
      </div>
    </template>
    ```


4. 在app目录下新建 pages 文件夹，并添加 index.vue

    app/pages/index.vue
    
    ```vue
    <template>
      <div>Home</div>
    </template>
    ```

5. 在 pages 文件夹下添加其他页面，比如 about.vue
    
    ```vue
    <template>
      <div class="about">
        <h1>This is an about page</h1>
      </div>
    </template>
    ```

6. 运行结果

    ![](/framework/vue/nuxt/006.gif)

## 2.3 添加 插件（快速开发）

进入插件页面

![](/framework/vue/nuxt/007.png)

### 2.3.1 unocss

1. 安装插件

    ```bash
    npm install -D unocss @unocss/nuxt
    ```

2. 在 nuxt.config.ts 文件中添加如下代码

    ```ts
    export default defineNuxtConfig({
      modules: [
        '@unocss/nuxt',
      ],
    })
    ```

3. 项目中验证 index.vue

    ```vue
    <template>
      <div class="text-3xl">Home</div>
    </template>
    ```

4. 运行结果

    ![](/framework/vue/nuxt/008.png)

### 2.3.2 nuxt/icon

1. 安装插件

    ```bash
    npx nuxi module add icon
    ```

2. 添加一个配置 防止 nuxt icon 请求出错

    在 nuxt.config.ts 文件中添加如下代码
    
    ```ts
    export default defineNuxtConfig({
      icon: {
        localApiEndpoint: '/nuxt-icon',
      },
    })
    ```

3. 使用
    
    - 代码

        ```vue
        <Icon name="simple-icons:github" size="1rem" />
        ```
    - vscode 插件：Iconify IntelliSense
    - 图标库：https://icones.js.org/

4. 运行结果

    ![](/framework/vue/nuxt/009.png)


### 2.3.3 pinia 

1. 安装插件

    ```bash
    npm install pinia @pinia/nuxt
    ```

2. 在 nuxt.config.ts 文件中添加如下代码

    ```ts
    export default defineNuxtConfig({
      modules: ['@pinia/nuxt'],
    })
    ```

3. 定义 testStore  测试

    app/store/index.ts

    ```ts
    export const useTestStore = defineStore("test", {
      state: () => ({
        count: 0 as number,
      }),
      getters: {
        getCount: (state) => state.count * 2,
      },
      actions: {
        increment() {
          this.count++;
        },
      },
    });
    ```

4. 在 app/pages/index.vue 中使用

    ```vue
    <template>
        <div class="text-3xl">Home</div>
        <Icon name="simple-icons:github" size="1rem" /><br>
        <button @click="store.increment">数值加一</button>
        {{ store.count }}
    </template>

    <script setup lang="ts">

    import { useTestStore } from '~/store';

    const store = useTestStore();

    </script>
    ```

5. 运行结果

    ![](/framework/vue/nuxt/010.gif)


## 2.4 完善 nuxt.config.ts 配置

1. 设置

    ```ts
    export default defineNuxtConfig({
      compatibilityDate: "2025-08-2",
      devtools: { enabled: true },
      // 模块
      modules: ["@unocss/nuxt", "@nuxt/icon", "@pinia/nuxt"],
      app: {
        // 设置 seo ，会设置到 html 的 head 里面
        head: {
          title: "Nuxt 4",
          meta: [
            { name: "description", content: "Nuxt 4" },
            { name: "viewport", content: "width=device-width, initial-scale=1" },
          ],
        },
      },
      icon: {
        localApiEndpoint: "/nuxt-icon",
      },
      ssr: true, // 是否开启 ssr
      devServer: {
        // 服务端口号
        port: 3001,
      },
      css: [], // css 入口文件
      nitro: {
        // 代理，前后端分离有用
        // devProxy: {
        //   "/api": {
        //     target: "http://localhost:3000",
        //     changeOrigin: true,
        //     prependPath: true,
        //   },
        // },
      },
    });
    ```
2. 重启后验证

    ![](/framework/vue/nuxt/011.png)

## 2.5 全局写一下样式

1. 在 根目录下 创建 app/assets/index.css 

    ```css
    html {
      font-size: 16px;
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    }

    body {
      width: 100w;
      height: 100vh;
      overflow: auto;
    }

    * {
      padding: 0;
      margin: 0;
    }

    li {
      list-style: none;
    }
    ```

2. 在 nuxt.config.ts 中 添加全局样式

    ```ts
    export default defineNuxtConfig({
      css: ["~/assets/index.css"]
    })
    ```

3. index.vue 添加内容

    ```vue
    <ul>
        <li>1</li>
        <li>2</li>
        <li>3</li>
    </ul>
    ```
4. 运行结果

    ![](/framework/vue/nuxt/012.png)


## 2.6 项目优化

### 2.6.1 布局

1. 修改布局文件 `app/layouts/default.vue`

    ```vue
    <template>
      <div>
        <div class="fixed top-0 left-0 h-60px w-full flex justify-center items-center bg-gray-200">
          <nuxt-link class="mr-2" to="/">Home </nuxt-link>
          <nuxt-link class="mr-2" to="/about">About</nuxt-link>
          <Icon name="simple-icons:github" size="1rem" />
        </div>
        <div class="pt-60px mx-auto max-w-880px">
          <div class="p-[8px] min-h-[100vh]">
            <slot></slot>
          </div>
        </div>
        <div class="h-20vh w-full flex flex-col justify-center items-center bg-[#d4e2ff]">
          Blog
          <div>footer</div>
        </div>
      </div>
    </template>
    ```
2. 运行结果

    ![](/framework/vue/nuxt/013.gif)


### 2.6.2 编写首页

1. 修改文件 app/pages/index.vue

    ```vue
    <template>
      <div class="py-3">
        <ul class="w-full">
          <li class="w-full min-h-60px border-2 border-solid border-purple-300 mb-2 p-8 rounded-md" v-for="item in list" :key="item.id">
            <nuxt-link :to="`/posts/${item.id}`">
              <h1 class="mb-2">{{ item.name }}</h1>
            </nuxt-link>
            <p>{{ item.desc }}</p>
          </li>
        </ul>
      </div>
    </template>

    <script lang="ts" setup>
    const list = [
      {
        id: 1,
        name: "Nuxt 4",
        desc: "Nuxt 4 is a good idea",
        content: "Lamb chops are the best 1",
      },
      {
        id: 2,
        name: "Pinia",
        desc: "Pinia is a good idea",
        content: "Lamb chops are the best 2",
      },
      {
        id: 3,
        name: "Unocss",
        desc: "Unocss is a good idea",
        content: "Lamb chops are the best 3",
      },
      {
        id: 4,
        name: "Icon",
        desc: "Icon is a good idea",
        content: "Lamb chops are the best 4",
      },
      {
        id: 5,
        name: "Tailwindcss",
        desc: "Tailwindcss is a good idea",
        content: "Lamb chops are the best 5",
      },
      {
        id: 6,
        name: "Vue",
        desc: "Vue is a good idea",
        content: "Lamb chops are the best 6",
      },
    ];
    </script>
    ```
2. 运行结果

    ![](/framework/vue/nuxt/014.png)

### 2.6.3 编写 post 详情页面


1. 新增文件 `app/pages/posts/[id].vue`

    - `app/pages` 下创建 posts 文件夹
    - posts 下创建 `[id].vue` 文件

    ```vue
    <template>
      <div>
        post detail
        {{ id }}
      </div>
    </template>

    <script setup lang="ts">
    const route = useRoute();

    const id = route.params.id;
    console.log(id);
    </script>
    ```
2. 运行结果

    ![](/framework/vue/nuxt/015.png)


## 2.7 网络调用

### 2.7.1 前端调用api


1. 了解 useFetch 和 $fetch

    - [$fetch](https://nuxt.com/docs/4.x/getting-started/data-fetching#fetch)
    - [useFetch](https://nuxt.com/docs/4.x/getting-started/data-fetching#usefetch)

    useFetch 和 $fetch 都是 Nuxt 提供的用于数据获取的 API
    
    它们之间的主要区别是：useFetch 是在服务端执行，$fetch 在服务端执行一次、客户端执行一次

    一般来说，我们推荐使用 useFetch，因为 useFetch 是在服务端执行，更安全。

    通常我们会使用组合方式使用他们，使用 useAsyncData 和他们组合
    
    [useasyncdata](https://nuxt.com/docs/getting-started/data-fetching#useasyncdata)

2. 例子：

    ```ts
    <script setup lang="ts">
      const { data: discounts, status } = await useAsyncData('cart-discount', async () => {
        const [coupons, offers] = await Promise.all([
          $fetch('/api/test'),
        ])

        return { coupons, offers }
      })
    </script>
    ```

3. 封装 request `app/request/index.ts`

    主要是对一些请求进行前置处理和错误拦截


    ```ts
    export interface IHttpOptions {
      method: any;
      url: string;
      params?: any;
      data?: any;
      options?: any;
    }

    export interface IApiResponse<T extends any> {
      data: T;
      code: number;
      message?: string;
    }

    export async function http<T = any>(options: IHttpOptions): Promise<IApiResponse<T>> {
      const { url, method, params, data, options: config = {} } = options;
      const baseURL = import.meta.env.VITE_API_BASE;

      const { data: res }: any = await useFetch(baseURL + url, {
        method: method,
        // request 拦截
        onRequest: ({ options }) => {
          options.body = data;
          options.query = params;
          options.timeout = 10000;
          Object.assign(options, config);
        },
        // response 拦截
        onResponse: async ({ response }) => {
          console.log("response=", response._data);
          const res = response._data as IApiResponse<T>;
          const code = Number(res.code);
          if (code !== Number(import.meta.env.VITE_API_SUCCESS_CODE)) {
            throw createError({
              statusCode: response?._data.code,
              statusMessage: response?._data.message,
            });
          }

          return response;
        },
        onRequestError({ request, options, error }) {
          // 处理请求错误
          console.warn("request error", error);
        },
        onResponseError({ request, response, options }) {
          // 处理响应错误
          // console.warn('response error', response);
          throw createError({ statusCode: response.status, statusMessage: response.statusText });
        },
      });

      return res;
    }

    export async function $http<T = any>(options: IHttpOptions): Promise<IApiResponse<T>> {
      const { url, method, params, data, options: config = {} } = options;
      const baseURL = import.meta.env.VITE_API_BASE;

      const res = (await $fetch(baseURL + url, {
        method: method,
        onRequest: ({ options }) => {
          options.body = data;
          options.query = params;
          options.timeout = 10000;
          Object.assign(options, config);
        },
        onResponse: ({ response }) => {},
        onRequestError: (error) => {
          console.error(error);
        },
        onResponseError: (error) => {
          console.error(error);
        },
      })) as IApiResponse<T>;

      return res;
    }
    ```

4. 配置环境变量

    这里面用到的 VITE_API_BASE、VITE_API_SUCCESS_CODE 是写在 .env 配置文件里的，需要以VITE_ 开头，后续就可以从 import.meta.env 里获取

    ```
    VITE_API_BASE=http://localhost:3000

    VITE_API_SUCCESS_CODE=200
    ```

### 2.7.2 后端提供api

1. 项目可以直接提供api

    [server详情](https://nuxt.com/docs/4.x/guide/directory-structure/server)

2. 创建文件
    - app 下创建 server 文件夹 
    - server 下 新建 data.ts

      ```ts
      export const list = [
        {
          id: 1,
          name: "Nuxt 4",
          desc: "Nuxt 4 is a good idea",
          content: "Lamb chops are the best 1",
        },
        {
          id: 2,
          name: "Pinia",
          desc: "Pinia is a good idea",
          content: "Lamb chops are the best 2",
        },
        {
          id: 3,
          name: "Unocss",
          desc: "Unocss is a good idea",
          content: "Lamb chops are the best 3",
        },
        {
          id: 4,
          name: "Icon",
          desc: "Icon is a good idea",
          content: "Lamb chops are the best 4",
        },
        {
          id: 5,
          name: "Tailwindcss",
          desc: "Tailwindcss is a good idea",
          content: "Lamb chops are the best 5",
        },
        {
          id: 6,
          name: "Vue",
          desc: "Vue is a good idea",
          content: "Lamb chops are the best 6",
        },
      ];
      ```

3. server 下新建 api/posts/list.ts

    ```ts
    import { list } from "../../data";

    export default defineEventHandler((event) => {
      return list;
    });
    ```

### 2.7.3 首页 ssr 渲染

1. 修改代码 pages/index.vue

    ```vue
    <template>
      <div class="py-3">
        <ul class="w-full">
          <li class="w-full min-h-60px border-2 border-solid border-purple-300 mb-2 p-8 rounded-md" v-for="item in data" :key="item.id">
            <nuxt-link :to="`/posts/${item.id}`">
              <h1 class="mb-2">{{ item.name }}</h1>
            </nuxt-link>
            <p>{{ item.desc }}</p>
          </li>
        </ul>
      </div>
    </template>

    <script lang="ts" setup>
    const { data } = await useFetch<any>("/api/posts/list");
    </script>
    ```
2. 运行结果

    ![](/framework/vue/nuxt/016.png)


### 2.7.4 首页 csr 渲染

1. 修改代码 pages/index.vue
    ```vue
    <template>
      <div class="py-3">
        <ul class="w-full">
          <li class="w-full min-h-60px border-2 border-solid border-purple-300 mb-2 p-8 rounded-md" v-for="item in data" :key="item.id">
            <nuxt-link :to="`/posts/${item.id}`">
              <h1 class="mb-2">{{ item.name }}</h1>
            </nuxt-link>
            <p>{{ item.desc }}</p>
          </li>
        </ul>
      </div>
    </template>

    <script lang="ts" setup>
    const data = ref<any>([]);
    async function getPosts() {
      const res = await fetch("/api/posts/list");
      return res.json();
    }

    onMounted(async () => {
      data.value = await getPosts();
    });
    </script>
    ```

2. 运行结果

    ![](/framework/vue/nuxt/017.png)


>区别就在请求数据时机，ssr 是在服务端加载数据和渲染，csr 是在客户端渲染完成再加载数据


## 2.8 其他页面

### 2.8.1 post页面

1. 编写 post 详情接口

    创建 `server/api/posts/[id].ts` 文件

    ```ts
    import { list } from "../../data";

    export default defineEventHandler((event) => {
      const { id } = event.context.params || {};
      const post = list.find((item) => item.id === Number(id)) || null;
      return post;
    });
    ```

2. 修改 post 详情页面

    修改 `pages/posts/[id].vue`

    ```vue
    <template>
      <div class="p-8" v-if="data">
        <h1>{{ data.name }}</h1>
        <p>{{ data.desc }}</p>
        <p>{{ data.content }}</p>
        <button @click="() => $router.push('/')">返回</button>
      </div>
    </template>

    <script setup lang="ts">
    const route = useRoute();

    type Post = {
      id: number;
      name: string;
      desc: string;
      content: string;
    };

    const { data } = await useFetch<Post>(`/api/posts/${route.params.id}`);
    </script>
    ```

### 2.8.3 实现文章分页

1. 先编写一个根据函数，规范我们的返回值 server/api/data.ts

    ```ts
    export const result = (data: any) => {
      return {
        code: 200,
        message: "",
        data,
      };
    };
    ```

2. 修改 server/api/post/list.ts


    ```ts
    import { list, result } from "../../data";
    import { getQuery } from "#imports";

    export default defineEventHandler(async (event) => {
      const { page = 1, size = 5 } = getQuery<{
        page?: number;
        size?: number;
      }>(event);

      const offset = (page - 1) * size;
      const limit = size;
      const data = {
        currentPage: Number(page),
        pageSize: Number(size),
        list: list.slice(offset, offset + limit),
        total: list.length,
      };

      return result(data);
    });
    ```

3. 首页增加分页逻辑 `app/pages/index.vue` 


    ```vue
    <template>
      <div class="py-3">
        <ul class="w-full">
          <li class="w-full min-h-40px border-2 border-solid border-purple-300 mb-2 p-4 rounded-md" v-for="item in data.data.list" :key="item.id">
            <nuxt-link :to="`/posts/${item.id}`">
              <h1 class="mb-3">{{ item.name }}</h1>
            </nuxt-link>
            <p>{{ item.desc }}</p>
          </li>
        </ul>
        <div class="flex justify-between">
          <div>
            <span v-if="page > 1" @click="prev" class="cursor-pointer inline-block px-6 py-3 rounded-full font-bold border-2 border-solid border-purple-300 duration-300 hover:border-purple-700 hover:text-blue">prev</span>
          </div>
          <div>
            <span v-if="page < total / 5" @click="next" class="cursor-pointer inline-block px-6 py-3 rounded-full font-bold border-2 border-solid border-purple-300 duration-300 hover:border-purple-700 hover:text-blue"> next</span>
          </div>
        </div>
      </div>
    </template>

    <script lang="ts" setup>
    const page = ref(1);
    const size = ref(5);
    const total = ref(6);
    const { data, refresh } = await useFetch<any>(`/api/posts/list?page=${page.value}&size=${size.value}`);

    function next() {
      page.value += 1;
      refresh();
    }

    function prev() {
      page.value -= 1;
      refresh();
    }
    </script>
    ```

    > tip 虽然我们增加了一个分页的逻辑，但是我们无法实时的获取到正确的文章列表，因为 useFetch 传入的url和参数并没有更新，也就是使用了之前的参数

4. 解决方式： 

    1. useAsyncData + $fetch
        
        ```vue
        <script lang="ts" setup>
        import { useAsyncData } from "#app";
        import { $http } from "~/request/index";
        const page = ref(1);
        const size = ref(5);

        const { data } = await useAsyncData(
          "posts",
          async () => {
            const res = await $http({
              url: `/api/posts/list`,
              method: "GET",
              params: {
                page: page.value,
                size: size.value,
              },
            });
            return res.data;
          },
          {
            watch: [page],
          }
        );

        const list = computed(() => data.value.list);
        const hasMore = computed(() => {
          const total = data.value.total;
          return total > page.value * size.value;
        });

        function next() {
          page.value += 1;
        }

        function prev() {
          page.value -= 1;
        }
        </script>
        ```
    2. watch 监听page变化，使用 $fetch 实时请求

        ```vue
        <script lang="ts" setup>
        const page = ref(1);
        const size = ref(5);
        const total = ref(6);

        const url = computed(() => {
          return `http://localhost:3001/api/posts/list?page=${page.value}&size=${size.value}`;
        });

        const { data, refresh } = await useFetch<any>(url);

        function next() {
          page.value += 1;
          refresh();
        }

        function prev() {
          if (page.value > 1) {
            page.value -= 1;
            refresh();
          }
        }
        </script>
        ```


### 2.8.4 详情页面改造

1. 规范我们的返回值 `server/api/post/[id].ts`

    ```ts
    import { list, result } from "../../data";

    export default defineEventHandler((event) => {
      const { id } = event.context.params || {};
      const post = list.find((item) => item.id === Number(id)) || null;
      return result(post);
    });
    ```

2. 页面修改 `app/pages/posts/[id].vue`


    ```vue
    <template>
      <div class="p-8" v-if="data">
        <h1>{{ data.name }}</h1>
        <p>{{ data.desc }}</p>
        <p>{{ data.content }}</p>
        <button @click="() => $router.push('/')">返回</button>
      </div>
    </template>

    <script setup lang="ts">
    import { $http } from "~/request";

    const route = useRoute();

    type Post = {
      id: number;
      name: string;
      desc: string;
      content: string;
    };

    const { data } = await $http<Post>({
      method: "get",
      url: `/api/posts/${route.params.id}`,
    });
    </script>
    ```

## 2.9 seo 配置

### 2.9.1 nuxt.config.ts 配置 app

```ts
export default defineNuxtConfig({
   app: {
    // 设置 seo ，会设置到 html 的 head 里面
    head: {
      title: "Nuxt 4",
      meta: [
        { name: "description", content: "Nuxt 4" },
        { name: "keywords", content: "Nuxt 4" },
        { name: "viewport", content: "width=device-width, initial-scale=1" },
      ],
    },
  },
})
```

### 2.9.2 sitemap.xml

1. 安装插件

    ```bash
    npx nuxi@latest module add sitemap
    ```

    [官方文档](https://nuxtseo.com/docs/sitemap/guides/dynamic-urls)

2. 编写我们的站点信息 `api/__sitemap__/url.ts`

    ```ts
    // server/api/__sitemap__/urls.ts
    import type { SitemapUrlInput } from "#sitemap/types";
    import { list } from "../../data";

    export default defineSitemapEventHandler(() => {
      return list.map((v) => {
        return {
          loc: `/posts/${v.id}`,
          lastmod: new Date().toISOString(),
          changefreq: "weekly",
          priority: 0.8,
          _sitemap: "pages",
        };
      }) satisfies SitemapUrlInput[];
    });
    ```

3. 配置到 nuxt.config.ts 里

    ```ts
    export default defineNuxtConfig({
      site: {
        url: "http://localhost:3001",
        name: "localhost",
      },
      sitemap: {
        sources: [""],
        exclude: ["/login/**"],
        cacheMaxAgeSeconds: 6 * 60 * 60,
        autoLastmod: true,
        // 添加更多配置
        defaults: {
          changefreq: "weekly",
          priority: 0.8,
          lastmod: new Date(),
        },
        // 确保sitemap可以被搜索引擎访问
        xslColumns: [
          { label: "URL", width: "50%" },
          { label: "Last Modified", select: "sitemap:lastmod", width: "25%" },
          { label: "Priority", select: "sitemap:priority", width: "12.5%" },
          { label: "Change Frequency", select: "sitemap:changefreq", width: "12.5%" },
        ],
      }
    })
    ```

4. 运行结果

    打开 `http://localhost:3001/sitemap.xml` 查看 sitemap 

    ![](/framework/vue/nuxt/018.png)