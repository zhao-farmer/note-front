# 一、认识Vite

## 1.1 vite介绍

Vite 是一个现代化的前端构建工具，旨在通过利用现代浏览器的原生 ES 模块支持，提供快速的开发体验。

Vite 由两部分组成：

- 开发服务器： 基于原生 ES 模块，提供超快的热更新。
- 构建命令： 使用 Rollup 打包代码，生成适用于生产环境的优化静态资源。


1. 传统构建工具的痛点

    在 Vite 出现之前，前端开发通常使用 Webpack 等构建工具，这些工具虽然功能强大，但也存在一些痛点：

    - 启动速度慢： 项目越大，启动时间越长，影响开发效率。
    - 热更新慢： 每次修改代码后，都需要重新构建整个项目，导致热更新速度慢。
    - 配置复杂： Webpack 等工具配置复杂，学习成本高。

    Vite 的出现解决了传统构建工具的痛点，具有以下优势：

    - 极速启动： 利用浏览器原生 ES 模块支持，无需打包，启动速度极快。
    - 快速热更新： 仅更新修改的模块，保持应用状态，提升开发效率。
    - 丰富的功能： 支持 TypeScript、JSX、CSS 等，开箱即用。
    - 高度可扩展： 通过插件系统，轻松集成其他工具和框架。

2. Vite 的工作原理


    Vite 的工作原理可以分为开发模式和生产模式：

    - 开发模式：

        - Vite 启动一个开发服务器，利用浏览器原生支持 ES 模块的特性，直接加载源代码。
        - 当代码发生变化时，Vite 只会更新修改的模块，并通知浏览器进行热更新，保持应用状态。
    - 生产模式：

        - Vite 使用 Rollup 打包代码，生成优化后的静态资源文件。
        - 这些文件可以部署到任何静态文件服务器上。

3. Vite 适用场景

    Vite 适用于各种项目，尤其适合：

    - 单页应用 (SPA)： 如 Vue、React 项目。
    - 静态网站： 快速构建博客、文档等。
    - 库开发： 利用 Vite 的构建功能，高效开发和打包库。

## 1.2 创建 Vite 项目

1. 命令行执行

    ```sh
    npm create vite@latest
    ```

2. 项目选项（这里选用vue）

    ![](/other/construct/webpack/010.png)

3. 项目介绍

    - node_modules: 存放项目依赖的文件夹。
    - public: 存放静态资源的文件夹，例如图片、字体等。
    - src: 存放项目源代码的文件夹。
        - main.js: 项目入口文件。
        - App.vue: Vue 项目根组件。
    - index.html: 项目首页。
    - package.json: 项目配置文件，包含项目信息、依赖和脚本命令。
    - vite.config.js: Vite 配置文件，用于配置 Vite 的各种选项。

4. 安装并启动

    ```
    # 进入目录
    cd vite-test
    # 安装插件
    npm install
    # 启动项目
    npm run serve
    ```
5. 运行结果

    ![](/other/construct/vite/001.png)


6. 关于入口文件，vite 使用html作为入口文件，html中执行入口文件

    ```html
    <script type="module" src="/src/main.js"></script>
    ```

## 1.3 vite.config.js 配置项

```js
// 导入 defineConfig 函数，用于定义 Vite 配置
import { defineConfig } from 'vite';
// 导入 Vue 插件，用于支持 Vue 项目
import vue from '@vitejs/plugin-vue';
// 导入 path 模块，用于处理路径
import path from 'path';

// 使用 defineConfig 定义 Vite 配置
export default defineConfig({
  // 项目根目录，默认为当前工作目录
  root: path.resolve(__dirname, './src'),

  // 基础路径，用于部署在子路径时使用
  base: '/my-app/',

  // 开发服务器配置
  server: {
    // 指定开发服务器端口
    port: 3000,
    // 是否自动打开浏览器
    open: true,
    // 配置代理服务器，用于解决跨域问题
    proxy: {
      '/api': {
        target: 'http://localhost:8080', // 目标服务器地址
        changeOrigin: true, // 是否改变请求源
        rewrite: (path) => path.replace(/^\/api/, ''), // 重写请求路径
      },
    },
  },

  // 构建配置
  build: {
    // 指定输出目录
    outDir: path.resolve(__dirname, '../dist'),
    // 指定静态资源目录
    assetsDir: 'static',
    // 是否生成 sourcemap 文件
    sourcemap: true,
    // 是否压缩代码
    minify: 'terser', // 使用 terser 进行代码压缩
    // 配置 Rollup 选项
    rollupOptions: {
      // 配置外部依赖
      external: ['lodash'],
      // 配置输出格式
      output: {
        manualChunks: {
          // 将 lodash 单独打包
          lodash: ['lodash'],
        },
      },
    },
  },

  // 插件配置
  plugins: [
    // 使用 Vue 插件
    vue(),
  ],

  // 模块解析配置
  resolve: {
    // 配置路径别名
    alias: {
      '@': path.resolve(__dirname, './src'), // 将 @ 映射到 src 目录
    },
  },

  // CSS 配置
  css: {
    // 配置 CSS 预处理器选项
    preprocessorOptions: {
      scss: {
        // 全局注入 SCSS 变量
        additionalData: `@import "@/styles/variables.scss";`,
      },
    },
  },

  // 环境变量配置
  envPrefix: 'VITE_', // 环境变量前缀，默认为 VITE_
});
```
