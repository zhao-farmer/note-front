# 二、 Vite 的基础应用

## 2.1 vue3 + jsx

1. 初始化项目

    - 安装命令

        ```sh
        pnpm create vite
        ```
    - 选项

        ![](/other/construct/vite/002.png)

2. 安装 jsx 插件

    - 安装插件

        ```sh
        pnpm install @vitejs/plugin-vue-jsx -D
        ```
    - vite.config.js 使用插件

        ```js{3,7}
        import { defineConfig } from 'vite'
        import vue from '@vitejs/plugin-vue'
        import vueJsx from "@vitejs/plugin-vue-jsx"

        // https://vite.dev/config/
        export default defineConfig({
            plugins: [vue(),vueJsx()],
        })
        ```
3. 使用jsx

    1. 将App.vue 改为 App.jsx 
    
    2. 修改内容 App.jsx 

        ```jsx
        import { defineComponent } from "vue";

        export default defineComponent({
            setup(){
                return () =>{
                    return <div>Hello Vue3 jsx</div>
                }
            }
        })
        ```
    3. 修改入口文件 main.js

        ```js{3}
        import { createApp } from 'vue'
        import './style.css'
        import App from './App.jsx'

        createApp(App).mount('#app')
        ```
    4. 运行结果

        ![](/other/construct/vite/003.png)

## 2.2 vue2

1. 初始化项目

    - 安装命令

        ```sh
        pnpm create vite
        ```
    - 选项

        ![](/other/construct/vite/004.png)

2. 安装 vue2 插件

    - [进入 github 网站](https://github.com/vitejs/vite-plugin-vue2)

    - 运行命令

        ```sh
        # 进入目录
        cd 02_vue2
        # 安装vue2
        pnpm install vue@2
        # 安装 vite的vue2插件
        pnpm install vite-plugin-vue2 -D
        ```
    - 新增 vite.config.js 配置文件

        ```js
        import { defineConfig } from 'vite'
        import { createVuePlugin } from "vite-plugin-vue2"

        export default defineConfig({
            plugins: [createVuePlugin()],
        })

        ```
3. 新增vue文件

    1. 删除 src 下 所有文件

    2. 新增 main.js 

        ```js
        import Vue from "vue";
        import App from "./App.vue"

        // vm 对象
        const vm =  new Vue({
            el: "#app",
            render: (h) => h(App)
        })

        // 挂载
        vm.$mount()
        ```
    3. 新增 App.vue

        ```vue
        <template>
            <div>Hello Vite Vue2</div>
        </template>
        ```
    4. 运行结果

        ![](/other/construct/vite/005.png)

## 2.3 react

1. 初始化项目

    - 安装命令

        ```sh
        pnpm create vite
        ```
    - 选项

        ![](/other/construct/vite/006.png)

    - 安装插件

        ```sh
        # 进入目录
        cd 03_react
        # 安装插件
        pnpm install 
        ```
2. 启动项目

    - 执行命令

        ```sh
        npm run dev
        ```
    - 运行结果

        ![](/other/construct/vite/007.png)

## 2.4 处理css文件

1. 初始化项目

    - 安装命令

        ```sh
        pnpm create vite
        ```
    - 选项

        ![](/other/construct/vite/006.png)

    - 安装插件

        ```sh
        # 进入目录
        cd 04_css
        # 安装插件
        pnpm install 
        ```
2. 原生 css 样式

    - styles/index.css

        ```css
        :root{
            --main-bg-color: brown;
        }

        .root{
            color:var(--main-bg-color);
        }
        ```
    - App.vue 使用样式

        ```vue
        <template>
            <div class="root">Hello Vite</div>
        </template>

        <script setup>
        // 使用原生css
        import "./styles/index.css"

        </script>
        ```
    - 运行结果

        ![](/other/construct/vite/009.png)

3. postcss

    vite 默认引用了postccss,无需额外配置

    PostCSS 的 作用 如： Autoprefixer 插件
    
    ```css
    #content {
        display: flex;
    }
    ```

    编译后

    ```css
    #content {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
    }
    ```

4. 配置css文件映射地址

    1. vite.config.js

        ```js{7-11}
        import { defineConfig } from 'vite'
        import vue from '@vitejs/plugin-vue'

        // https://vite.dev/config/
        export default defineConfig({
        plugins: [vue()],
            resolve: {
                alias: {
                    '@styles': "/src/styles"
                }
            }
        })
        ```
    2. 新增 src/styles/other.css 

        ```css
        div{
            background-color: black;
        }
        ```
    3. App.vue 引入

        ```vue{8-9}
        <template>
            <div class="root">Hello Vite</div>
        </template>

        <script setup>
        // 使用原生css
        import "./styles/index.css"
        // 使用相对路径
        import "@styles/other.css"

        </script>
        ```

    4. 运行结果

        ![](/other/construct/vite/010.png)

5. CSS Modules

    任何以 .module.css 为后缀名的 CSS 文件都被认为是一个 CSS modules 文件。

    1. 新增 src/styles/test.module.css

        ```css
        .mouduleClass{
            color: yellow;
        }
        ```
    2. App.vue 中使用

        ```vue{4,13-14}
        <template>
        <div class="root">
            <span>Hello Vite</span><br>
            <span :class=[testMoudle.mouduleClass]>CSS modules</span><br>
        </div>
        </template>

        <script setup>
        // 使用原生css
        import "./styles/index.css"
        // 使用相对路径
        import "@styles/other.css"
        // 使用 css module
        import testMoudle from "@styles/test.module.css"

        </script>
        ```
    3. 运行结果

        ![](/other/construct/vite/011.png)

6. 预编译 css

    只需要安装就可以

    1. 安装 less 插件

        ```sh
        pnpm install less -D
        ```
    2. 新建文件 src/styles/test.less

        ```css
        @textColor: blue;

        .less-test{
            color: @textColor;
        }
        ```
    3. App.vue 中使用

        ```vue{5,16-17}
        <template>
            <div class="root">
                <span>Hello Vite</span><br>
                <span :class=[testMoudle.mouduleClass]>CSS modules</span><br>
                <span class="less-test">预编译 LESS</span><br>
            </div>
        </template>

        <script setup>
        // 使用原生css
        import "./styles/index.css"
        // 使用相对路径
        import "@styles/other.css"
        // 使用 css module
        import testMoudle from "@styles/test.module.css"
        // 使用less
        import "@styles/test.less"

        </script>
        ```
    4. 运行结果

        ![](/other/construct/vite/012.png)

## 2.5 使用TypeScript

1. 初始化项目

    - 安装命令

        ```sh
        pnpm create vite
        ```
    - 选项

        ![](/other/construct/vite/013.png)

    - 安装插件

        ```sh
        # 进入目录
        cd 05_typescript
        # 安装插件
        pnpm install 
        ```
2. 项目中的变化

    - 多了三个ts 配置文件

        ![](/other/construct/vite/014.png)
    - 构建项目时 会使用 tsc编译 package.json

        ```js{3}
        "scripts": {
            "dev": "vite",
            "build": "vue-tsc -b && vite build",
            "preview": "vite preview"
        },
        ```

## 2.6 处理静态资源的方法

1. 初始化项目

    - 安装命令

        ```sh
        pnpm create vite
        ```
    - 选项

        ![](/other/construct/vite/015.png)

    - 安装插件

        ```sh
        # 进入目录
        cd 06_static
        # 安装插件
        pnpm install 
        ```
2. 文件的使用方式

    - 修改App.vue 代码

        ```vue
        <template>
            <div>
                <span>文件-路径调用</span>
                <img src="./assets/vue.svg" >
            </div>
            <div>
                <span>文件-import引入</span>
                <img :src="logo1" >
            </div>
            <div>
                <span>文件-对象方式</span>
                <img :src="logo2" >
            </div>
        </template>

        <script setup>
        // 直接将文件导入
        import logo1 from "./assets/vue.svg"

        // 文件对象 - 要以src开头
        const logo2 = "/src/assets/vue.svg"
        </script>
        ```
    - 运行结果

        ![](/other/construct/vite/016.png)

3. 类型引入

    - 使用 url

        1. 新建文件 src/assets/test.txt 内容为 【我是测试数据】

        2. App.vue 的 script 添加代码

            ```js
            import url from "./assets/test.txt?url"
            console.log(url);
            ```
        3. 运行结果

            ![](/other/construct/vite/017.png)

    - 使用 raw

        1. App.vue 的 script 添加代码

            ```js
            import raw from "./assets/test.txt?raw"
            console.log(raw);
            ```
        2. 运行结果

            ![](/other/construct/vite/018.png)
    - 使用 worker / worker inline

        1. 新建 src/worker.js 文件

            ```js
            var i = 0;

            function timedCount(){
                i = i + 1;
                // 向主线程发送数据
                postMessage(i)
                setTimeout(timedCount, 1000);
            }

            timedCount()
            ```
        2. App.vue 的 script 添加代码

            ```js
            import Worker from "./worker?worker"
            const worker = new Worker()
            worker.onmessage = function(e){
                console.log(e);
            }
            ```
        3. 运行结果

            ![](/other/construct/vite/019.png)

4. 处理 json 数据

     1. App.vue 的 script 添加代码

        ```js
        import { version,devDependencies  } from "../package.json";
        console.log(version,devDependencies);
        ```
    2. 运行结果

        ![](/other/construct/vite/020.png)

5. web Assembly

    1. 安装插件

        ```sh
        pnpm install -D assemblyscript
        ```
    2. 新增 TS 脚本文件 src/fib.ts

        ```ts
        export function fib(n: i32): i32 {
            var a = 0, b = 1
            if (n > 0) {
                while (--n) {
                    let t = a + b
                    a = b
                    b = t
                }
                return b
            }
            return a
        }
        ```
    3. 执行命令

        ```sh
        ./node_modules/.bin/asc fib.ts --outFile fib.wasm --optimize
        ```

    4. App.vue 的 script 添加代码

        ```js
        import init from "./fib.wasm?init"
        init().then(instance =>{
            console.log(instance.exports.fib(10));
        })
        ```
    5. 运行结果

        ![](/other/construct/vite/021.png)

## 2.7 使用 eslint 和 prettier

1. 初始化项目

    - 安装命令

        ```sh
        pnpm create vite
        ```
    - `vite` 选项

        ![](/other/construct/vite/022.png)
    - `vue官方` 选项

        ![](/other/construct/vite/023.png)
    - 安装插件

        ```sh
        # 进入目录
        cd 07_verify
        # 安装插件
        npm install 
        ```
    - 项目中 eslint 与 prettier 可以直接使用

        ![](/other/construct/vite/024.png)

2. 使用命令

    ```sh
    # 检查代码 使用 eslint
    npm run lint
    # 不符合 eslint 的代码格式化 使用 prettier
    npm run format
    ```

3. 使用 husky 解决每次提交的代码检查问题

    - 执行命令

        ```sh
        # 安装husky插件
        npm install husky -D
        # 初始化husky
        npx husky init 
        ```
    - 修改 .husky/pre-commit 文件

        ```sh{1-2}
        # 运行 ESLint 检查
        npm run lint

        npm test
        ```

## 2.8 vite中 env 环境变量

1. 初始化项目

    - 安装命令

        ```sh
        pnpm create vite
        ```
    - 选项

        ![](/other/construct/vite/025.png)

    - 安装插件

        ```sh
        # 进入目录
        cd 08_env
        # 安装插件
        pnpm install 
        ```
2. 查看环境变量

    - 修改App.vue代码

        ```vue
        <script setup>
        // 打印环境变量
        console.log(import.meta.env);

        </script>

        <template>
        </template>
        ```
    - 控制台打印结果

        ![](/other/construct/vite/026.png)

    - 构建后的变量

        构建后的代码，直接转换为实际的值

        - 执行构建命令

            ```sh
            npm run build
            ```
        - 打包文件中的环境变量

            ![](/other/construct/vite/027.png)

3. 自定义环境变量

    - 根目录下新建 `.env` 文件 (必须以VIT开头的key值才能起作用)

        ```
        VITE_TITLE=hello
        ```
    - App.vue 的 script 添加代码

        ```js
        // 自定义环境变量
        console.log(import.meta.env.VITE_TITLE);
        ```
    - 运行结果

        ![](/other/construct/vite/028.png)

4. 开发/生产环境的 env 变量

    - 开发环境变量
        - 新建 .env.development

            ```json
            VITE_AAA=开发环境
            ```
        - 执行命令

            ```sh
            npm run dev
            ```
        - 运行结果

            ![](/other/construct/vite/029.png)
    - 开发环境变量

        - 新建 .env.production

            ```json
            VITE_AAA=生产环境
            ```
         - 执行命令

            ```sh
            npm run build
            ```
        - 代码中展示

            ![](/other/construct/vite/030.png)

5. 使用 mode 使用不同环境变量

    - 新建 .env.test 

        ```json
        VITE_AAA=test
        ```
    - 脚本中使用 mode 新值  
        
        ```js{3}
        "scripts": {
            "dev": "vite",
            "test": "vite --mode test",
            "build": "vite build",
            "preview": "vite preview"
        },
        ```
    - 执行脚本

        ```sh
        npm run test
        ```
    - 运行结果

        ![](/other/construct/vite/031.png)

6. 设置环境变量的类型

    - 新建文件 env.d.ts

        ```ts
        /// <reference types="vite/client" />
        interface ImportMetaEnv{
            VITE_TITLE: string;
        }
        ```
    - App.vue 的 script 添加代码

        ```js
        // 设置的环境变量类型
        console.log(typeof import.meta.env.VITE_TITLE);
        ```
    - 运行结果

        ![](/other/construct/vite/032.png)

        