# 三、webpack项目

## 3.1 React 脚手架

### 3.1.1 开发模式配置

1. 基础配置 config/webpack.dev.js

    ```ts
    const path = require("path")
    const ESLintWebpackPlugin = require("eslint-webpack-plugin")
    const HtmlWebpackPlugin = require("html-webpack-plugin") 

    // 返回处理样式的函数
    const getStyleLoader = (pre) =>{
        return [
            "style-loader",
            "css-loader",
            {
                // 处理css兼容性问题
                // 整合package.json中browserslist来指定兼容性
                loader:"postcss-loader",
                options:{
                    postcssOptions:{
                        plugins: ["postcss-preset-env"]
                    }
                }
            },
            pre
        ].filter(Boolean)
    }

    module.exports = {
        // 入口文件
        entry:"./src/main.js",
        output:{
            // 输出路径
            path:undefined,
            // 输出文件的入口文件
            filename: "static/js/[name].js",
            // 用于指定非入口 chunk 文件的命名规则。
            chunkFilename: "static/js/[name].chunk.js",
            // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
            assetModuleFilename: "static/media/[hash:10][ext][query]"
        },
        module:{
            rules:[
                // 处理css
                {
                    test: /\.css$/,
                    use: getStyleLoader()
                },
                {
                    test: /\.less$/,
                    use: getStyleLoader("less-loader")
                },
                {
                    test: /\.s[ac]ss$/,
                    use: getStyleLoader("sass-loader")
                },
                {
                    test: /\.styl$/,
                    use: getStyleLoader("stylus-loader")
                },
                // 处理图片
                {
                    test: /\.(jpe?g|png|gif|webp|svg)/,
                    type:"asset",
                    // 小于10kb 转换成base64
                    parser:{
                        dataUrlCondition:{
                            maxSize: 10 * 1024,
                        }
                    }
                },
                // 处理其他资源
                {
                    test:/\.woff2?|ttf/,
                    type:"asset/resource"
                },
                // 处理js
                {
                    test:/\.jsx?$/,
                    include:path.resolve(__dirname,"../src"),
                    loader:"babel-loader",
                    options:{
                        cacheDirectory:true,
                        cacheCompression:true
                    }
                    /* 需要外部的 babel.js 进行支持 */
                }
            ]
        },
        // 插件处理
        plugins:[
            // 代码检查
            new ESLintWebpackPlugin({
                context: path.resolve(__dirname,"../src"),
                exclude: "node_modules",
                cache: true,
                cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                /* 需要外部的 .eslintrc.js 进行支持 */
            }),
            // 处理html
            new HtmlWebpackPlugin({
                template: path.resolve(__dirname,"../public/index.html")
            })
        ],
        // 调试设计模式 - map压缩
        mode:"development",
        devtool:"cheap-module-source-map",
        optimization:{
            // 代码分割
            splitChunks:{
                chunks:"all",
            },
            runtimeChunk:{
                name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
            }
        },
        // 自动化配置
        devServer:{
            host: "localhost",
            port: 3000,
            open: true,
        }
    }
    ```

2. webpack.dev.js 依赖配置

    - 代码检查配置 .eslintrc.js

        ```js
        module.exports = {
            extends: ["react-app"], // 继承 react 官方规则
            parserOptions: {
                babelOptions: {
                presets: [
                    // 解决页面报错问题
                    ["babel-preset-react-app", false],
                    "babel-preset-react-app/prod",
                ],
                },
            },
        };
        ```

    - js转换配置 babel.config.js

        ```js
        module.exports = {
            // 使用react官方规则
            presets: ["react-app"],
        };
        ```
    - css覆盖浏览器配置 pacakage.json

        ```js
        "browserslist": [
            "last 2 version",
            "> 1%",
            "not dead"
        ],
        ```

3. react 项目初始化

    - public/index.html

        ```html
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>Document</title>
        </head>
        <body>
            <div id="root"></div>
        </body>
        </html>
        ```
    - src/App.jsx

        ```js
        import React from "react";

        function App(){
            return <h1>App</h1>
        }

        export default App
        ```
    - src/main.js

        ```js
        import React from "react";
        import ReactDOM from "react-dom/client"
        import App from "./App";

        const root = ReactDOM.createRoot(document.getElementById("root"))
        root.render(<App/>)
        ```

4. 安装依赖

    - 安装 pulgin 依赖

        ```sh:no-line-numbers
        npm i eslint-webpack-plugin@4 html-webpack-plugin -D
        ```
    - 安装 loder 依赖

        ```sh:no-line-numbers
        # 安装css依赖
        npm i style-loader css-loader postcss-loader postcss-preset-env -D
        # 安装预编译css依赖
        npm i less-loader sass-loader stylus-loader -D
        ```
    - 安装 babel 的react依赖

        ```sh:no-line-numbers
        npm i babel-loader @babel/core babel-preset-react-app -D
        ```
    - 安装 eslint 的react依赖

        ```sh:no-line-numbers
        npm i eslint-config-react-app -D
        ```
    - 安装 devServer 依赖

        ```sh:no-line-numbers
        npm i webpack-dev-server -D
        ```
    - 安装 webpack 依赖

        ```sh:no-line-numbers
        npm i webpack webpack-cli -D
        ```
    - 安装 react 依赖

        ```sh:no-line-numbers
        npm i react react-dom
        ```

5. 修改package.json 并改正问题

    - package.json 添加脚本

        ```json
        "scripts": {
            "start":"npm run dev",
            "dev": "webpack server --config ./config/webpack.dev.js"
        },
        ```
    - 错误一：babel-preset-react-app 必须要有环境变量

        - 错误图片
            
            ![](/other/construct/webpack/001.png)
        - 解决方案

            1. 安装插件

                ```sh
                npm install --save-dev cross-env
                ```
            2. 修改脚本 package.json 

                ```js
                "scripts": {
                    "start": "npm run dev",
                    "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.dev.js"
                },
                ```
    - 错误2：无法解析jsx 文件

         - 错误图片
            
            ![](/other/construct/webpack/002.png)

        - 解决方案: 修改配置文件 webpack.dev.js

            ```js{113-117}
            const path = require("path")
            const ESLintWebpackPlugin = require("eslint-webpack-plugin")
            const HtmlWebpackPlugin = require("html-webpack-plugin") 

            // 返回处理样式的函数
            const getStyleLoader = (pre) =>{
                return [
                    "style-loader",
                    "css-loader",
                    {
                        // 处理css兼容性问题
                        // 整合package.json中browserslist来指定兼容性
                        loader:"postcss-loader",
                        options:{
                            postcssOptions:{
                                plugins: ["postcss-preset-env"]
                            }
                        }
                    },
                    pre
                ].filter(Boolean)
            }

            module.exports = {
                // 入口文件
                entry:"./src/main.js",
                output:{
                    // 输出路径
                    path:undefined,
                    // 输出文件的入口文件
                    filename: "static/js/[name].js",
                    // 用于指定非入口 chunk 文件的命名规则。
                    chunkFilename: "static/js/[name].chunk.js",
                    // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
                    assetModuleFilename: "static/media/[hash:10][ext][query]"
                },
                module:{
                    rules:[
                        // 处理css
                        {
                            test: /\.css$/,
                            use: getStyleLoader()
                        },
                        {
                            test: /\.less$/,
                            use: getStyleLoader("less-loader")
                        },
                        {
                            test: /\.s[ac]ss$/,
                            use: getStyleLoader("sass-loader")
                        },
                        {
                            test: /\.styl$/,
                            use: getStyleLoader("stylus-loader")
                        },
                        // 处理图片
                        {
                            test: /\.(jpe?g|png|gif|webp|svg)/,
                            type:"asset",
                            // 小于10kb 转换成base64
                            parser:{
                                dataUrlCondition:{
                                    maxSize: 10 * 1024,
                                }
                            }
                        },
                        // 处理其他资源
                        {
                            test:/\.woff2?|ttf/,
                            type:"asset/resource"
                        },
                        // 处理js
                        {
                            test:/\.jsx?$/,
                            include:path.resolve(__dirname,"../src"),
                            loader:"babel-loader",
                            options:{
                                cacheDirectory:true,
                                cacheCompression:true,
                            }
                            /* 需要外部的 babel.js 进行支持 */
                        }
                    ]
                },
                // 插件处理
                plugins:[
                    // 代码检查
                    new ESLintWebpackPlugin({
                        
                        context: path.resolve(__dirname,"../src"),
                        exclude: "node_modules",
                        cache: true,
                        cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                        /* 需要外部的 .eslintrc.js 进行支持 */
                    }),
                    // 处理html
                    new HtmlWebpackPlugin({
                        template: path.resolve(__dirname,"../public/index.html")
                    }),
                ],
                // 调试设计模式 - map压缩
                mode:"development",
                devtool:"cheap-module-source-map",
                optimization:{
                    // 代码分割
                    splitChunks:{
                        chunks:"all",
                    },
                    runtimeChunk:{
                        name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
                    }
                },
                // webpackage解析模块加载选项
                resolve: {
                    // 自动补全文件扩展名
                    extensions:[".jsx",".js",".json"]
                },
                // 自动化配置
                devServer:{
                    host: "localhost",
                    port: 3000,
                    open: true,
                }
            }
            ```

6. 设置热更新 HMR

    - 新建HOME组件

        - 新建 jsx 文件 src/Home/index.jsx

            ```jsx
            import React from "react";
            import "./index.less"

            export default class Home extends React.Component{

                render() {
                    return (
                        <h1 className="home-title">Home~~~</h1>
                    );
                }
            }
            ```
        - 新建 jsx 文件 src/Home/index.less

            ```less
            .home-title{
                color: deeppink;
            }
            ```
    - 安装插件

        ```sh:no-line-numbers
        npm add @rspack/plugin-react-refresh react-refresh -D
        ```
    - 配置 webpack.dev.js

        ```js{4,81-83,103-104,128}
        const path = require("path")
        const ESLintWebpackPlugin = require("eslint-webpack-plugin")
        const HtmlWebpackPlugin = require("html-webpack-plugin") 
        const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');

        // 返回处理样式的函数
        const getStyleLoader = (pre) =>{
            return [
                "style-loader",
                "css-loader",
                {
                    // 处理css兼容性问题
                    // 整合package.json中browserslist来指定兼容性
                    loader:"postcss-loader",
                    options:{
                        postcssOptions:{
                            plugins: ["postcss-preset-env"]
                        }
                    }
                },
                pre
            ].filter(Boolean)
        }

        module.exports = {
            // 入口文件
            entry:"./src/main.js",
            output:{
                // 输出路径
                path:undefined,
                // 输出文件的入口文件
                filename: "static/js/[name].js",
                // 用于指定非入口 chunk 文件的命名规则。
                chunkFilename: "static/js/[name].chunk.js",
                // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
                assetModuleFilename: "static/media/[hash:10][ext][query]"
            },
            module:{
                rules:[
                    // 处理css
                    {
                        test: /\.css$/,
                        use: getStyleLoader()
                    },
                    {
                        test: /\.less$/,
                        use: getStyleLoader("less-loader")
                    },
                    {
                        test: /\.s[ac]ss$/,
                        use: getStyleLoader("sass-loader")
                    },
                    {
                        test: /\.styl$/,
                        use: getStyleLoader("stylus-loader")
                    },
                    // 处理图片
                    {
                        test: /\.(jpe?g|png|gif|webp|svg)/,
                        type:"asset",
                        // 小于10kb 转换成base64
                        parser:{
                            dataUrlCondition:{
                                maxSize: 10 * 1024,
                            }
                        }
                    },
                    // 处理其他资源
                    {
                        test:/\.woff2?|ttf/,
                        type:"asset/resource"
                    },
                    // 处理js
                    {
                        test:/\.jsx?$/,
                        include:path.resolve(__dirname,"../src"),
                        loader:"babel-loader",
                        options:{
                            cacheDirectory:true,
                            cacheCompression:true,
                            plugins:[
                                "react-refresh/babel"
                            ]
                        }
                        /* 需要外部的 babel.js 进行支持 */
                    }
                ]
            },
            // 插件处理
            plugins:[
                // 代码检查
                new ESLintWebpackPlugin({
                    context: path.resolve(__dirname,"../src"),
                    exclude: "node_modules",
                    cache: true,
                    cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                    /* 需要外部的 .eslintrc.js 进行支持 */
                }),
                // 处理html
                new HtmlWebpackPlugin({
                    template: path.resolve(__dirname,"../public/index.html")
                }),
                // react HMR
                new ReactRefreshWebpackPlugin()
            ],
            // 调试设计模式 - map压缩
            mode:"development",
            devtool:"cheap-module-source-map",
            optimization:{
                // 代码分割
                splitChunks:{
                    chunks:"all",
                },
                runtimeChunk:{
                    name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
                }
            },
            // webpackage解析模块加载选项
            resolve: {
                // 自动补全文件扩展名
                extensions:[".jsx",".js",".json"]
            },
            // 自动化配置
            devServer:{
                host: "localhost",
                port: 3000,
                open: true,
                hot: true,
            }
        }
        ```
    - 运行结果

        ![](/other/construct/webpack/003.png)

7. 路由配置

    - 安装插件

        ```sh:no-line-numbers
        npm i react-router-dom
        ```
    - react项目修改

        - mian.js

            ```js
            import React from "react";
            import ReactDOM from "react-dom/client"
            import { BrowserRouter } from "react-router-dom"
            import App from "./App";

            const root = ReactDOM.createRoot(document.getElementById("root"))
            root.render(
                <BrowserRouter>
                    <App/>
                </BrowserRouter>
            )
            ```
        - App.jsx

            ```jsx
            import React from "react";
            import Home from "./pages/Home"
            import About from "./pages/About"
            import {Link,Routes,Route} from  "react-router-dom"

            function App(){
                return (
                    <div>
                        <h1> App </h1>
                        <ul>
                            <li>
                                <Link to="/home">Home</Link> 
                            </li>
                            <li>
                                <Link to="/about">About</Link> 
                            </li>
                        </ul>

                        <Routes>
                            <Route path="/home" element={<Home/>}></Route>
                            <Route path="/about" element={<About/>}></Route>
                        </Routes>
                    </div>
                );
            }

            export default App
            ```
        - About/index.jsx

            ```jsx
            import React from "react";

            export default function About(){
                return <h1>About~~~</h1>
            }
            ```
    - 路由刷新后变为404 

        - 原因：打包的路径下没有响应的页面，react是单页面应用
        - 解决方法：webpack.dev.js 的 devServer下开启 historyApiFallback

            ```js
            // 自动化配置
            devServer:{
                host: "localhost",
                port: 3000,
                open: true,
                hot: true, //开启HMR
                historyApiFallback:true, // 解决SPA前端路由刷新404
            }
            ```
    - 路由懒加载

        - 修改页面 App.jsx

            ```js
            import React,{ Suspense, lazy } from "react";
            import {Link,Routes,Route} from  "react-router-dom"

            // import Home from "./pages/Home"
            // import About from "./pages/About"

            // webpackChunkName: 'home' 代表文件的名称
            const Home = lazy(() => import(/* webpackChunkName: 'home' */"./pages/Home"));
            const About = lazy(() => import(/* webpackChunkName: 'about' */"./pages/About"));

            function App(){
                return (
                    <div>
                        <h1> App </h1>
                        <ul>
                            <li>
                                <Link to="/home">Home</Link> 
                            </li>
                            <li>
                                <Link to="/about">About</Link> 
                            </li>
                        </ul>
                        <Suspense fallback={<div>loading...</div>}>
                            <Routes>
                                <Route path="/home" element={<Home/>}></Route>
                                <Route path="/about" element={<About/>}></Route>
                            </Routes>
                        </Suspense>
                    </div>
                );
            }

            export default App
            ```
        - 控制台资源展示

            ![](/other/construct/webpack/004.png)

8. 开发环境配置文件

    ```js
    const path = require("path")
    const ESLintWebpackPlugin = require("eslint-webpack-plugin")
    const HtmlWebpackPlugin = require("html-webpack-plugin") 
    const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');

    // 返回处理样式的函数
    const getStyleLoader = (pre) =>{
        return [
            "style-loader",
            "css-loader",
            {
                // 处理css兼容性问题
                // 整合package.json中browserslist来指定兼容性
                loader:"postcss-loader",
                options:{
                    postcssOptions:{
                        plugins: ["postcss-preset-env"]
                    }
                }
            },
            pre
        ].filter(Boolean)
    }

    module.exports = {
        // 入口文件
        entry:"./src/main.js",
        output:{
            // 输出路径
            path:undefined,
            // 输出文件的入口文件
            filename: "static/js/[name].js",
            // 用于指定非入口 chunk 文件的命名规则。
            chunkFilename: "static/js/[name].chunk.js",
            // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
            assetModuleFilename: "static/media/[hash:10][ext][query]"
        },
        module:{
            rules:[
                // 处理css
                {
                    test: /\.css$/,
                    use: getStyleLoader()
                },
                {
                    test: /\.less$/,
                    use: getStyleLoader("less-loader")
                },
                {
                    test: /\.s[ac]ss$/,
                    use: getStyleLoader("sass-loader")
                },
                {
                    test: /\.styl$/,
                    use: getStyleLoader("stylus-loader")
                },
                // 处理图片
                {
                    test: /\.(jpe?g|png|gif|webp|svg)/,
                    type:"asset",
                    // 小于10kb 转换成base64
                    parser:{
                        dataUrlCondition:{
                            maxSize: 10 * 1024,
                        }
                    }
                },
                // 处理其他资源
                {
                    test:/\.woff2?|ttf/,
                    type:"asset/resource"
                },
                // 处理js
                {
                    test:/\.jsx?$/,
                    include:path.resolve(__dirname,"../src"),
                    loader:"babel-loader",
                    options:{
                        cacheDirectory:true,
                        cacheCompression:true,
                        plugins:[
                            "react-refresh/babel"
                        ]
                    }
                    /* 需要外部的 babel.js 进行支持 */
                }
            ]
        },
        // 插件处理
        plugins:[
            // 代码检查
            new ESLintWebpackPlugin({
                context: path.resolve(__dirname,"../src"),
                exclude: "node_modules",
                cache: true,
                cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                /* 需要外部的 .eslintrc.js 进行支持 */
            }),
            // 处理html
            new HtmlWebpackPlugin({
                template: path.resolve(__dirname,"../public/index.html")
            }),
            // react HMR
            new ReactRefreshWebpackPlugin()
        ],
        // 调试设计模式 - map压缩
        mode:"development",
        devtool:"cheap-module-source-map",
        optimization:{
            // 代码分割
            splitChunks:{
                chunks:"all",
            },
            runtimeChunk:{
                name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
            }
        },
        // webpackage解析模块加载选项
        resolve: {
            // 自动补全文件扩展名
            extensions:[".jsx",".js",".json"]
        },
        // 自动化配置
        devServer:{
            host: "localhost",
            port: 3000,
            open: true,
            hot: true, //开启HMR
            historyApiFallback:true, // 解决SPA前端路由刷新404
        }
    }
    ```


### 3.1.2 生产模式配置

1. 新建 webpack.prod.js

    - 复制 webpack.dev.js 为 webpack.prod.js

    - 修改文件

        1. 修改输出路径

            ```js
            output:{
                // 输出路径
                path: path.resolve(__dirname,"../dist"),
                // 输出文件的入口文件
                filename: "static/js/[name].[contenthash:10].js",
                // 用于指定非入口 chunk 文件的命名规则。
                chunkFilename: "static/js/[name].[contenthash:10].chunk.js",
                // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
                assetModuleFilename: "static/media/[hash:10][ext][query]",
                // 清理上次文件
                clean: true,
            },
            ```
        2. 压缩文件

            - 压缩css
                
                - 第一步：提取css为单独文件
                
                    ```js
                    // 提取为单独文件
                    const MiniCssExtractPlugin = require("mini-css-extract-plugin");
                    // 返回处理样式的函数
                    const getStyleLoader = (pre) =>{
                        return [
                            // 使用minicss模式
                            MiniCssExtractPlugin.loader,
                            //...
                        ].filter(Boolean)
                    }
                    module.exports = {
                        // ..
                        plugins:[
                            //...
                            // 提取css为单独文件
                            new MiniCssExtractPlugin({
                                filename: "static/css/[name].[contenthash:10].css",
                                chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
                            })
                        ],
                    }
                    ```
                - 第二步：压缩提取css文件

                    ```js
                    // 压缩css
                    const CssMinimizerWebpackPlugin = require("css-minimizer-webpack-plugin")
                    module.exports = {
                        // ..
                        optimization:[
                            //...
                            // 压缩文件
                            minimizer:[new CssMinimizerWebpackPlugin()]
                        ],
                    }
                    ```
            - 压缩js

                ```js
                // 压缩js
                const TerserWebpackPlugin = require("terser-webpack-plugin")
                module.exports = {
                    // ..
                    optimization:[
                        //...
                        // 压缩文件
                        minimizer:[new CssMinimizerWebpackPlugin(), new TerserWebpackPlugin()]
                    ],
                }
                ```
            - 压缩html 

                ```js
                module.exports = {
                    // ..
                    mode:"production", // 改为生产模式自动会压缩
                    devtool:"source-map", // 生产模式
                }
                ```
        3. 去除生产用不到的

            - devServer (删除的内容)

                ```js
                // 自动化配置
                devServer:{
                    host: "localhost",
                    port: 3000,
                    open: true,
                    hot: true, //开启HMR
                    historyApiFallback:true, // 解决SPA前端路由刷新404
                }
                ```
            - 去除HMR (删除的内容)

                ```js
                const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');
                module.exports = {
                    //...
                    module:{
                        rules:[
                            // 处理js
                            {
                                //...
                                options:{
                                    //...
                                    plugins:[
                                        "react-refresh/babel"
                                    ]
                                }
                   
                            }
                        ]
                    },
                    plugins:[
                        //...
                        // react HMR
                        new ReactRefreshWebpackPlugin(),
                    ]
                }
                ```
        4. 压缩图片

            ```js
            // 压缩图片
            const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin")
            module.exports = {
                // ..
                optimization:[
                    //...
                    // 压缩文件
                    minimizer:[
                        new CssMinimizerWebpackPlugin(), 
                        new TerserWebpackPlugin(),
                        new ImageMinimizerPlugin({
                            minimizer: {
                                implementation: ImageMinimizerPlugin.imageminGenerate,
                                options: {
                                    plugins: [
                                        ["gifsicle", { interlaced: true }],
                                        ["jpegtran", { progressive: true }],
                                        ["optipng", { optimizationLevel: 5 }],
                                        [
                                            "svgo",
                                            {
                                                plugins: [
                                                    "preset-default",
                                                    "prefixIds",
                                                    {
                                                        name: "sortAttrs",
                                                        params: {
                                                            xmlnsOrder: "alphabetical",
                                                        },
                                                    },
                                                ],
                                            },
                                        ],
                                    ],
                                },
                            },
                        }),
                    ]
                ],
            }
            ```

2. 下载依赖

    - 压缩css依赖

        ```sh:no-line-numbers
        npm i mini-css-extract-plugin css-minimizer-webpack-plugin -D
        ```
    - 下载图片依赖

        ```sh:no-line-numbers
        # 下载包
        npm i image-minimizer-webpack-plugin imagemin -D
        # 无损压缩
        npm install imagemin-gifsicle imagemin-jpegtran imagemin-optipng imagemin-svgo -D
        ```

3. 开始打包 配置

    - 修改 package.json 中的build

        ```js{4}
        "scripts": {
            "start": "npm run dev",
            "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.dev.js",
            "build": "cross-env NODE_ENV=production webpack --config ./config/webpack.prod.js"
        },
        ```
    - 执行命令

        ```sh:no-line-numbers
        npm run build
        ```
    - 查看结果

        ![](/other/construct/webpack/005.png)

4. 解决静态文件无法放入dist包


    - 问题浮现
        1. 下载一个 favicon.ico 文件

        2. index.html 引入此文件

            ```html
            <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
            ```
        3. 打包文件没有图片显示

    - 解决方案

        - 下载插件

            ```sh:no-line-numbers
            npm install copy-webpack-plugin --save-dev
            ```
        - webpack.prod.js 配置

            ```js
            // 提取为单独文件
            const CopyPlugin = require("copy-webpack-plugin");
            module.exports = {
                // ..
                plugins:[
                    //...
                    // 复制文件
                    new CopyPlugin({
                        patterns: [
                            { 
                                // 复制文件的来源
                                from: path.resolve(__dirname,"../public"), 
                                // 复制文件到dist目录
                                to: path.resolve(__dirname,"../dist"),
                                globOptions: {
                                    // 忽略 index.html 文件
                                    ignore: ["**/index.html"]
                                }
                            },
                        ],
                    }),
                ],
            }
            ```

5. 生产模式配置文件

    ```js
    const path = require("path")
    const ESLintWebpackPlugin = require("eslint-webpack-plugin")
    const HtmlWebpackPlugin = require("html-webpack-plugin") 
    // 提取为单独文件
    const MiniCssExtractPlugin = require("mini-css-extract-plugin");
    // 压缩css
    const CssMinimizerWebpackPlugin = require("css-minimizer-webpack-plugin")
    // 压缩js
    const TerserWebpackPlugin = require("terser-webpack-plugin")
    // 压缩图片
    const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin")
    // 复制文件
    const CopyPlugin = require("copy-webpack-plugin");

    // 返回处理样式的函数
    const getStyleLoader = (pre) =>{
        return [
            MiniCssExtractPlugin.loader,
            "css-loader",
            {
                // 处理css兼容性问题
                // 整合package.json中browserslist来指定兼容性
                loader:"postcss-loader",
                options:{
                    postcssOptions:{
                        plugins: ["postcss-preset-env"]
                    }
                }
            },
            pre
        ].filter(Boolean)
    }

    module.exports = {
        // 入口文件
        entry:"./src/main.js",
        output:{
            // 输出路径
            path: path.resolve(__dirname,"../dist"),
            // 输出文件的入口文件
            filename: "static/js/[name].[contenthash:10].js",
            // 用于指定非入口 chunk 文件的命名规则。
            chunkFilename: "static/js/[name].[contenthash:10].chunk.js",
            // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
            assetModuleFilename: "static/media/[hash:10][ext][query]",
            // 清理上次文件
            clean: true,
        },
        module:{
            rules:[
                // 处理css
                {
                    test: /\.css$/,
                    use: getStyleLoader()
                },
                {
                    test: /\.less$/,
                    use: getStyleLoader("less-loader")
                },
                {
                    test: /\.s[ac]ss$/,
                    use: getStyleLoader("sass-loader")
                },
                {
                    test: /\.styl$/,
                    use: getStyleLoader("stylus-loader")
                },
                // 处理图片
                {
                    test: /\.(jpe?g|png|gif|webp|svg)/,
                    type:"asset",
                    // 小于10kb 转换成base64
                    parser:{
                        dataUrlCondition:{
                            maxSize: 10 * 1024,
                        }
                    }
                },
                // 处理其他资源
                {
                    test:/\.woff2?|ttf/,
                    type:"asset/resource"
                },
                // 处理js
                {
                    test:/\.jsx?$/,
                    include:path.resolve(__dirname,"../src"),
                    loader:"babel-loader",
                    options:{
                        cacheDirectory:true,
                        cacheCompression:true,
                    }
                    /* 需要外部的 babel.js 进行支持 */
                }
            ]
        },
        // 插件处理
        plugins:[
            // 代码检查
            new ESLintWebpackPlugin({
                context: path.resolve(__dirname,"../src"),
                exclude: "node_modules",
                cache: true,
                cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                /* 需要外部的 .eslintrc.js 进行支持 */
            }),
            // 处理html
            new HtmlWebpackPlugin({
                template: path.resolve(__dirname,"../public/index.html")
            }),
            // 提取css为单独文件
            new MiniCssExtractPlugin({
                filename: "static/css/[name].[contenthash:10].css",
                chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
            }),
            // 复制文件
            new CopyPlugin({
                patterns: [
                    { 
                        // 复制文件的来源
                        from: path.resolve(__dirname,"../public"), 
                        // 复制文件到dist目录
                        to: path.resolve(__dirname,"../dist"),
                        globOptions: {
                            // 忽略 index.html 文件
                            ignore: ["**/index.html"]
                        }
                    },
                ],
            }),
        ],
        mode:"production", // 改为生产模式自动会压缩
        devtool:"source-map",
        optimization:{
            // 代码分割
            splitChunks:{
                chunks:"all",
            },
            runtimeChunk:{
                name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
            },
            // 压缩文件
        minimizer:[
                new CssMinimizerWebpackPlugin(), 
                new TerserWebpackPlugin(),
                new ImageMinimizerPlugin({
                    minimizer: {
                        implementation: ImageMinimizerPlugin.imageminGenerate,
                        options: {
                            plugins: [
                                ["gifsicle", { interlaced: true }],
                                ["jpegtran", { progressive: true }],
                                ["optipng", { optimizationLevel: 5 }],
                                [
                                    "svgo",
                                    {
                                        plugins: [
                                            "preset-default",
                                            "prefixIds",
                                            {
                                                name: "sortAttrs",
                                                params: {
                                                    xmlnsOrder: "alphabetical",
                                                },
                                            },
                                        ],
                                    },
                                ],
                            ],
                        },
                    },
                }),
            ]
        },
        // webpackage解析模块加载选项
        resolve: {
            // 自动补全文件扩展名
            extensions:[".jsx",".js",".json"]
        },
    }
    ```

### 3.1.3 合并配置


1. 新增配置文件 config/webpack.config.js

    ```js
    const path = require("path")
    const ESLintWebpackPlugin = require("eslint-webpack-plugin")
    const HtmlWebpackPlugin = require("html-webpack-plugin") 
    const MiniCssExtractPlugin = require("mini-css-extract-plugin");
    const CssMinimizerWebpackPlugin = require("css-minimizer-webpack-plugin")
    const TerserWebpackPlugin = require("terser-webpack-plugin")
    const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin")
    const CopyPlugin = require("copy-webpack-plugin");
    const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');


    // 获取cross-env 定义的环境变量/运行的进程上的环境变量
    const isProduction = process.env.NODE_ENV === "production"

    // 返回处理样式的函数
    const getStyleLoader = (pre) =>{
        return [
            // 使用minicss模式
            isProduction ? MiniCssExtractPlugin.loader : "style-loader",
            "css-loader",
            {
                // 处理css兼容性问题
                // 整合package.json中browserslist来指定兼容性
                loader:"postcss-loader",
                options:{
                    postcssOptions:{
                        plugins: ["postcss-preset-env"]
                    }
                }
            },
            pre
        ].filter(Boolean)
    }

    module.exports = {
        // 入口文件
        entry:"./src/main.js",
        output:{
            // 输出路径
            path: isProduction ? path.resolve(__dirname,"../dist") : undefined,
            // 输出文件的入口文件
            filename: isProduction ? "static/js/[name].[contenthash:10].js":"static/js/[name].js",
            // 用于指定非入口 chunk 文件的命名规则。
            chunkFilename: isProduction ? "static/js/[name].[contenthash:10].chunk.js"
                : "static/js/[name].chunk.js",
            // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
            assetModuleFilename: "static/media/[hash:10][ext][query]",
            // 清理上次文件
            clean: true,
        },
        module:{
            rules:[
                // 处理css
                {
                    test: /\.css$/,
                    use: getStyleLoader()
                },
                {
                    test: /\.less$/,
                    use: getStyleLoader("less-loader")
                },
                {
                    test: /\.s[ac]ss$/,
                    use: getStyleLoader("sass-loader")
                },
                {
                    test: /\.styl$/,
                    use: getStyleLoader("stylus-loader")
                },
                // 处理图片
                {
                    test: /\.(jpe?g|png|gif|webp|svg)/,
                    type:"asset",
                    // 小于10kb 转换成base64
                    parser:{
                        dataUrlCondition:{
                            maxSize: 10 * 1024,
                        }
                    }
                },
                // 处理其他资源
                {
                    test:/\.woff2?|ttf/,
                    type:"asset/resource"
                },
                // 处理js
                {
                    test:/\.jsx?$/,
                    include:path.resolve(__dirname,"../src"),
                    loader:"babel-loader",
                    options:{
                        cacheDirectory:true,
                        cacheCompression:true,
                        plugins:[
                            !isProduction && "react-refresh/babel"
                        ].filter(Boolean)
                    }
                    /* 需要外部的 babel.js 进行支持 */
                }
            ]
        },
        // 插件处理
        plugins:[
            // 代码检查
            new ESLintWebpackPlugin({
                context: path.resolve(__dirname,"../src"),
                exclude: "node_modules",
                cache: true,
                cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                /* 需要外部的 .eslintrc.js 进行支持 */
            }),
            // 处理html
            new HtmlWebpackPlugin({
                template: path.resolve(__dirname,"../public/index.html")
            }),
            // 提取css为单独文件
            isProduction && new MiniCssExtractPlugin({
                filename: "static/css/[name].[contenthash:10].css",
                chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
            }),
            // 复制文件
            isProduction && new CopyPlugin({
                patterns: [
                    { 
                        // 复制文件的来源
                        from: path.resolve(__dirname,"../public"), 
                        // 复制文件到dist目录
                        to: path.resolve(__dirname,"../dist"),
                        globOptions: {
                            // 忽略 index.html 文件
                            ignore: ["**/index.html"]
                        }
                    },
                ],
            }),
            // react HMR
            !isProduction &&new ReactRefreshWebpackPlugin()
        ].filter(Boolean),
        mode: isProduction ? "production" : "development", // 改为生产模式自动会压缩
        devtool: isProduction ? "source-map": "cheap-module-source-map",
        optimization:{
            // 代码分割
            splitChunks:{
                chunks:"all",
            },
            runtimeChunk:{
                name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
            },
            // 是否需要压缩
            minimize: isProduction,
            // 压缩文件
            minimizer:[
                new CssMinimizerWebpackPlugin(), 
                new TerserWebpackPlugin(),
                new ImageMinimizerPlugin({
                    minimizer: {
                        implementation: ImageMinimizerPlugin.imageminGenerate,
                        options: {
                            plugins: [
                                ["gifsicle", { interlaced: true }],
                                ["jpegtran", { progressive: true }],
                                ["optipng", { optimizationLevel: 5 }],
                                [
                                    "svgo",
                                    {
                                        plugins: [
                                            "preset-default",
                                            "prefixIds",
                                            {
                                                name: "sortAttrs",
                                                params: {
                                                    xmlnsOrder: "alphabetical",
                                                },
                                            },
                                        ],
                                    },
                                ],
                            ],
                        },
                    },
                }),
            ]
        },
        // webpackage解析模块加载选项
        resolve: {
            // 自动补全文件扩展名
            extensions:[".jsx",".js",".json"]
        },
        // 运行配置
        devServer:{
            host: "localhost",
            port: 3000,
            open: true,
            hot: true, //开启HMR
            historyApiFallback:true, // 解决SPA前端路由刷新404
        }
    }
    ```

2. 修改运行指令 package.json

    ```json{8-9}
    {
        "name": "react-cli",
        "version": "1.0.0",
        "description": "",
        "main": "index.js",
        "scripts": {
            "start": "npm run dev",
            "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.config.js",
            "build": "cross-env NODE_ENV=production webpack --config ./config/webpack.config.js"
        },
        "keywords": [],
        "author": "",
        "license": "ISC",
        "devDependencies": {
            "@babel/core": "^7.17.10",
            "@pmmmwh/react-refresh-webpack-plugin": "^0.5.5",
            "babel-loader": "^8.2.5",
            "babel-preset-react-app": "^10.0.1",
            "cross-env": "^7.0.3",
            "css-loader": "^6.7.1",
            "css-minimizer-webpack-plugin": "^3.4.1",
            "eslint-config-react-app": "^7.0.1",
            "eslint-webpack-plugin": "^3.1.1",
            "html-webpack-plugin": "^5.5.0",
            "image-minimizer-webpack-plugin": "^3.2.3",
            "imagemin": "^8.0.1",
            "imagemin-gifsicle": "^7.0.0",
            "imagemin-jpegtran": "^7.0.0",
            "imagemin-optipng": "^8.0.0",
            "imagemin-svgo": "^10.0.1",
            "less-loader": "^10.2.0",
            "mini-css-extract-plugin": "^2.6.0",
            "react-refresh": "^0.13.0",
            "sass-loader": "^12.6.0",
            "style-loader": "^3.3.1",
            "stylus-loader": "^6.2.0",
            "webpack": "^5.72.0",
            "webpack-cli": "^4.9.2",
            "webpack-dev-server": "^4.9.0"
        },
        "dependencies": {
            "react": "^18.1.0",
            "react-dom": "^18.1.0",
            "react-router-dom": "^6.3.0"
        },
        "browserslist": ["last 2 version", "> 1%", "not dead"]
    }
    ```

### 3.1.4 优化配置

1. 使用antd 库

    1. 引入UI库

        ```sh
        npm i antd
        ```
    2. 使用antd库 App.js

        ```js{3,13}
        import React,{ Suspense, lazy } from "react";
        import {Link,Routes,Route} from  "react-router-dom"
        import { Button } from 'antd'

        // webpackChunkName: 'home' 代表文件的名称
        const Home = lazy(() => import(/* webpackChunkName: 'home' */"./pages/Home"));
        const About = lazy(() => import(/* webpackChunkName: 'about' */"./pages/About"));

        function App(){
            return (
                <div>
                    <h1> App </h1>
                    <Button type="primary">按钮</Button>

                    <ul>
                        <li>
                            <Link to="/home">Home</Link> 
                        </li>
                        <li>
                            <Link to="/about">About</Link> 
                        </li>
                    </ul>
                    <Suspense fallback={<div>loading...</div>}>
                        <Routes>
                            <Route path="/home" element={<Home/>}></Route>
                            <Route path="/about" element={<About/>}></Route>
                        </Routes>
                    </Suspense>
                </div>
            );
        }

        export default App
        ```
    3. 运行结果

        ![](/other/construct/webpack/006.png)

2. js文件进行分割（原因：大的js文件加载比较慢）

    ```js{145-167}
    const path = require("path")
    const ESLintWebpackPlugin = require("eslint-webpack-plugin")
    const HtmlWebpackPlugin = require("html-webpack-plugin") 
    const MiniCssExtractPlugin = require("mini-css-extract-plugin");
    const CssMinimizerWebpackPlugin = require("css-minimizer-webpack-plugin")
    const TerserWebpackPlugin = require("terser-webpack-plugin")
    const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin")
    const CopyPlugin = require("copy-webpack-plugin");
    const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin');


    // 获取cross-env 定义的环境变量/运行的进程上的环境变量
    const isProduction = process.env.NODE_ENV === "production"

    // 返回处理样式的函数
    const getStyleLoader = (pre) =>{
        return [
            // 使用minicss模式
            isProduction ? MiniCssExtractPlugin.loader : "style-loader",
            "css-loader",
            {
                // 处理css兼容性问题
                // 整合package.json中browserslist来指定兼容性
                loader:"postcss-loader",
                options:{
                    postcssOptions:{
                        plugins: ["postcss-preset-env"]
                    }
                }
            },
            pre
        ].filter(Boolean)
    }

    module.exports = {
        // 入口文件
        entry:"./src/main.js",
        output:{
            // 输出路径
            path: isProduction ? path.resolve(__dirname,"../dist") : undefined,
            // 输出文件的入口文件
            filename: isProduction ? "static/js/[name].[contenthash:10].js":"static/js/[name].js",
            // 用于指定非入口 chunk 文件的命名规则。
            chunkFilename: isProduction ? "static/js/[name].[contenthash:10].chunk.js"
                : "static/js/[name].chunk.js",
            // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
            assetModuleFilename: "static/media/[hash:10][ext][query]",
            // 清理上次文件
            clean: true,
        },
        module:{
            rules:[
                // 处理css
                {
                    test: /\.css$/,
                    use: getStyleLoader()
                },
                {
                    test: /\.less$/,
                    use: getStyleLoader("less-loader")
                },
                {
                    test: /\.s[ac]ss$/,
                    use: getStyleLoader("sass-loader")
                },
                {
                    test: /\.styl$/,
                    use: getStyleLoader("stylus-loader")
                },
                // 处理图片
                {
                    test: /\.(jpe?g|png|gif|webp|svg)/,
                    type:"asset",
                    // 小于10kb 转换成base64
                    parser:{
                        dataUrlCondition:{
                            maxSize: 10 * 1024,
                        }
                    }
                },
                // 处理其他资源
                {
                    test:/\.woff2?|ttf/,
                    type:"asset/resource"
                },
                // 处理js
                {
                    test:/\.jsx?$/,
                    include:path.resolve(__dirname,"../src"),
                    loader:"babel-loader",
                    options:{
                        cacheDirectory:true,
                        cacheCompression:true,
                        plugins:[
                            !isProduction && "react-refresh/babel"
                        ].filter(Boolean)
                    }
                    /* 需要外部的 babel.js 进行支持 */
                }
            ]
        },
        // 插件处理
        plugins:[
            // 代码检查
            new ESLintWebpackPlugin({
                context: path.resolve(__dirname,"../src"),
                exclude: "node_modules",
                cache: true,
                cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                /* 需要外部的 .eslintrc.js 进行支持 */
            }),
            // 处理html
            new HtmlWebpackPlugin({
                template: path.resolve(__dirname,"../public/index.html")
            }),
            // 提取css为单独文件
            isProduction && new MiniCssExtractPlugin({
                filename: "static/css/[name].[contenthash:10].css",
                chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
            }),
            // 复制文件
            isProduction && new CopyPlugin({
                patterns: [
                    { 
                        // 复制文件的来源
                        from: path.resolve(__dirname,"../public"), 
                        // 复制文件到dist目录
                        to: path.resolve(__dirname,"../dist"),
                        globOptions: {
                            // 忽略 index.html 文件
                            ignore: ["**/index.html"]
                        }
                    },
                ],
            }),
            // react HMR
            !isProduction &&new ReactRefreshWebpackPlugin()
        ].filter(Boolean),
        mode: isProduction ? "production" : "development", // 改为生产模式自动会压缩
        devtool: isProduction ? "source-map": "cheap-module-source-map",
        optimization:{
            // 代码分割
            splitChunks:{
                chunks:"all",
                cacheGroups: {
                    // react react-dom router-dom 一起打包成一个文件
                    react:{
                        // 匹配
                        test: /[\\/]node_modules[\\/]react(.*)?[\\/]/,
                        // 文件名
                        name: "chunk-react",
                        // 打包权重 从大到小
                        priority: 40,
                    },
                    // antd 单独打包
                    antd:{
                        test: /[\\/]node_modules[\\/]antd[\\/]/,
                        name: "chunk-antd",
                        priority: 30,
                    },
                    // 剩下 node_modules 单独打包
                    libs: {
                        test: /[\\/]node_modules[\\/]/,
                        name: "chunk-libs",
                        priority: 20,
                    }
                },
            },
            runtimeChunk:{
                name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
            },
            // 是否需要压缩
            minimize: isProduction,
            // 压缩文件
            minimizer:[
                new CssMinimizerWebpackPlugin(), 
                new TerserWebpackPlugin(),
                new ImageMinimizerPlugin({
                    minimizer: {
                        implementation: ImageMinimizerPlugin.imageminGenerate,
                        options: {
                            plugins: [
                                ["gifsicle", { interlaced: true }],
                                ["jpegtran", { progressive: true }],
                                ["optipng", { optimizationLevel: 5 }],
                                [
                                    "svgo",
                                    {
                                        plugins: [
                                            "preset-default",
                                            "prefixIds",
                                            {
                                                name: "sortAttrs",
                                                params: {
                                                    xmlnsOrder: "alphabetical",
                                                },
                                            },
                                        ],
                                    },
                                ],
                            ],
                        },
                    },
                }),
            ]
        },
        // webpackage解析模块加载选项
        resolve: {
            // 自动补全文件扩展名
            extensions:[".jsx",".js",".json"]
        },
        // 运行配置
        devServer:{
            host: "localhost",
            port: 3000,
            open: true,
            hot: true, //开启HMR
            historyApiFallback:true, // 解决SPA前端路由刷新404
        }
    }
    ```



## 3.2 Vue 脚手架

### 3.2.1 开发模式配置

1. webpack基础配置

    ```js
    const path = require("path")
    const ESLintWebpackPlugin = require("eslint-webpack-plugin")
    const HtmlWebpackPlugin = require("html-webpack-plugin") 
    const { VueLoaderPlugin } = require('vue-loader')

    // 返回处理样式的函数
    const getStyleLoader = (pre) =>{
        return [
            "vue-style-loader",
            "css-loader",
            {
                // 处理css兼容性问题
                // 整合package.json中browserslist来指定兼容性
                loader:"postcss-loader",
                options:{
                    postcssOptions:{
                        plugins: ["postcss-preset-env"]
                    }
                }
            },
            pre
        ].filter(Boolean)
    }

    module.exports = {
        // 入口文件
        entry:"./src/main.js",
        output:{
            // 输出路径
            path:undefined,
            // 输出文件的入口文件
            filename: "static/js/[name].js",
            // 用于指定非入口 chunk 文件的命名规则。
            chunkFilename: "static/js/[name].chunk.js",
            // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
            assetModuleFilename: "static/media/[hash:10][ext][query]"
        },
        module:{
            rules:[
                // 处理css
                {
                    test: /\.css$/,
                    use: getStyleLoader()
                },
                {
                    test: /\.less$/,
                    use: getStyleLoader("less-loader")
                },
                {
                    test: /\.s[ac]ss$/,
                    use: getStyleLoader("sass-loader")
                },
                {
                    test: /\.styl$/,
                    use: getStyleLoader("stylus-loader")
                },
                // 处理图片
                {
                    test: /\.(jpe?g|png|gif|webp|svg)/,
                    type:"asset",
                    // 小于10kb 转换成base64
                    parser:{
                        dataUrlCondition:{
                            maxSize: 10 * 1024,
                        }
                    }
                },
                // 处理其他资源
                {
                    test:/\.woff2?|ttf/,
                    type:"asset/resource"
                },
                // 处理js
                {
                    test:/\.js$/,
                    include:path.resolve(__dirname,"../src"),
                    loader:"babel-loader",
                    options:{
                        cacheDirectory:true,
                        cacheCompression:true,
                    }
                    /* 需要外部的 babel.js 进行支持 */
                },
                // 处理vue文件
                {
                    test: /\.vue$/,
                    loader: 'vue-loader'
                }
            ]
        },
        // 插件处理
        plugins:[
            // 代码检查
            new ESLintWebpackPlugin({
                context: path.resolve(__dirname,"../src"),
                exclude: "node_modules",
                cache: true,
                cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                /* 需要外部的 .eslintrc.js 进行支持 */
            }),
            // 处理html
            new HtmlWebpackPlugin({
                template: path.resolve(__dirname,"../public/index.html")
            }),
            // vue-loader 插件
            new VueLoaderPlugin()
        ],
        // 调试设计模式 - map压缩
        mode:"development",
        devtool:"cheap-module-source-map",
        optimization:{
            // 代码分割
            splitChunks:{
                chunks:"all",
            },
            runtimeChunk:{
                name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
            }
        },
        // webpackage解析模块加载选项
        resolve: {
            // 自动补全文件扩展名
            extensions:[".vue",".js",".json"]
        },
        // 自动化配置
        devServer:{
            host: "localhost",
            port: 3000,
            open: true,
            hot: true, //开启HMR
            historyApiFallback:true, // 解决SPA前端路由刷新404
        }
    }
    ```

1. 下载插件

    - 初始化项目 

        ```sh
        npm init -y
        ```

    - 下载vue-loader

        ```sh
        npm install -D vue-loader vue-template-compiler
        ```
    - 下载插件

        ```sh
        npm i eslint-webpack-plugin@4 html-webpack-plugin -D 
        ```
    - 下载 基础 css-loader

        ```sh
        npm i vue-style-loader postcss-loader postcss-preset-env -D 
        ```
    - 下载预编译 css-loader

        ```sh
        npm i less-loader sass-loader stylus-loader -D 
        ```
    - 下载 webpack 相关

        ```sh
        npm i webpack webpack-cli webpack-dev-server -D 
        ```
3. 其他配置文件

    - 代码检查配置 

        - 配置文件 .eslintrc.js

            ```js
            module.exports = {
                root: true,
                env: {
                    node: true,
                },
                extends: ["plugin:vue/vue3-essential", "eslint:recommended"],
                parserOptions: {
                    parser: "@babel/eslint-parser",
                },
            };
            ```
        - 安装插件 

            ```sh
            # plugin:vue/vue3-essential 必须含有 eslint-plugin-vue 才能使用
            # @babel/eslint-parser 安装
            npm i @babel/eslint-parser eslint-plugin-vue@9 -D
            ```
    - js转换配置 babel.config.js
        
        - 配置文件 .eslintrc.js

            ```js
            module.exports = {
                presets: ["@vue/cli-plugin-babel/preset"],
            };
            ```
        - 安装插件 

            ```sh
            npm i @vue/cli-plugin-babel -D
            ```
    - css覆盖浏览器配置 pacakage.json

        ```js
        "browserslist": [
            "last 2 version",
            "> 1%",
            "not dead"
        ],
        ```

4. vue代码
    1. 安装插件

        ```sh
        npm i vue
        ```
    2. 添加文件

        - public/index.html

            ```html
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <title>Vue cli</title>
            </head>
            <body>
                <div id="app"></div>
            </body>
            </html>
            ```
        - src/mian.js

            ```js
            import {createApp} from "vue"
            import App from "./App";

            createApp(App).mount(document.getElementById("app"))
            ```
        - src/App.vue

            ```vue
            <template>
                <h1 class="title">hello-app</h1>
            </template>

            <script>
            export default {
                name: "App"
            }
            </script>

            <style>
            .title{
                color: pink;
            }
            </style>
            ```
    3. 添加脚本 package.json

        - 添加启动脚本
            ```js
            "scripts": {
                "start": "npm run dev",
                "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.dev.js"
            },
            ```
        - 安装插件

            ```sh
            npm i cross-env -D
            ```
    4. 运行结果

        ![](/other/construct/webpack/007.png)

5. webpack.dev.js 其他配置

    - vue需要配置的环境变量

        ```js
        const { DefinePlugin } = require("webpack");
        module.exports = {
            //...
            plugins:[
                //...
                // cross-env 定义的环境变量给打包工具使用
                // DefinePlugin定义环境变量给源代码使用
                new DefinePlugin({
                    __VUE_OPTIONS_API__: true, 
                    __VUE_PROD_DEVTOOLS__: false
                })
            ]
        }
        ```
    - 使用 HMR 功能 (vue-loader 已实现)

        ![](/other/construct/webpack/008.png)

6. 使用 vue 路由

    1. 安装插件

        ```sh
        npm i vue-router
        ```
    2. 添加页面

        - Home页面 src/views/Home/index.vue

            ```vue
            <template>
                <h1 class="home-title">Home~~</h1>
            </template>

            <script>
            export default {
                name:"Home"
            }
            </script>

            <style>
            .home-title {
                color: deeppink;
                font-size: 33px;
            }
            </style>
            ```
        - About页面 src/views/About/index.vue

            ```vue
            <template>
                <h1>About~~</h1>
            </template>

            <script>
            export default {
                name:"About"
            }
            </script>
            ```
    3. 新增路由配置文件

        ```js
        import {createRouter,createWebHistory} from "vue-router"
        import About from "../views/About"

        // 路由懒加载
        const Home = () => import("../views/Home")

        export default createRouter({
            history: createWebHistory(),
            routes: [
                {
                    path: "/home",
                    component: Home
                },
                {
                    path: "/about",
                    component: About
                }
            ]
        })
        ```
    4. 修改入口文件

        - 使用路由模块 main.js

            ```js
            import {createApp} from "vue"
            import App from "./App";
            import router from "./router";

            const app = createApp(App)

            // 使用路由
            app.use(router)
            // 挂载到根组件
            app.mount(document.getElementById("app"))
            ```
        - 添加路由跳转 App.vue

            ```vue
            <template>
                <h1 class="title">hello-app</h1>
                <ul>
                    <li>
                        <router-link to="/home">Home</router-link>
                    </li>
                    <li>
                        <router-link to="/about">About</router-link>
                    </li>
                </ul>

                <!-- 路由展示 -->
                <router-view/>

            </template>

            <script>
            import Home from "./views/Home/index.vue"

            export default {
                name: "App",
                components:{
                    Home
                }
            }
            </script>

            <style>
            .title{
                color: pink;
            }
            </style>
            ```
7. 运行结果

    ![](/other/construct/webpack/009.png)

### 3.2.2 生产模式配置


1. 配置文件 

    ```js
    const path = require("path")
    const ESLintWebpackPlugin = require("eslint-webpack-plugin")
    const HtmlWebpackPlugin = require("html-webpack-plugin") 
    const MiniCssExtractPlugin = require("mini-css-extract-plugin");
    const CssMinimizerWebpackPlugin = require("css-minimizer-webpack-plugin")
    const TerserWebpackPlugin = require("terser-webpack-plugin")
    const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin")
    const CopyPlugin = require("copy-webpack-plugin");
    const { VueLoaderPlugin } = require('vue-loader')
    const { DefinePlugin } = require("webpack");

    // 返回处理样式的函数
    const getStyleLoader = (pre) =>{
        return [
            // 使用minicss模式
            MiniCssExtractPlugin.loader,
            "css-loader",
            {
                // 处理css兼容性问题
                // 整合package.json中browserslist来指定兼容性
                loader:"postcss-loader",
                options:{
                    postcssOptions:{
                        plugins: ["postcss-preset-env"]
                    }
                }
            },
            pre
        ].filter(Boolean)
    }

    module.exports = {
        // 入口文件
        entry:"./src/main.js",
        output:{
            // 输出路径
            path: path.resolve(__dirname,"../dist"),
            // 输出文件的入口文件
            filename: "static/js/[name].[contenthash:10].js",
            // 用于指定非入口 chunk 文件的命名规则。
            chunkFilename: "static/js/[name].[contenthash:10].chunk.js",
            // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
            assetModuleFilename: "static/media/[hash:10][ext][query]",
            // 清理上次文件
            clean: true,
        },
        module:{
            rules:[
                // 处理css
                {
                    test: /\.css$/,
                    use: getStyleLoader()
                },
                {
                    test: /\.less$/,
                    use: getStyleLoader("less-loader")
                },
                {
                    test: /\.s[ac]ss$/,
                    use: getStyleLoader("sass-loader")
                },
                {
                    test: /\.styl$/,
                    use: getStyleLoader("stylus-loader")
                },
                // 处理图片
                {
                    test: /\.(jpe?g|png|gif|webp|svg)/,
                    type:"asset",
                    // 小于10kb 转换成base64
                    parser:{
                        dataUrlCondition:{
                            maxSize: 10 * 1024,
                        }
                    }
                },
                // 处理其他资源
                {
                    test:/\.woff2?|ttf/,
                    type:"asset/resource"
                },
                // 处理js
                {
                    test:/\.js$/,
                    include:path.resolve(__dirname,"../src"),
                    loader:"babel-loader",
                    options:{
                        cacheDirectory:true,
                        cacheCompression:true,
                    }
                    /* 需要外部的 babel.js 进行支持 */
                },
                // 处理vue文件
                {
                    test: /\.vue$/,
                    loader: 'vue-loader'
                }
            ]
        },
        // 插件处理
        plugins:[
            // 代码检查
            new ESLintWebpackPlugin({
                context: path.resolve(__dirname,"../src"),
                exclude: "node_modules",
                cache: true,
                cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                /* 需要外部的 .eslintrc.js 进行支持 */
            }),
            // 处理html
            new HtmlWebpackPlugin({
                template: path.resolve(__dirname,"../public/index.html")
            }),
            // 提取css为单独文件
            new MiniCssExtractPlugin({
                filename: "static/css/[name].[contenthash:10].css",
                chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
            }),
            // 复制文件
            new CopyPlugin({
                patterns: [
                    { 
                        // 复制文件的来源
                        from: path.resolve(__dirname,"../public"), 
                        // 复制文件到dist目录
                        to: path.resolve(__dirname,"../dist"),
                        globOptions: {
                            // 忽略 index.html 文件
                            ignore: ["**/index.html"]
                        }
                    },
                ],
            }),
            // vue-loader 插件
            new VueLoaderPlugin(),
            new DefinePlugin({
                __VUE_OPTIONS_API__: true, 
                __VUE_PROD_DEVTOOLS__: false
            })
        ],
        mode:"production", // 改为生产模式自动会压缩
        devtool:"source-map",
        optimization:{
            // 代码分割
            splitChunks:{
                chunks:"all",
            },
            runtimeChunk:{
                name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
            },
            // 压缩文件
        minimizer:[
                new CssMinimizerWebpackPlugin(), 
                new TerserWebpackPlugin(),
                new ImageMinimizerPlugin({
                    minimizer: {
                        implementation: ImageMinimizerPlugin.imageminGenerate,
                        options: {
                            plugins: [
                                ["gifsicle", { interlaced: true }],
                                ["jpegtran", { progressive: true }],
                                ["optipng", { optimizationLevel: 5 }],
                                [
                                    "svgo",
                                    {
                                        plugins: [
                                            "preset-default",
                                            "prefixIds",
                                            {
                                                name: "sortAttrs",
                                                params: {
                                                    xmlnsOrder: "alphabetical",
                                                },
                                            },
                                        ],
                                    },
                                ],
                            ],
                        },
                    },
                }),
            ]
        },
        // webpackage解析模块加载选项
        resolve: {
            // 自动补全文件扩展名
            extensions:[".vue",".js",".json"]
        },
    }
    ```

2. 下载依赖

    - 压缩css依赖

        ```sh:no-line-numbers
        npm i mini-css-extract-plugin css-minimizer-webpack-plugin -D
        ```
    - 下载图片依赖

        ```sh:no-line-numbers
        # 下载包
        npm i image-minimizer-webpack-plugin imagemin -D
        # 无损压缩
        npm install imagemin-gifsicle imagemin-jpegtran imagemin-optipng imagemin-svgo -D
        ```
3. 修改脚本

    ```js
    "scripts": {
        "start": "npm run dev",
        "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.dev.js",
        "build": "cross-env NODE_ENV=production webpack --config ./config/webpack.config.js"
    },
    ```

### 3.2.3 合并开发和生产配置

1. 新建配置文件 webpack.config.js

    ```js
    const path = require("path")
    const ESLintWebpackPlugin = require("eslint-webpack-plugin")
    const HtmlWebpackPlugin = require("html-webpack-plugin") 
    const MiniCssExtractPlugin = require("mini-css-extract-plugin");
    const CssMinimizerWebpackPlugin = require("css-minimizer-webpack-plugin")
    const TerserWebpackPlugin = require("terser-webpack-plugin")
    const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin")
    const CopyPlugin = require("copy-webpack-plugin");
    const { VueLoaderPlugin } = require('vue-loader')
    const { DefinePlugin } = require("webpack");

    // 获取cross-env 定义的环境变量/运行的进程上的环境变量
    const isProduction = process.env.NODE_ENV === "production"

    // 返回处理样式的函数
    const getStyleLoader = (pre) =>{
        return [
            isProduction ? MiniCssExtractPlugin.loader : "vue-style-loader",
            "css-loader",
            {
                // 处理css兼容性问题
                // 整合package.json中browserslist来指定兼容性
                loader:"postcss-loader",
                options:{
                    postcssOptions:{
                        plugins: ["postcss-preset-env"]
                    }
                }
            },
            pre
        ].filter(Boolean)
    }

    module.exports = {
        // 入口文件
        entry:"./src/main.js",
        output:{
            // 输出路径
            path: isProduction ? path.resolve(__dirname,"../dist") : undefined,
            // 输出文件的入口文件
            filename: isProduction ? "static/js/[name].[contenthash:10].js":"static/js/[name].js",
            // 用于指定非入口 chunk 文件的命名规则。
            chunkFilename: isProduction ? "static/js/[name].[contenthash:10].chunk.js"
                : "static/js/[name].chunk.js",
            // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
            assetModuleFilename: "static/media/[hash:10][ext][query]",
            // 清理上次文件
            clean: true,
        },
        module:{
            rules:[
                // 处理css
                {
                    test: /\.css$/,
                    use: getStyleLoader()
                },
                {
                    test: /\.less$/,
                    use: getStyleLoader("less-loader")
                },
                {
                    test: /\.s[ac]ss$/,
                    use: getStyleLoader("sass-loader")
                },
                {
                    test: /\.styl$/,
                    use: getStyleLoader("stylus-loader")
                },
                // 处理图片
                {
                    test: /\.(jpe?g|png|gif|webp|svg)/,
                    type:"asset",
                    // 小于10kb 转换成base64
                    parser:{
                        dataUrlCondition:{
                            maxSize: 10 * 1024,
                        }
                    }
                },
                // 处理其他资源
                {
                    test:/\.woff2?|ttf/,
                    type:"asset/resource"
                },
                // 处理js
                {
                    test:/\.js$/,
                    include:path.resolve(__dirname,"../src"),
                    loader:"babel-loader",
                    options:{
                        cacheDirectory:true,
                        cacheCompression:true,
                    }
                    /* 需要外部的 babel.js 进行支持 */
                },
                // 处理vue文件
                {
                    test: /\.vue$/,
                    loader: 'vue-loader'
                }
            ]
        },
        // 插件处理
        plugins:[
            // 代码检查
            new ESLintWebpackPlugin({
                context: path.resolve(__dirname,"../src"),
                exclude: "node_modules",
                cache: true,
                cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                /* 需要外部的 .eslintrc.js 进行支持 */
            }),
            // 处理html
            new HtmlWebpackPlugin({
                template: path.resolve(__dirname,"../public/index.html")
            }),
            // 提取css为单独文件
            isProduction && new MiniCssExtractPlugin({
                filename: "static/css/[name].[contenthash:10].css",
                chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
            }),
            // 复制文件
            isProduction && new CopyPlugin({
                patterns: [
                    { 
                        // 复制文件的来源
                        from: path.resolve(__dirname,"../public"), 
                        // 复制文件到dist目录
                        to: path.resolve(__dirname,"../dist"),
                        globOptions: {
                            // 忽略 index.html 文件
                            ignore: ["**/index.html"]
                        }
                    },
                ],
            }),
            // vue-loader 插件
            new VueLoaderPlugin(),
            new DefinePlugin({
                __VUE_OPTIONS_API__: true, 
                __VUE_PROD_DEVTOOLS__: false
            })
        ].filter(Boolean),
        mode: isProduction ? "production" : "development", 
        devtool: isProduction ? "source-map": "cheap-module-source-map",
        optimization:{
            // 代码分割
            splitChunks:{
                chunks:"all",
            },
            runtimeChunk:{
                name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
            },
            // 是否需要压缩
            minimize: isProduction,
            // 压缩文件
            minimizer:[
                new CssMinimizerWebpackPlugin(), 
                new TerserWebpackPlugin(),
                new ImageMinimizerPlugin({
                    minimizer: {
                        implementation: ImageMinimizerPlugin.imageminGenerate,
                        options: {
                            plugins: [
                                ["gifsicle", { interlaced: true }],
                                ["jpegtran", { progressive: true }],
                                ["optipng", { optimizationLevel: 5 }],
                                [
                                    "svgo",
                                    {
                                        plugins: [
                                            "preset-default",
                                            "prefixIds",
                                            {
                                                name: "sortAttrs",
                                                params: {
                                                    xmlnsOrder: "alphabetical",
                                                },
                                            },
                                        ],
                                    },
                                ],
                            ],
                        },
                    },
                }),
            ]
        },
        // webpackage解析模块加载选项
        resolve: {
            // 自动补全文件扩展名
            extensions:[".vue",".js",".json"]
        },
        // 运行配置
        devServer:{
            host: "localhost",
            port: 3000,
            open: true,
            hot: true, //开启HMR
            historyApiFallback:true, // 解决SPA前端路由刷新404
        }
    }
    ```

2. 修改脚本文件

    ```js{4}
    "scripts": {
        "start": "npm run dev",
        "dev": "cross-env NODE_ENV=development webpack serve --config ./config/webpack.config.js",
        "build": "cross-env NODE_ENV=production webpack --config ./config/webpack.config.js"
    },
    ```

### 3.2.4 优化配置

1. 使用UI库

    1. 安装UI库

        ```sh
        npm i element-plus
        ```
    2. 入口文件引入 main.js

        ```js{4-5,11-12}
        import {createApp} from "vue"
        import App from "./App";
        import router from "./router";
        import ElementPlus from "element-plus"
        import 'element-plus/dist/index.css'

        const app = createApp(App)

        // 使用路由
        app.use(router)
        // 使用UI库
        app.use(ElementPlus)
        // 挂载到根组件
        app.mount(document.getElementById("app"))
        ```
    3. App.vue 的使用

        ```vue{3}
        <template>
            <h1 class="title">hello-app</h1>
            <el-button type="primary">按钮</el-button>
            <ul>
                <li>
                    <router-link to="/home">Home</router-link>
                </li>
                <li>
                    <router-link to="/about">About</router-link>
                </li>
            </ul>

            <!-- 路由展示 -->
            <router-view/>

        </template>

        <script>
        import Home from "./views/Home/index.vue"

        export default {
            name: "App",
            components:{
                Home
            }
        }
        </script>

        <style>
        .title{
            color: pink;
        }
        </style>
        ```

2. js文件进行分割（原因：大的js文件加载比较慢）

    ```js{150-180}
    const path = require("path")
    const ESLintWebpackPlugin = require("eslint-webpack-plugin")
    const HtmlWebpackPlugin = require("html-webpack-plugin") 
    const MiniCssExtractPlugin = require("mini-css-extract-plugin");
    const CssMinimizerWebpackPlugin = require("css-minimizer-webpack-plugin")
    const TerserWebpackPlugin = require("terser-webpack-plugin")
    const ImageMinimizerPlugin = require("image-minimizer-webpack-plugin")
    const CopyPlugin = require("copy-webpack-plugin");
    const { VueLoaderPlugin } = require('vue-loader')
    const { DefinePlugin } = require("webpack");

    // 获取cross-env 定义的环境变量/运行的进程上的环境变量
    const isProduction = process.env.NODE_ENV === "production"

    // 返回处理样式的函数
    const getStyleLoader = (pre) =>{
        return [
            isProduction ? MiniCssExtractPlugin.loader : "vue-style-loader",
            "css-loader",
            {
                // 处理css兼容性问题
                // 整合package.json中browserslist来指定兼容性
                loader:"postcss-loader",
                options:{
                    postcssOptions:{
                        plugins: ["postcss-preset-env"]
                    }
                }
            },
            pre
        ].filter(Boolean)
    }

    module.exports = {
        // 入口文件
        entry:"./src/main.js",
        output:{
            // 输出路径
            path: isProduction ? path.resolve(__dirname,"../dist") : undefined,
            // 输出文件的入口文件
            filename: isProduction ? "static/js/[name].[contenthash:10].js":"static/js/[name].js",
            // 用于指定非入口 chunk 文件的命名规则。
            chunkFilename: isProduction ? "static/js/[name].[contenthash:10].chunk.js"
                : "static/js/[name].chunk.js",
            // 用于指定 asset 模块的输出文件名。这些资源包括图片、字体等通过 loader 或 asset 模块引入的文件。
            assetModuleFilename: "static/media/[hash:10][ext][query]",
            // 清理上次文件
            clean: true,
        },
        module:{
            rules:[
                // 处理css
                {
                    test: /\.css$/,
                    use: getStyleLoader()
                },
                {
                    test: /\.less$/,
                    use: getStyleLoader("less-loader")
                },
                {
                    test: /\.s[ac]ss$/,
                    use: getStyleLoader("sass-loader")
                },
                {
                    test: /\.styl$/,
                    use: getStyleLoader("stylus-loader")
                },
                // 处理图片
                {
                    test: /\.(jpe?g|png|gif|webp|svg)/,
                    type:"asset",
                    // 小于10kb 转换成base64
                    parser:{
                        dataUrlCondition:{
                            maxSize: 10 * 1024,
                        }
                    }
                },
                // 处理其他资源
                {
                    test:/\.woff2?|ttf/,
                    type:"asset/resource"
                },
                // 处理js
                {
                    test:/\.js$/,
                    include:path.resolve(__dirname,"../src"),
                    loader:"babel-loader",
                    options:{
                        cacheDirectory:true,
                        cacheCompression:true,
                    }
                    /* 需要外部的 babel.js 进行支持 */
                },
                // 处理vue文件
                {
                    test: /\.vue$/,
                    loader: 'vue-loader'
                }
            ]
        },
        // 插件处理
        plugins:[
            // 代码检查
            new ESLintWebpackPlugin({
                context: path.resolve(__dirname,"../src"),
                exclude: "node_modules",
                cache: true,
                cacheLocation:path.resolve(__dirname,"../node_modules/.cache/.eslintcache"),
                /* 需要外部的 .eslintrc.js 进行支持 */
            }),
            // 处理html
            new HtmlWebpackPlugin({
                template: path.resolve(__dirname,"../public/index.html")
            }),
            // 提取css为单独文件
            isProduction && new MiniCssExtractPlugin({
                filename: "static/css/[name].[contenthash:10].css",
                chunkFilename: "static/css/[name].[contenthash:10].chunk.css",
            }),
            // 复制文件
            isProduction && new CopyPlugin({
                patterns: [
                    { 
                        // 复制文件的来源
                        from: path.resolve(__dirname,"../public"), 
                        // 复制文件到dist目录
                        to: path.resolve(__dirname,"../dist"),
                        globOptions: {
                            // 忽略 index.html 文件
                            ignore: ["**/index.html"]
                        }
                    },
                ],
            }),
            // vue-loader 插件
            new VueLoaderPlugin(),
            new DefinePlugin({
                __VUE_OPTIONS_API__: true, 
                __VUE_PROD_DEVTOOLS__: false
            })
        ].filter(Boolean),
        mode: isProduction ? "production" : "development", 
        devtool: isProduction ? "source-map": "cheap-module-source-map",
        optimization:{
            // 代码分割
            splitChunks:{
                chunks:"all",
                cacheGroups: {
                    // layouts通常是admin项目的主体布局组件，所有路由组件都要使用的
                    // 可以单独打包，从而复用
                    // 如果项目中没有，请删除
                    layouts: {
                        name: "layouts",
                        test: path.resolve(__dirname, "../src/layouts"),
                        priority: 40,
                    },
                    // 如果项目中使用element-plus，此时将所有node_modules打包在一起，那么打包输出文件会比较大。
                    // 所以我们将node_modules中比较大的模块单独打包，从而并行加载速度更好
                    // 如果项目中没有，请删除
                    elementUI: {
                        name: "chunk-elementPlus",
                        test: /[\\/]node_modules[\\/]_?element-plus(.*)/,
                        priority: 30,
                    },
                    // 将vue相关的库单独打包，减少node_modules的chunk体积。
                    vue: {
                        name: "vue",
                        test: /[\\/]node_modules[\\/]vue(.*)[\\/]/,
                        chunks: "initial",
                        priority: 20,
                    },
                    libs: {
                        name: "chunk-libs",
                        test: /[\\/]node_modules[\\/]/,
                        priority: 10, // 权重最低，优先考虑前面内容
                        chunks: "initial",
                    },
                },
            },
            runtimeChunk:{
                name:(entrypoiont) => `runtime~${entrypoiont.name}.js`
            },
            // 是否需要压缩
            minimize: isProduction,
            // 压缩文件
            minimizer:[
                new CssMinimizerWebpackPlugin(), 
                new TerserWebpackPlugin(),
                new ImageMinimizerPlugin({
                    minimizer: {
                        implementation: ImageMinimizerPlugin.imageminGenerate,
                        options: {
                            plugins: [
                                ["gifsicle", { interlaced: true }],
                                ["jpegtran", { progressive: true }],
                                ["optipng", { optimizationLevel: 5 }],
                                [
                                    "svgo",
                                    {
                                        plugins: [
                                            "preset-default",
                                            "prefixIds",
                                            {
                                                name: "sortAttrs",
                                                params: {
                                                    xmlnsOrder: "alphabetical",
                                                },
                                            },
                                        ],
                                    },
                                ],
                            ],
                        },
                    },
                }),
            ]
        },
        // webpackage解析模块加载选项
        resolve: {
            // 自动补全文件扩展名
            extensions:[".vue",".js",".json"]
        },
        // 运行配置
        devServer:{
            host: "localhost",
            port: 3000,
            open: true,
            hot: true, //开启HMR
            historyApiFallback:true, // 解决SPA前端路由刷新404
        }
    }
    ```

## 3.3 总结


1. 如何搭建 `React-Cli` 和 `Vue-Cli`。

2. 如何对脚手架进行优化。

3. 未来随着项目越来越大，还可以在优化的方案。
