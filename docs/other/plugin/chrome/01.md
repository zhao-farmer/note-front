# 一、初识chrome插件


Chrome 插件是​​增强浏览器功能的小型软件程序​​，它们可以极大地提升浏览体验和工作效率

官方文档

- [Chrome扩展文档](https://developer.chrome.com/docs/extensions?hl=zh-cn)
- [API参考](https://developer.chrome.com/docs/extensions/reference?hl=zh-cn)

## 1.1 核心组件详解

1. Manifest.json（配置文件）
    
    - ​作用​​：扩展的"身份证"，定义基本信息和权限
    
    - 关键字段​​：

        - manifest_version: 3（必须使用版本3）
        - name和version（必需字段）
        - permissions（声明所需API权限）
        - content_scripts（定义注入网页的脚本）

    - ​注意事项​​：权限申请要最小化，避免过度请求

2. Service Worker（后台脚本）

    - ​作用​​：扩展的大脑，管理生命周期和事件处理
    
    - ​​核心功能​​：
        - 处理扩展安装/更新事件
        - 管理跨组件消息通信
        - 执行后台定时任务
        - 维护扩展状态
    
    - 注意事项​​：保持轻量级，避免阻塞操作

3. Content Scripts（内容脚本）

    - 作用​​：与网页内容交互的桥梁

    - 执行环境​​：在隔离的沙箱环境中运行
    
    - ​主要能力​​：
        - 读取和修改DOM
        - 监听页面事件
        - 与后台脚本通信
    - 注意事项​​：避免性能影响，谨慎操作DOM

4. Popup（弹出窗口）

    - ​作用​​：用户交互的主要界面
    - 特性​​：
        - 点击扩展图标时显示
        - 小尺寸界面（通常300-600px宽）
        - 快速访问常用功能
    - 注意事项​​：保持界面简洁，加载要快速

5. Options Page（选项页面）
    
    - 作用​​：扩展设置的配置界面
    - 两种模式​​：

        - 嵌入式（在扩展管理页面内）
        - 独立标签页（更复杂的设置）
    - 注意事项​​：提供清晰的设置选项和说明

## 1.2 关键注意点

1. 安全性首要原则
    - ​权限最小化​​：只申请必要的权限
    - ​​输入验证​​：对所有用户输入进行严格验证
    - ​​CSP策略​​：设置合理的内容安全策略
    - ​​安全通信​​：使用HTTPS，避免中间人攻击

2. 性能优化要点

    - ​懒加载资源​​：按需加载大型资源
    - ​​事件节流​​：对高频操作进行节流处理
    - ​​内存管理​​：及时清理事件监听器和定时器
    - ​​代码分割​​：将功能模块化，减少初始加载量

3. 用户体验核心

    - ​响应速度​​：弹出窗口要在500ms内加载完成
    - ​错误处理​​：提供友好的错误提示和恢复方案
    - ​状态持久化​​：保存用户设置和偏好
    - ​无障碍支持​​：确保界面可访问性

4. 兼容性考虑

    - ​浏览器版本​​：支持主流Chrome版本
    - 操作系统​​：考虑不同OS的差异
    - 屏幕尺寸​​：适配各种显示器尺寸
    - 国际化​​：支持多语言和地区格式

## 1.3 开发流程最佳实践


1. 规划阶段

    - 明确扩展要解决的核心问题
    - 设计最小可行产品（MVP）
    - 确定目标用户和使用场景

2. 开发阶段
    - 采用模块化架构
    - 编写可测试的代码
    - 实施版本控制
    - 定期进行代码审查

3. 测试阶段
    - 功能测试：确保所有功能正常工作
    - 性能测试：检测内存泄漏和性能瓶颈
    - 安全测试：检查潜在的安全漏洞
    - 用户体验测试：收集真实用户反馈

4. 发布阶段
    - 准备应用商店所需的材料（图标、截图、描述）
    - 编写清晰的用户文档
    - 制定更新和维护计划


## 1.4 Hello World 扩展

### 1.4.1 新建文件

1. 创建 manifest.json

    ```json
    {
        "name": "Hello Extensions",
        "description": "Base Level Extension",
        "version": "1.0",
        "manifest_version": 3,
        "action": {
            "default_popup": "hello.html",
            "default_icon": "hello_extensions.png"
        }
    }
    ```
2. 新建hello.html

    ```html
    <html>
        <body>
            <h1>Hello Extensions</h1>
        </body>
    </html>
    ```
3. 找张图片改为 `default_icon.png`


### 1.4.2 加载未打包的扩展程序

如需在开发者模式下加载未封装的扩展程序，请执行以下操作：

1. 在新标签页中输入 chrome://extensions 即可前往“扩展程序”页面。（根据设计，chrome:// 网址不可链接。）
    - 或者，点击“扩展程序”菜单拼图按钮，然后选择菜单底部的管理扩展程序。
    - 或者，点击 Chrome 菜单，将鼠标悬停在更多工具上，然后选择扩展程序。
2. 点击开发者模式旁边的切换开关，即可启用开发者模式。
3. 点击加载已解压缩的文件按钮，然后选择扩展程序目录。

![](/other/plugin/chrome/001.png)

### 1.4.3 固定扩展程序

默认情况下，当您在本地加载扩展程序时，它会显示在扩展程序菜单 (益智) 中。将扩展程序固定到工具栏，以便在开发过程中快速访问扩展程序。

![](/other/plugin/chrome/002.png)


点击扩展程序的操作图标（工具栏图标）；会看到一个弹出式窗口。

![](/other/plugin/chrome/003.png)

### 1.4.4 重新加载扩展程序

返回代码，然后在清单中将扩展程序的名称更改为“Hello Extensions of the world!”。

```json
{
  "manifest_version": 3,
  "name": "Hello Extensions of the world!",
  ...
}
```

保存文件后，您还必须刷新扩展程序，才能在浏览器中看到此更改。前往“附加信息”页面，然后点击开启/关闭切换开关旁边的刷新图标：

![](/other/plugin/chrome/004.png)


**何时重新加载扩展程序**

下表显示了哪些组件需要重新加载才能看到更改：

| 扩展程序组件         | 需要重新加载扩展程序 |
|----------------|------------|
| 清单             | 是          |
| Service Worker | 是          |
| 内容脚本           | 是（包括托管网页）  |
| 弹出式窗口          | 否          |
| “选项”页面         | 否          |
| 其他扩展程序 HTML 网页 | 否          |

### 1.4.5 查找控制台日志和错误

1. 控制台日志

    在开发期间，您可以通过访问浏览器控制台日志来调试代码。在本例中，我们将找到弹出式窗口的日志。
    
    
    - 首先，将脚本标记添加到 hello.html。

        ```html
        <html>
        <body>
            <h1>Hello Extensions</h1>
            <script src="popup.js"></script>
        </body>
        </html>
        ```

    - 创建一个 popup.js 文件，并添加以下代码。

        ```js
        console.log("This is a popup!")
        ```

    - 如需在控制台中查看系统记录的这条消息，请执行以下操作：

        1. 打开弹出式窗口。
        2. 右键点击弹出式窗口。
        3. 选择检查。

        ![](/other/plugin/chrome/005.png)

    - 在 DevTools 中，前往控制台面板

        ![](/other/plugin/chrome/006.png)

2. 错误日志

    1. 现在，我们来破坏一下扩展程序。为此，我们可以移除 popup.js 中的闭引号：

        ```js
        console.log("This is a popup!)
        ```

    2. 前往“扩展程序”页面，然后打开弹出式窗口。系统随即会显示一个错误按钮。

        ![](/other/plugin/chrome/007.png)

    3. 点击错误按钮，详细了解相应错误：

        ![](/other/plugin/chrome/008.png)