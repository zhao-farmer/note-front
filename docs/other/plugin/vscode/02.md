# 二、实战操作

## 2.1 需求-vue模板

1. 原因：

    vue官网给出了 vscode 插件(Vue Officaial)，但是并没有直接生成模板的功能

    原本的 Vetur 跟官方给出的插件有冲突，造成查看 css 中有两个颜色，自己经常使用快速模板生成文件自能自己写了

2. 功能需求

    在vue文件下 输入vue2 生成vue2模板 输入vue3生成 vue3模板


## 2.2 实现

1. 实现思路

    - 监听文档变化​​：使用 vscode.workspace.onDidChangeTextDocument事件来监测用户输入。
    - 判断条件​​：检查更改是否发生在 .vue文件的第一行，并且内容是否为 vue2或 vue3。
    - ​执行替换​​：如果条件满足，使用编辑器 API 用模板替换掉关键词。

2. 代码实现

    在 src/extension.ts中实现核心逻辑：

    ```ts
    import * as vscode from 'vscode';

    // 定义模板
    const VUE_TEMPLATES: { [key: string]: string } = {
        'vue2': `<template>
    <div>
        <!-- Vue 2 模板内容 -->
    </div>
    </template>

    <script>
    export default {
    name: 'MyComponent',
    data() {
        return {
        // 数据属性
        };
    },
    methods: {
        // 方法
    }
    };
    </script>

    <style scoped>
    /* 样式 */
    </style>`,
        'vue3': `<script setup>
    // Composition API with <script setup>
    import { ref, reactive } from 'vue';

    const count = ref(0);
    const state = reactive({ message: 'Hello Vue 3!' });
    </script>

    <template>
    <div>
        <p>{{ state.message }}</p>
        <button @click="count++">Count is: {{ count }}</button>
    </div>
    </template>

    <style scoped>
    /* 样式 */
    </style>`
    };

    export function activate(context: vscode.ExtensionContext) {
        console.log('Vue Template Generator is now active!');

        // 订阅文档更改事件
        let disposable = vscode.workspace.onDidChangeTextDocument((event) => {
            // 获取活动的文本编辑器
            const editor = vscode.window.activeTextEditor;
            if (!editor || event.document !== editor.document) {
                return;
            }

            // 检查是否是 .vue 文件
            if (event.document.languageId !== 'vue') {
                return;
            }

            // 获取文档内容
            const document = event.document;
            const firstLine = document.lineAt(0);
            const firstLineText = firstLine.text.trim();

            // 检查第一行内容是否是 vue2 或 vue3
            if (VUE_TEMPLATES[firstLineText]) {
                // 获取模板
                const template = VUE_TEMPLATES[firstLineText];

                // 使用编辑操作替换内容
                editor.edit((editBuilder) => {
                    // 计算整个文档的范围（从开始到结束）
                    const fullRange = new vscode.Range(
                        document.positionAt(0),
                        document.positionAt(document.getText().length)
                    );
                    
                    // 用模板替换整个文档内容
                    editBuilder.replace(fullRange, template);
                }).then(success => {
                    if (success) {
                        vscode.window.showInformationMessage(`已生成 ${firstLineText} 模板！`);
                        
                        // 将光标移动到模板开始位置
                        const position = new vscode.Position(0, 0);
                        editor.selection = new vscode.Selection(position, position);
                    }
                });
            }
        });

        context.subscriptions.push(disposable);
    }

    export function deactivate() {}
    ```