# 一、RxJs概念

## 1.1 认识RxJs

1. 基本概念
    - Observable 可观察者, 生产数据
    - Observer 观察者， 消费数据
    - Subscription 订阅/可清理对象, 用以清理资源或中断Observeable执行
    - Subject 多播主体, 向多个订阅者广播数据
    - Operators 操作符, 处理数据的函数

2. 数据获取方式, 推送/拉取

    数据的获取方式，表示了数据生产者和数据消费者之间的通信关系

    - 拉取: 由消费者控制何时获取数据, 例如：请求状态管理器中的状态指
    - 推送: 有生产者控制何时获取数据, 例如：向服务器请求数据


## 1.2 安装 RxJS

1. 浏览器/Node.js 安装

    ```sh
    npm install rxjs
    ```
2. CDN 引入（浏览器）

    ```html
    <script src="https://cdn.jsdelivr.net/npm/rxjs@7/dist/bundles/rxjs.umd.min.js"></script>
    ```

## 1.3 基础案例

1. Observable（可观察对象）
    
    表示一个异步数据流，可以发出多个值（数据、错误、完成信号）。

    ```js
    import { Observable } from 'rxjs';

    const observable = new Observable(subscriber => {
        subscriber.next(1); // 发送数据
        subscriber.next(2);
        setTimeout(() => {
            subscriber.next(3);
            subscriber.complete(); // 完成流
        }, 1000);
    });
    ```
2. Observer（观察者）

    订阅 Observable，处理数据、错误或完成事件。

    ```js
    const observer = {
        next: value => console.log('收到数据:', value),
        error: err => console.error('发生错误:', err),
        complete: () => console.log('流已完成'),
    };

    observable.subscribe(observer);
    // 输出：
    // 收到数据: 1
    // 收到数据: 2
    // （1秒后）
    // 收到数据: 3
    // 流已完成
    ```

3. Subscription（订阅）

    用于取消订阅，防止内存泄漏。

    ```js
    const subscription = observable.subscribe(observer);
    subscription.unsubscribe(); // 取消订阅
    ```
## 1.4 Subject 主体

既是 Observable 又是 Observer，支持多播（多个观察者共享同一个 Observable）

```js
import { Subject } from 'rxjs';

const subject = new Subject();

// 订阅 Subject（多个观察者）
subject.subscribe(value => console.log('观察者A:', value));
subject.subscribe(value => console.log('观察者B:', value));

// 发送数据（所有订阅者都会收到）
subject.next(1);
subject.next(2);

// 输出：
// 观察者A: 1
// 观察者B: 1
// 观察者A: 2
// 观察者B: 2
```

## 1.5 Scheduler 调度器

控制 Observable 的异步执行时机（如 setTimeout、requestAnimationFrame、setImmediate 等）。

```js
import { asyncScheduler,Observable } from 'rxjs';

const observable = new Observable(subscriber => {
    subscriber.next(1);
    subscriber.next(2);
    asyncScheduler.schedule(() => {
        subscriber.next(3);
        subscriber.complete();
    }, 1000);
});

observable.subscribe(console.log);

// 输出：
// 1
// 2
// （1秒后）
// 3
```

## 1.5 Operators 操作符

用于对 Observable 流进行转换、过滤、组合等操作。

- map（转换数据）

    ```js
    import { of } from 'rxjs';
    import { map } from 'rxjs/operators';

    of(1, 2, 3)
        .pipe(map(x => x * 2))
        .subscribe(console.log);

    // 输出：
    // 2
    // 4
    // 6
    ```
- filter（过滤数据）

    ```js
    import { of } from 'rxjs';
    import { filter } from 'rxjs/operators';

    of(1, 2, 3, 4, 5)
        .pipe(filter(x => x % 2 === 0))
        .subscribe(console.log);

    // 输出：
    // 2
    // 4
    ```
- debounceTime（防抖）

    ```js
    import { fromEvent } from 'rxjs';
    import { debounceTime } from 'rxjs/operators';

    const input = document.getElementById('search');
    fromEvent(input, 'input')
        .pipe(debounceTime(300))
        .subscribe(() => console.log('用户输入:', input.value));
    ```
- switchMap（切换至新流）

    ```js
    import { fromEvent } from 'rxjs';
    import { switchMap } from 'rxjs/operators';

    fromEvent(button, 'click')
        .pipe(
            switchMap(() => fetch('https://api.example.com/data'))
        )
        .subscribe(response => console.log('API 响应:', response));
    ```